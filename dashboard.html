<!doctype html>
<html lang="tr" class="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>YÃ¶netim Paneli</title>
  
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="icon" type="image/png" sizes="192x192" href="/favicon.png">
  
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        fontFamily: { sans: ['"Plus Jakarta Sans"', 'sans-serif'] },
        extend: {
          colors: { 
            slate: { 850: '#151e2e', 900: '#0f172a', 950: '#020617' },
            primary: { 500: '#6366f1', 600: '#4f46e5' } 
          }
        }
      }
    }
  </script>

  <style>
    body { 
      background-color: #0f172a;
      color: #f1f5f9; 
      overflow: hidden; /* Scroll inside containers */
    }
    
    /* Glassmorphism Utilities */
    .glass-panel {
      background: rgba(30, 41, 59, 0.4);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .glass-card {
      background: linear-gradient(145deg, rgba(30, 41, 59, 0.6) 0%, rgba(15, 23, 42, 0.8) 100%);
      border: 1px solid rgba(255, 255, 255, 0.05);
      transition: all 0.3s ease;
    }
    
    .glass-card:hover {
      border-color: rgba(99, 102, 241, 0.3);
      transform: translateY(-2px);
      box-shadow: 0 10px 30px -10px rgba(0, 0, 0, 0.3);
    }

    /* Custom Scrollbar */
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: #475569; }

    .sidebar-link {
        display: flex; align-items: center; gap: 12px;
        padding: 12px 16px; margin-bottom: 4px;
        border-radius: 12px; color: #94a3b8;
        transition: all 0.2s; font-weight: 500; font-size: 0.9rem;
    }
    .sidebar-link:hover, .sidebar-link.active {
        background: rgba(99, 102, 241, 0.1); color: #fff;
    }
    .sidebar-link.active { border-left: 3px solid #6366f1; }
    .sidebar-link i { width: 20px; height: 20px; }
  </style>
</head>
<body class="flex h-screen w-full">

  <div class="fixed inset-0 z-0 pointer-events-none">
      <div class="absolute top-0 left-0 w-[500px] h-[500px] bg-indigo-600/10 rounded-full blur-[100px]"></div>
      <div class="absolute bottom-0 right-0 w-[500px] h-[500px] bg-blue-600/10 rounded-full blur-[100px]"></div>
  </div>

  <aside class="w-64 h-full glass-panel flex flex-col z-20 hidden md:flex border-r border-slate-700/50">
      <div class="h-20 flex items-center px-6 border-b border-white/5">
          <div class="flex items-center gap-2">
              <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white font-bold">O</div>
              <span class="text-lg font-bold text-white tracking-tight">Optimizi<span class="text-indigo-400">.App</span></span>
          </div>
      </div>

      <div class="flex-1 overflow-y-auto py-6 px-4 space-y-1">
          <div class="text-xs font-bold text-slate-500 uppercase tracking-wider px-4 mb-2">Genel</div>
          <a href="#" class="sidebar-link active"><i data-lucide="layout-dashboard"></i> Panel</a>
          <a href="#" class="sidebar-link"><i data-lucide="folder-open"></i> Projelerim</a>
          <a href="#" class="sidebar-link"><i data-lucide="file-text"></i> Raporlar</a>
          
          <div class="text-xs font-bold text-slate-500 uppercase tracking-wider px-4 mb-2 mt-6">AraÃ§lar</div>
          <a href="endustriyel-enerji-kaybi-hesaplama.html" class="sidebar-link"><i data-lucide="calculator"></i> Hesaplama Merkezi</a>
          <a href="#" class="sidebar-link"><i data-lucide="users"></i> Ekip YÃ¶netimi <span class="ml-auto text-[10px] bg-indigo-500/20 text-indigo-300 px-1.5 py-0.5 rounded">PRO</span></a>

          <div class="text-xs font-bold text-slate-500 uppercase tracking-wider px-4 mb-2 mt-6">Ayarlar</div>
          <a href="#" class="sidebar-link"><i data-lucide="settings"></i> HesabÄ±m</a>
          <a href="#" class="sidebar-link"><i data-lucide="life-buoy"></i> Destek</a>
      </div>

      <div class="p-4 border-t border-white/5">
          <div class="flex items-center gap-3 p-2 rounded-xl bg-white/5 hover:bg-white/10 transition cursor-pointer">
              <div class="w-10 h-10 rounded-full bg-gradient-to-r from-blue-500 to-indigo-500 flex items-center justify-center text-white font-bold text-sm shadow-lg" id="avatarInitial">U</div>
              <div class="flex-1 min-w-0">
                  <p class="text-sm font-bold text-white truncate" id="sidebarUserName">YÃ¼kleniyor...</p>
                  <p class="text-xs text-slate-400 truncate">Pro Plan</p>
              </div>
              <button onclick="handleLogout()" class="text-slate-400 hover:text-red-400 transition" title="Ã‡Ä±kÄ±ÅŸ Yap"><i data-lucide="log-out" class="w-4 h-4"></i></button>
          </div>
      </div>
  </aside>

  <main class="flex-1 flex flex-col h-full relative z-10 overflow-hidden">
      
      <header class="h-20 flex items-center justify-between px-6 md:px-8 border-b border-white/5 glass-panel md:bg-transparent md:backdrop-filter-none md:border-none">
          <div class="flex items-center gap-4">
              <button class="md:hidden p-2 text-slate-400 hover:text-white"><i data-lucide="menu"></i></button>
              <h1 class="text-xl font-bold text-white hidden md:block">Genel BakÄ±ÅŸ</h1>
          </div>
          
          <div class="flex items-center gap-4">
              <div class="relative hidden md:block">
                  <i data-lucide="search" class="absolute left-3 top-2.5 w-4 h-4 text-slate-500"></i>
                  <input type="text" placeholder="Proje ara..." class="bg-slate-800/50 border border-slate-700 rounded-full pl-10 pr-4 py-2 text-sm text-slate-300 focus:outline-none focus:border-indigo-500 w-64 transition">
              </div>
              <button class="p-2 relative text-slate-400 hover:text-white transition">
                  <i data-lucide="bell"></i>
                  <span class="absolute top-1.5 right-1.5 w-2 h-2 bg-red-500 rounded-full border border-slate-900"></span>
              </button>
          </div>
      </header>

      <div class="flex-1 overflow-y-auto p-6 md:p-8 custom-scroll">
          
          <div class="mb-8">
              <h2 class="text-3xl font-black text-white mb-2">HoÅŸgeldin, <span class="text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 to-cyan-400" id="headerGreeting">KullanÄ±cÄ±</span> ðŸ‘‹</h2>
              <p class="text-slate-400">Enerji verimliliÄŸi projelerindeki son durumun burada.</p>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
              <div class="glass-card p-5 rounded-2xl relative overflow-hidden group">
                  <div class="absolute right-0 top-0 p-4 opacity-10 group-hover:scale-110 transition"><i data-lucide="folder" class="w-16 h-16 text-indigo-500"></i></div>
                  <div class="text-slate-400 text-xs font-bold uppercase tracking-wider mb-1">Toplam Proje</div>
                  <div class="text-3xl font-black text-white" id="statTotalProjects">0</div>
                  <div class="mt-2 text-xs text-green-400 flex items-center gap-1"><i data-lucide="trending-up" class="w-3 h-3"></i> <span>Bu ay %12 artÄ±ÅŸ</span></div>
              </div>
              
              <div class="glass-card p-5 rounded-2xl relative overflow-hidden group">
                  <div class="absolute right-0 top-0 p-4 opacity-10 group-hover:scale-110 transition"><i data-lucide="zap" class="w-16 h-16 text-yellow-500"></i></div>
                  <div class="text-slate-400 text-xs font-bold uppercase tracking-wider mb-1">Hesaplanan KayÄ±p</div>
                  <div class="text-3xl font-black text-white" id="statTotalLoss">0 â‚º</div>
                  <div class="mt-2 text-xs text-slate-500">Bekleyen optimizasyon</div>
              </div>

              <div class="glass-card p-5 rounded-2xl relative overflow-hidden group">
                  <div class="absolute right-0 top-0 p-4 opacity-10 group-hover:scale-110 transition"><i data-lucide="leaf" class="w-16 h-16 text-green-500"></i></div>
                  <div class="text-slate-400 text-xs font-bold uppercase tracking-wider mb-1">CO2 Tasarrufu</div>
                  <div class="text-3xl font-black text-white">0 <span class="text-sm font-normal text-slate-500">Ton</span></div>
                  <div class="mt-2 text-xs text-green-400">Hedefin %40'Ä±</div>
              </div>

              <div class="glass-card p-5 rounded-2xl relative overflow-hidden group bg-gradient-to-br from-indigo-600/20 to-purple-600/20 border-indigo-500/30">
                  <div class="flex items-center justify-between h-full">
                      <div>
                          <div class="text-indigo-300 text-xs font-bold uppercase tracking-wider mb-1">Yeni Hesaplama</div>
                          <a href="endustriyel-enerji-kaybi-hesaplama.html" class="mt-2 inline-flex items-center gap-2 bg-indigo-600 hover:bg-indigo-500 text-white px-4 py-2 rounded-lg text-sm font-bold transition shadow-lg shadow-indigo-600/20">
                              <i data-lucide="plus" class="w-4 h-4"></i> OluÅŸtur
                          </a>
                      </div>
                  </div>
              </div>
          </div>

          <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
              
              <div class="lg:col-span-2 glass-card rounded-2xl overflow-hidden flex flex-col">
                  <div class="p-6 border-b border-white/5 flex justify-between items-center">
                      <h3 class="font-bold text-white flex items-center gap-2"><i data-lucide="clock" class="w-4 h-4 text-indigo-400"></i> Son Projeler</h3>
                      <button class="text-xs text-slate-400 hover:text-white transition">TÃ¼mÃ¼nÃ¼ GÃ¶r</button>
                  </div>
                  
                  <div class="overflow-x-auto">
                      <table class="w-full text-left text-sm text-slate-400">
                          <thead class="bg-slate-800/50 text-xs uppercase text-slate-500">
                              <tr>
                                  <th class="px-6 py-4 font-bold">Proje AdÄ±</th>
                                  <th class="px-6 py-4 font-bold">TÃ¼r</th>
                                  <th class="px-6 py-4 font-bold">Durum</th>
                                  <th class="px-6 py-4 font-bold text-right">Ä°ÅŸlem</th>
                              </tr>
                          </thead>
                          <tbody class="divide-y divide-white/5" id="projectsTableBody">
                              <tr>
                                  <td colspan="4" class="px-6 py-12 text-center">
                                      <div class="inline-flex items-center justify-center w-12 h-12 bg-slate-800 rounded-full mb-3 text-slate-600">
                                          <i data-lucide="inbox" class="w-6 h-6"></i>
                                      </div>
                                      <p class="text-slate-500">HenÃ¼z kayÄ±tlÄ± proje yok.</p>
                                      <a href="endustriyel-enerji-kaybi-hesaplama.html" class="text-indigo-400 text-xs font-bold hover:underline mt-2 inline-block">Ä°lk projeni oluÅŸtur â†’</a>
                                  </td>
                              </tr>
                          </tbody>
                      </table>
                  </div>
              </div>

              <div class="space-y-6">
                  <div class="glass-card rounded-2xl p-6">
                      <h3 class="font-bold text-white mb-4 text-sm uppercase tracking-wide text-slate-400">HÄ±zlÄ± AraÃ§lar</h3>
                      <div class="space-y-3">
                          <a href="tool/roi.html" class="flex items-center gap-3 p-3 rounded-xl bg-slate-800/50 hover:bg-slate-700/50 border border-white/5 hover:border-indigo-500/30 transition group">
                              <div class="w-10 h-10 rounded-lg bg-orange-500/10 text-orange-400 flex items-center justify-center"><i data-lucide="flame" class="w-5 h-5"></i></div>
                              <div class="flex-1">
                                  <h4 class="text-sm font-bold text-slate-200 group-hover:text-white">Termal ROI</h4>
                                  <p class="text-xs text-slate-500">Geri dÃ¶nÃ¼ÅŸ sÃ¼resi hesabÄ±</p>
                              </div>
                              <i data-lucide="chevron-right" class="w-4 h-4 text-slate-600 group-hover:text-indigo-400"></i>
                          </a>
                          
                          <a href="tool/yogusma-hesaplama.html" class="flex items-center gap-3 p-3 rounded-xl bg-slate-800/50 hover:bg-slate-700/50 border border-white/5 hover:border-indigo-500/30 transition group">
                              <div class="w-10 h-10 rounded-lg bg-blue-500/10 text-blue-400 flex items-center justify-center"><i data-lucide="droplets" class="w-5 h-5"></i></div>
                              <div class="flex-1">
                                  <h4 class="text-sm font-bold text-slate-200 group-hover:text-white">YoÄŸuÅŸma HesabÄ±</h4>
                                  <p class="text-xs text-slate-500">Kritik yalÄ±tÄ±m kalÄ±nlÄ±ÄŸÄ±</p>
                              </div>
                              <i data-lucide="chevron-right" class="w-4 h-4 text-slate-600 group-hover:text-indigo-400"></i>
                          </a>

                          <a href="tool/yalitim-performans.html" class="flex items-center gap-3 p-3 rounded-xl bg-slate-800/50 hover:bg-slate-700/50 border border-white/5 hover:border-indigo-500/30 transition group">
                              <div class="w-10 h-10 rounded-lg bg-purple-500/10 text-purple-400 flex items-center justify-center"><i data-lucide="layers" class="w-5 h-5"></i></div>
                              <div class="flex-1">
                                  <h4 class="text-sm font-bold text-slate-200 group-hover:text-white">Optimum KalÄ±nlÄ±k</h4>
                                  <p class="text-xs text-slate-500">Verimlilik analizi</p>
                              </div>
                              <i data-lucide="chevron-right" class="w-4 h-4 text-slate-600 group-hover:text-indigo-400"></i>
                          </a>
                      </div>
                  </div>

                  <div class="glass-card rounded-2xl p-6 bg-gradient-to-br from-indigo-900/50 to-slate-900 border-indigo-500/30 relative overflow-hidden">
                      <div class="absolute top-0 right-0 p-4 opacity-10"><i data-lucide="crown" class="w-24 h-24 text-white"></i></div>
                      <div class="relative z-10">
                          <span class="inline-block px-2 py-1 rounded bg-indigo-500 text-white text-[10px] font-bold mb-2">PRO</span>
                          <h3 class="text-lg font-bold text-white mb-2">RaporlarÄ±nÄ± Ã–zelleÅŸtir</h3>
                          <p class="text-xs text-slate-300 mb-4 leading-relaxed">Kendi ÅŸirket logonu ve ÅŸablonunu ekleyerek mÃ¼ÅŸterilerine Ã¶zel raporlar oluÅŸtur.</p>
                          <button class="text-xs font-bold text-white bg-white/10 hover:bg-white/20 border border-white/20 px-4 py-2 rounded-lg transition">PlanÄ± YÃ¼kselt</button>
                      </div>
                  </div>
              </div>

          </div>
      </div>
  </main>

  <script>
    // Supabase Configuration (AYNEN KORUNDU)
    const SUPABASE_URL = 'https://gktvludkrsxnpigydqml.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdrdHZsdWRrcnN4bnBpZ3lkcW1sIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA1NTI5OTQsImV4cCI6MjA4NjEyODk5NH0.GE9KbO7dx_W7BYihAzvJl744R317xEA8Ars98UW-VWo';
    const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    
    // Check authentication and load user data
    async function checkAuth() {
      const { data: { session }, error } = await supabaseClient.auth.getSession();
      
      if (!session) {
        window.location.href = 'login.html';
        return;
      }
      
      const user = session.user;
      console.log('âœ… KullanÄ±cÄ± giriÅŸ yapmÄ±ÅŸ:', user);
      
      // Update UI with user info
      const fullName = user.user_metadata?.full_name || user.email.split('@')[0];
      const firstName = fullName.split(' ')[0];
      const initial = firstName.charAt(0).toUpperCase();
      
      // Sidebar Update
      document.getElementById('sidebarUserName').textContent = fullName;
      document.getElementById('avatarInitial').textContent = initial;
      
      // Header Greeting
      document.getElementById('headerGreeting').textContent = firstName;
      
      // TODO: Fetch real data from DB later. For now, we simulate empty state or fetch local storage mock
      loadRecentProjects();
    }
    
    function loadRecentProjects() {
        // Bu fonksiyon ileride Supabase'den veri Ã§ekecek.
        // Åžimdilik LocalStorage'daki "optimizi_saved_list" e bakabiliriz (eski kodlarda vardÄ±)
        const savedData = JSON.parse(localStorage.getItem('optimizi_saved_list') || '[]');
        const tableBody = document.getElementById('projectsTableBody');
        const countEl = document.getElementById('statTotalProjects');

        if(savedData.length > 0) {
            tableBody.innerHTML = ''; // Clear empty state
            countEl.innerText = savedData.length;
            
            // Show last 5
            savedData.slice().reverse().slice(0, 5).forEach(proj => {
                const date = new Date(proj.date).toLocaleDateString('tr-TR');
                const row = `
                <tr class="hover:bg-white/5 transition group">
                    <td class="px-6 py-4 font-medium text-white flex items-center gap-3">
                        <div class="w-8 h-8 rounded bg-slate-700 flex items-center justify-center text-slate-400 group-hover:text-white group-hover:bg-indigo-600 transition">
                            <i data-lucide="file-text" class="w-4 h-4"></i>
                        </div>
                        ${proj.name}
                    </td>
                    <td class="px-6 py-4">Genel Hesaplama</td>
                    <td class="px-6 py-4"><span class="px-2 py-1 rounded bg-green-500/10 text-green-400 text-xs font-bold border border-green-500/20">TamamlandÄ±</span></td>
                    <td class="px-6 py-4 text-right">
                        <button class="text-slate-400 hover:text-white p-1"><i data-lucide="more-horizontal" class="w-4 h-4"></i></button>
                    </td>
                </tr>
                `;
                tableBody.insertAdjacentHTML('beforeend', row);
            });
            lucide.createIcons();
        }
    }

    // Logout function
    async function handleLogout() {
      const { error } = await supabaseClient.auth.signOut();
      if (error) {
        console.error('Ã‡Ä±kÄ±ÅŸ hatasÄ±:', error);
        alert('Ã‡Ä±kÄ±ÅŸ yapÄ±lÄ±rken bir hata oluÅŸtu.');
      } else {
        window.location.href = 'login.html';
      }
    }
    
    // Init
    checkAuth();
    lucide.createIcons();
  </script>
</body>
</html>
