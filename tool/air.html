<!doctype html>
<html lang="tr" class="dark">
<head>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KD7DLCNS');</script>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />

<title>BasÄ±nÃ§lÄ± Hava KaÃ§aÄŸÄ± Hesaplama AracÄ±</title>
<meta name="description" content="Tesisinizdeki hava kaÃ§aklarÄ±nÄ± listeleyin, konumlarÄ±nÄ± belirleyin ve toplam maliyeti ISO 1217 standartlarÄ±na gÃ¶re raporlayÄ±n.">

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<link rel="icon" href="../favicon.png" type="image/png">

<script>
  tailwind.config = {
    darkMode: 'class',
    theme: {
      fontFamily: { sans: ['"Plus Jakarta Sans"', 'sans-serif'] },
      extend: {
        colors: { slate: { 850: '#151e2e', 900: '#0f172a', 950: '#020617' } },
        animation: { 'blob': 'blob 20s infinite' },
        keyframes: {
            blob: {
                '0%': { transform: 'translate(0px, 0px) scale(1)' },
                '33%': { transform: 'translate(30px, -50px) scale(1.1)' },
                '66%': { transform: 'translate(-20px, 20px) scale(0.9)' },
                '100%': { transform: 'translate(0px, 0px) scale(1)' },
            }
        }
      }
    }
  }
</script>
<style>
  /* Genel Ayarlar */
  ::-webkit-scrollbar { width: 6px; height: 6px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: #475569; border-radius: 3px; }
  html { scroll-behavior: smooth; }
  body { 
    background: radial-gradient(ellipse at top, #1e1b4b 0%, #0f172a 40%, #020617 100%);
    background-attachment: fixed; color: #f1f5f9; overflow-x: hidden;
  }
  .glass-card { background-color: rgba(30, 41, 59, 0.4); backdrop-filter: blur(16px); border: 1px solid rgba(255, 255, 255, 0.08); transition: all 0.3s ease; }
  .glass-input { border-radius: 0.75rem; padding: 0.75rem; width: 100%; background-color: rgba(15, 23, 42, 0.6); border: 1px solid rgba(255,255,255,0.1); color: white; transition: all 0.2s; }
  .glass-input:focus { outline: none; border-color: #06b6d4; background-color: rgba(15, 23, 42, 0.8); }
  .glass-nav { background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(20px); border-bottom: 1px solid rgba(255,255,255,0.08); }
  .bg-grid { background-size: 60px 60px; background-image: linear-gradient(to right, rgba(255, 255, 255, 0.03) 1px, transparent 1px), linear-gradient(to bottom, rgba(255, 255, 255, 0.03) 1px, transparent 1px); mask-image: radial-gradient(circle at center, black 40%, transparent 80%); pointer-events: none; }

  /* Print Styles */
  @media print {
    @page { margin: 0; size: A4; }
    html, body { width: 210mm; height: 297mm; margin: 0 !important; padding: 0 !important; background: white !important; color: black !important; overflow: visible !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    #app-layer, .bg-grid, .blob-bg, nav { display: none !important; }
    #print-area { display: block !important; }
    .print-page { width: 210mm; height: 296mm; position: relative; page-break-after: always; overflow: hidden; background: white; }
    .print-page:last-child { page-break-after: auto; }
    .cover-bg { background-color: #0f172a; color: white; }
    .cover-accent { position: absolute; top: 0; right: 0; width: 60%; height: 100%; background: #1e293b; clip-path: polygon(25% 0, 100% 0, 100% 100%, 0% 100%); z-index: 0; }
    .cover-content { position: relative; z-index: 10; height: 100%; padding: 20mm; display: flex; flex-direction: column; justify-content: center; }
    .audit-table th { background-color: #f1f5f9; color: #475569; font-weight: 700; text-transform: uppercase; font-size: 8px; padding: 5px; border-bottom: 2px solid #e2e8f0; }
    .audit-table td { border-bottom: 1px solid #e2e8f0; padding: 5px; font-size: 9px; color: #334155; vertical-align: middle; }
    .audit-table tr:nth-child(even) { background-color: #f8fafc; }
  }
  #print-area { display: none; }
</style>
</head>
<body class="antialiased selection:bg-cyan-500/30 selection:text-white" onload="initApp()">

<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KD7DLCNS"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<div class="fixed inset-0 z-0 pointer-events-none overflow-hidden">
    <div class="absolute inset-0 bg-grid"></div>
    <div class="blob-bg absolute top-0 -left-1/4 w-[900px] h-[900px] bg-cyan-600/10 rounded-full blur-[120px] animate-blob mix-blend-screen"></div>
    <div class="blob-bg absolute bottom-0 -right-1/4 w-[900px] h-[900px] bg-blue-600/10 rounded-full blur-[120px] animate-blob mix-blend-screen" style="animation-delay: 5s;"></div>
</div>

<div id="app-layer" class="relative z-10 flex flex-col min-h-screen">
  
    <nav class="sticky top-0 z-50 glass-nav transition-all duration-300">
      <div class="container mx-auto px-6 h-16 flex items-center justify-between">
          <a href="../index.html" class="flex items-center gap-3 group">
              <div>
                  <h1 class="text-lg font-bold text-white tracking-wide">Optimizi<span class="text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-blue-400">.App</span></h1>
              </div>
          </a>
          
          <div class="flex items-center gap-3">
              <div class="hidden md:flex items-center gap-2 px-3 py-1.5 rounded-full bg-slate-800/50 border border-slate-700/50 text-xs text-slate-300">
                  <span class="w-1.5 h-1.5 rounded-full bg-cyan-500 animate-pulse"></span>
                  <span id="fxVal" class="font-bold text-white">...</span>
                  <button onclick="getFx()"><i data-lucide="refresh-cw" class="w-3 h-3 ml-1 hover:animate-spin text-slate-400 hover:text-white"></i></button>
              </div>

              <button onclick="toggleLanguage()" class="p-2 rounded-lg hover:bg-white/5 text-slate-400 hover:text-white transition"><span class="lang-flag text-lg">ðŸ‡¬ðŸ‡§</span></button>
              
              <button onclick="printRep()" class="flex items-center gap-2 bg-cyan-600 hover:bg-cyan-500 text-white px-4 py-2 rounded-lg text-xs font-bold transition shadow-lg shadow-cyan-600/20 active:scale-95 ml-2">
                  <i data-lucide="printer" class="w-4 h-4"></i> <span data-i18n="btn_report">Rapor Al</span>
              </button>
          </div>
      </div>
    </nav>

    <main class="flex-1 container mx-auto p-6 lg:p-8">
      
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="glass-card p-6 relative overflow-hidden group rounded-2xl">
               <div class="absolute right-0 top-0 p-4 opacity-10 group-hover:opacity-20 transition transform group-hover:scale-110"><i data-lucide="wind" class="w-24 h-24 text-cyan-500"></i></div>
               <div class="text-slate-400 text-[10px] font-bold uppercase tracking-wider mb-2" data-i18n="dash_flow">Toplam KaÃ§ak</div>
               <div class="text-4xl font-bold text-white tracking-tight"><span id="dashFlow">0.0</span> <span class="text-lg text-slate-500 font-normal">mÂ³/dk</span></div>
            </div>
            
            <div class="glass-card p-6 relative overflow-hidden group rounded-2xl">
               <div class="absolute right-0 top-0 p-4 opacity-10 group-hover:opacity-20 transition"><i data-lucide="zap" class="w-24 h-24 text-orange-500"></i></div>
               <div class="text-slate-400 text-[10px] font-bold uppercase tracking-wider mb-2" data-i18n="dash_power">KayÄ±p GÃ¼Ã§</div>
               <div class="text-3xl font-bold text-orange-400 tracking-tight"><span id="dashPower">0.0</span> <span class="text-sm text-slate-500">kW</span></div>
            </div>
            
            <div class="glass-card p-6 relative overflow-hidden rounded-2xl border-red-500/20">
               <div class="text-slate-400 text-[10px] font-bold uppercase tracking-wider mb-2" data-i18n="dash_cost">YÄ±llÄ±k Zarar</div>
               <div class="text-3xl font-bold text-red-500 tracking-tight" id="dashCost">0</div>
            </div>
            
            <div class="glass-card p-6 !bg-gradient-to-br from-slate-800 to-slate-900 border-green-500/20 rounded-2xl">
               <div class="flex items-center justify-between">
                  <div>
                      <div class="text-green-400 text-[10px] font-bold uppercase tracking-wider mb-1" data-i18n="dash_co2">CO2 SalÄ±nÄ±mÄ±</div>
                      <div class="text-3xl font-bold text-white" id="dashCo2">0 <span class="text-sm font-normal text-slate-500">Ton</span></div>
                  </div>
                  <div class="p-3 bg-green-500/10 rounded-xl text-green-500 border border-green-500/20"><i data-lucide="leaf" class="w-6 h-6"></i></div>
               </div>
            </div>
        </div>

        <div class="grid grid-cols-1 xl:grid-cols-12 gap-8 items-start">
            
            <div class="xl:col-span-4 space-y-6">
                
                <div class="glass-card p-6 rounded-2xl">
                   <h3 class="text-cyan-400 text-xs font-bold uppercase mb-4 flex items-center gap-2"><i data-lucide="briefcase" class="w-4 h-4"></i> <span data-i18n="lbl_proj">Proje DetaylarÄ±</span></h3>
                   <div class="space-y-4">
                       <div>
                           <label class="text-[10px] uppercase text-slate-500 font-bold mb-1 block" data-i18n="lbl_prep">HazÄ±rlayan</label>
                           <div class="grid gap-2"><input type="text" id="pName" class="glass-input text-xs" data-i18n="ph_firm" placeholder="Firma AdÄ±"><input type="text" id="pEng" class="glass-input text-xs" data-i18n="ph_eng" placeholder="MÃ¼hendis AdÄ±"></div>
                       </div>
                       <div class="h-px bg-white/5 my-3"></div>
                       <div>
                           <label class="text-[10px] uppercase text-slate-500 font-bold mb-1 block" data-i18n="lbl_cust">MÃ¼ÅŸteri</label>
                           <div class="grid gap-2"><input type="text" id="cName" class="glass-input text-xs" data-i18n="ph_cust_firm" placeholder="MÃ¼ÅŸteri Firma"><input type="text" id="cEng" class="glass-input text-xs" data-i18n="ph_dept" placeholder="Ä°lgili KiÅŸi / Departman"></div>
                       </div>
                   </div>
                </div>

                <div class="glass-card p-6 rounded-2xl">
                    <h3 class="text-orange-400 text-xs font-bold uppercase mb-4 flex items-center gap-2"><i data-lucide="settings" class="w-4 h-4"></i> <span data-i18n="lbl_sys">Sistem AyarlarÄ±</span></h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="text-[10px] text-slate-400 mb-1 block" data-i18n="lbl_hours">YÄ±llÄ±k Saat</label>
                            <input type="number" id="hours" class="glass-input text-xs" value="8000">
                        </div>
                        <div>
                            <label class="text-[10px] text-slate-400 mb-1 block" data-i18n="lbl_price">Birim Fiyat</label>
                            <div class="flex gap-1">
                                <input type="number" id="price" class="glass-input text-xs" value="3.5">
                                <select id="curr" class="glass-input !px-1 w-14 text-center text-xs"><option value="TL">â‚º</option><option value="USD">$</option><option value="EUR">â‚¬</option></select>
                            </div>
                        </div>
                    </div>
                    <div class="mt-4">
                        <label class="text-[10px] text-slate-400 mb-1 block" data-i18n="lbl_spec_pow">KompresÃ¶r Ã–zgÃ¼l GÃ¼Ã§ (kW/mÂ³/dk)</label>
                        <input type="number" id="specPower" class="glass-input text-xs" value="6.5" step="0.1">
                        <div class="text-[9px] text-slate-500 mt-1">Standart VidalÄ± KompresÃ¶r: ~6.0 - 7.0</div>
                    </div>
                </div>

                <div class="glass-card p-6 border-cyan-500/30 shadow-[0_0_20px_rgba(6,182,212,0.1)] rounded-2xl relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-cyan-500/10 rounded-full blur-2xl -mr-16 -mt-16 pointer-events-none"></div>
                    
                    <h3 class="text-white text-sm font-bold uppercase mb-4 flex items-center gap-2 relative z-10"><i data-lucide="plus-circle" class="w-4 h-4 text-cyan-400"></i> <span data-i18n="lbl_add">KaÃ§ak Ekle</span></h3>
                    
                    <div class="space-y-4 relative z-10">
                        <div>
                            <label class="text-[10px] text-slate-400 mb-1 block" data-i18n="lbl_loc">Konum / Etiket</label>
                            <input type="text" id="loc" class="glass-input text-xs font-bold text-white" placeholder="Ã–rn: KompresÃ¶r Dairesi, Hat 1...">
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="text-[10px] text-slate-400 mb-1 block" data-i18n="lbl_dia">Delik Ã‡apÄ± (mm)</label>
                                <input type="number" id="dia" value="1" step="0.1" min="0.1" class="glass-input text-center font-bold text-cyan-400">
                                <input type="range" id="diaRange" min="0.5" max="5" step="0.5" value="1" class="w-full h-1 bg-slate-700 rounded-lg appearance-none cursor-pointer mt-2 accent-cyan-500">
                            </div>
                            <div>
                                <label class="text-[10px] text-slate-400 mb-1 block" data-i18n="lbl_bar">BasÄ±nÃ§ (bar)</label>
                                <input type="number" id="bar" value="7" step="0.1" class="glass-input text-center font-bold">
                            </div>
                        </div>

                        <div>
                            <input type="file" id="imgInp" class="hidden" accept="image/*" onchange="readImg(this)">
                            <div onclick="document.getElementById('imgInp').click()" class="border border-dashed border-slate-600 rounded-lg p-3 text-center cursor-pointer hover:border-cyan-500 hover:bg-slate-800/50 transition group">
                                <i data-lucide="camera" class="w-4 h-4 text-slate-500 mx-auto group-hover:text-cyan-400 mb-1"></i>
                                <span class="text-[10px] text-slate-400 block" data-i18n="lbl_photo">KaÃ§ak FotoÄŸrafÄ± Ekle</span>
                            </div>
                            <img id="prevImg" class="hidden w-full h-24 object-cover rounded-lg mt-2 border border-slate-600">
                        </div>
                    </div>

                    <div id="btn-group" class="mt-4 relative z-10">
                        <button id="btnAdd" onclick="addLeak()" class="w-full bg-cyan-600 hover:bg-cyan-500 text-white font-bold py-3 rounded-xl shadow-lg shadow-cyan-600/20 transition active:scale-95 flex items-center justify-center gap-2 text-sm">
                            <i data-lucide="plus" class="w-4 h-4"></i> <span data-i18n="btn_calc">Listeye Ekle</span>
                        </button>
                        <button id="btnUpdate" onclick="finishUpdate()" class="hidden w-full bg-orange-500 hover:bg-orange-400 text-white font-bold py-3 rounded-xl shadow-lg shadow-orange-500/20 transition active:scale-95 flex items-center justify-center gap-2 text-sm">
                            <i data-lucide="check" class="w-4 h-4"></i> <span data-i18n="btn_update">GÃ¼ncelle</span>
                        </button>
                    </div>
                </div>
            </div>

            <div class="xl:col-span-8">
                <div class="glass-card p-0 overflow-hidden min-h-[600px] flex flex-col rounded-2xl">
                    <div class="p-4 border-b border-white/5 flex justify-between items-center bg-slate-900/30">
                        <h3 class="font-bold text-white flex items-center gap-2"><i data-lucide="list" class="w-4 h-4 text-cyan-400"></i> <span data-i18n="lbl_list">Tespit Edilen KaÃ§aklar</span></h3>
                        <button onclick="clearAll()" class="text-xs text-red-400 hover:text-red-300 transition" data-i18n="btn_clear">TÃ¼mÃ¼nÃ¼ Sil</button>
                    </div>
                    <div class="overflow-x-auto flex-1">
                        <table class="w-full text-left text-sm" id="grid">
                        <thead class="bg-slate-900/80 text-[10px] uppercase text-slate-400 font-semibold sticky top-0 backdrop-blur-md">
                            <tr>
                            <th class="px-4 py-3" data-i18n="th_img">GÃ¶rsel</th>
                            <th class="px-4 py-3" data-i18n="th_loc">Konum</th>
                            <th class="px-4 py-3 text-center" data-i18n="th_det">Detay (mm/bar)</th>
                            <th class="px-4 py-3 text-right text-cyan-400" data-i18n="th_flow">Debi (mÂ³/dk)</th>
                            <th class="px-4 py-3 text-right text-red-400" data-i18n="th_cost">YÄ±llÄ±k Maliyet</th>
                            <th class="px-4 py-3 text-right" data-i18n="th_act">Ä°ÅŸlem</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-slate-700/50" id="gridBody">
                            <tr><td colspan="6" class="px-6 py-20 text-center text-slate-500"><i data-lucide="wind" class="w-12 h-12 mx-auto mb-3 opacity-20"></i><span data-i18n="msg_empty">HenÃ¼z kaÃ§ak eklenmedi.</span></td></tr>
                        </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>

<div id="print-area">
    <div class="print-page cover-bg">
        <div class="cover-accent"></div>
        <div class="cover-content">
            <div class="text-sm tracking-[5px] text-cyan-400 uppercase mb-4 opacity-90" id="rep_title_top">Enerji VerimliliÄŸi EtÃ¼dÃ¼</div>
            <h1 class="text-6xl font-black leading-tight mb-10 text-white relative z-10" id="rep_title_main">BASINÃ‡LI HAVA <br><span class="text-cyan-500">KAÃ‡AK TESPÄ°T</span> <br>RAPORU</h1>
            <div class="border-l-4 border-cyan-500 pl-8 mt-12 relative z-10">
                <div class="text-xs uppercase opacity-60 mb-1" id="rep_client_lbl">MÃ¼ÅŸteri</div><div class="text-3xl font-bold mb-8" id="covClient">CLIENT COMPANY</div>
                <div class="text-xs uppercase opacity-60 mb-1" id="rep_prep_lbl">HazÄ±rlayan</div><div class="text-xl font-bold" id="covProv">PROVIDER</div>
            </div>
             <div class="mt-auto text-right relative z-10"><div class="text-[100px] font-black text-cyan-500 leading-none" id="covTotalCost">0</div><div class="text-2xl font-medium tracking-wide" id="covCurr">TL / YIL KAYIP</div></div>
            <div class="absolute bottom-4 left-8 text-xs text-white/20 font-bold uppercase tracking-widest">POWERED BY OPTIMIZI.APP</div>
        </div>
    </div>
    
    <div class="print-page p-12">
        <div class="flex justify-between items-center border-b-2 border-slate-900 pb-4 mb-8"><h2 class="text-xl font-black text-slate-900 uppercase" id="rep_p2_title">KaÃ§ak Listesi ve Analiz</h2><div class="text-xs text-slate-500" id="rDate">...</div></div>
        <table class="w-full audit-table mb-8"><thead><tr id="rep_table_head"></tr></thead><tbody id="rTable"></tbody></table>
        <div class="mt-auto pt-8 border-t border-slate-200 text-center text-[10px] text-slate-400">Page 2 / 2</div>
    </div>
</div>

<script>
    async function initApp(){
        document.documentElement.classList.add('dark');
        try{
            const rsp=await fetch('https://ipapi.co/json/');
            const data=await rsp.json();
            if(data.country_code==='TR') setLang('tr'); else setLang('en');
        }catch(e){
            const userLang=navigator.language||navigator.userLanguage;
            if(userLang.startsWith('tr')) setLang('tr'); else setLang('en');
        }
        init(); 
    }

    const TRANSLATIONS={
        tr:{
            page_title:"BasÄ±nÃ§lÄ± Hava KaÃ§ak Analizi", btn_report:"Rapor Al", dash_flow:"Toplam KaÃ§ak", dash_power:"KayÄ±p GÃ¼Ã§", dash_cost:"YÄ±llÄ±k Zarar", dash_co2:"CO2 SalÄ±nÄ±mÄ±",
            lbl_proj:"Proje DetaylarÄ±", lbl_prep:"HazÄ±rlayan", ph_firm:"Firma AdÄ±", ph_eng:"MÃ¼hendis AdÄ±", lbl_cust:"MÃ¼ÅŸteri", ph_cust_firm:"MÃ¼ÅŸteri Firma", ph_dept:"Ä°lgili KiÅŸi",
            lbl_sys:"Sistem AyarlarÄ±", lbl_hours:"YÄ±llÄ±k Saat", lbl_price:"Birim Fiyat", lbl_spec_pow:"Ã–zgÃ¼l GÃ¼Ã§ (kW/mÂ³/dk)",
            lbl_add:"KaÃ§ak Ekle", lbl_loc:"Konum / Etiket", lbl_dia:"Delik Ã‡apÄ± (mm)", lbl_bar:"BasÄ±nÃ§ (bar)", lbl_photo:"KaÃ§ak FotoÄŸrafÄ± Ekle", btn_calc:"Listeye Ekle", btn_update:"GÃ¼ncelle",
            lbl_list:"Tespit Edilen KaÃ§aklar", btn_clear:"TÃ¼mÃ¼nÃ¼ Sil", msg_empty:"HenÃ¼z kaÃ§ak eklenmedi.",
            th_img:"GÃ¶rsel", th_loc:"Konum", th_det:"Detay", th_flow:"Debi", th_cost:"Maliyet", th_act:"Ä°ÅŸlem",
            rep_title_top:"Enerji VerimliliÄŸi EtÃ¼dÃ¼", rep_title_main:"BASINÃ‡LI HAVA <br><span class='text-cyan-500'>KAÃ‡AK TESPÄ°T</span> <br>RAPORU",
            rep_client_lbl:"MÃ¼ÅŸteri", rep_prep_lbl:"HazÄ±rlayan", rep_p2_title:"KaÃ§ak Listesi ve Analiz"
        },
        en:{
            page_title:"Compressed Air Leak Analysis", btn_report:"Get Report", dash_flow:"Total Leak Flow", dash_power:"Power Loss", dash_cost:"Annual Cost", dash_co2:"CO2 Emissions",
            lbl_proj:"Project Details", lbl_prep:"Prepared By", ph_firm:"Company", ph_eng:"Engineer", lbl_cust:"Customer", ph_cust_firm:"Client Company", ph_dept:"Contact / Dept",
            lbl_sys:"System Settings", lbl_hours:"Annual Hours", lbl_price:"Unit Price", lbl_spec_pow:"Specific Power (kW/mÂ³/min)",
            lbl_add:"Add Leak", lbl_loc:"Location / Tag", lbl_dia:"Hole Diameter (mm)", lbl_bar:"Pressure (bar)", lbl_photo:"Add Leak Photo", btn_calc:"Add to List", btn_update:"Update",
            lbl_list:"Detected Leaks", btn_clear:"Clear All", msg_empty:"No leaks added yet.",
            th_img:"Image", th_loc:"Location", th_det:"Detail", th_flow:"Flow", th_cost:"Cost", th_act:"Action",
            rep_title_top:"Energy Efficiency Audit", rep_title_main:"COMPRESSED AIR <br><span class='text-cyan-500'>LEAK DETECTION</span> <br>REPORT",
            rep_client_lbl:"Client", rep_prep_lbl:"Prepared By", rep_p2_title:"Leak List & Analysis"
        }
    };

    let currentLang='en';
    let LIST = [];
    let FX = {USD:34.50, EUR:36.50, TL:1.0};
    let currImg = null;
    let editingIndex = null;

    function toggleLanguage(){setLang(currentLang==='tr'?'en':'tr');}
    
    function setLang(code){
        currentLang=code;
        const isEn=currentLang==='en';
        document.querySelectorAll('.lang-flag').forEach(el=>el.innerText=isEn?'ðŸ‡¬ðŸ‡§':'ðŸ‡¹ðŸ‡·');
        
        document.querySelectorAll('[data-i18n]').forEach(el=>{
            const key=el.getAttribute('data-i18n');
            if(TRANSLATIONS[currentLang][key]){
                if(el.tagName==='INPUT'||el.tagName==='TEXTAREA') el.placeholder=TRANSLATIONS[currentLang][key];
                else el.innerHTML=TRANSLATIONS[currentLang][key];
            }
        });
        
        if(code==='tr'){ if(document.getElementById('curr')) document.getElementById('curr').value='TL'; }
        else{ if(document.getElementById('curr')) document.getElementById('curr').value='USD'; }
        
        render();
    }

    function init(){ 
        getFx(); 
        lucide.createIcons();
        
        // Slider Sync
        const dIn = document.getElementById('dia');
        const dRn = document.getElementById('diaRange');
        dIn.addEventListener('input', ()=>{dRn.value=dIn.value;});
        dRn.addEventListener('input', ()=>{dIn.value=dRn.value;});
    }

    function readImg(i){
        if(i.files&&i.files[0]){
            const r=new FileReader();
            r.onload=e=>{
                currImg=e.target.result;
                document.getElementById('prevImg').src=currImg;
                document.getElementById('prevImg').classList.remove('hidden');
            };
            r.readAsDataURL(i.files[0]);
        }
    }

    async function getFx(){
        try{
            const r=await fetch('https://api.frankfurter.app/latest?from=USD&to=TRY'); const d=await r.json(); FX.USD=d.rates.TRY;
            const r2=await fetch('https://api.frankfurter.app/latest?from=EUR&to=TRY'); const d2=await r2.json(); FX.EUR=d2.rates.TRY;
        }catch(e){}
    }

    function getCalculation(dia, bar, hours, price, specPower, curr) {
        // ISO 1217 FORMÃœLÃœ: Q = 0.0071 * d^2 * (p + 1) -> (YaklaÅŸÄ±k formÃ¼l)
        // Daha hassas yaklaÅŸÄ±m iÃ§in katsayÄ±lar kullanÄ±labilir ama bu yeterli.
        
        // 1. Debi (m3/dk)
        const flow = 0.0071 * (dia * dia) * (bar + 1); // BasitleÅŸtirilmiÅŸ
        
        // 2. GÃ¼Ã§ KaybÄ± (kW) -> Debi * Ã–zgÃ¼l GÃ¼Ã§
        const power = flow * specPower;
        
        // 3. YÄ±llÄ±k Enerji (kWh)
        const energy = power * hours;
        
        // 4. Maliyet
        // Kur Ã§evrimi: EÄŸer seÃ§ili kur TL ise ve fiyat TL ise sorun yok.
        // FiyatÄ± her zaman seÃ§ili kur cinsinden kabul ediyoruz.
        const cost = energy * price;
        
        // 5. CO2 (TÃ¼rkiye ÅŸebeke ortalamasÄ± ~0.44 kg/kWh)
        const co2 = (energy * 0.44) / 1000; // Ton

        return { flow, power, cost, co2 };
    }

    function addLeak(){
        const loc = document.getElementById('loc').value || (currentLang==='tr'?'Bilinmeyen Konum':'Unknown Loc');
        const dia = parseFloat(document.getElementById('dia').value) || 1;
        const bar = parseFloat(document.getElementById('bar').value) || 7;
        
        // Global deÄŸerleri al (hesaplama anÄ±ndaki deÄŸerler)
        const hours = parseFloat(document.getElementById('hours').value) || 8000;
        const price = parseFloat(document.getElementById('price').value) || 3.5;
        const specPower = parseFloat(document.getElementById('specPower').value) || 6.5;
        const curr = document.getElementById('curr').value;

        const res = getCalculation(dia, bar, hours, price, specPower, curr);

        const item = {
            id: Date.now(),
            loc, dia, bar, img: currImg,
            res: res, // SonuÃ§larÄ± sakla
            inputs: { hours, price, specPower, curr } // Girdileri sakla
        };

        LIST.push(item);
        resetForm();
        render();
    }

    function finishUpdate(){
        if(editingIndex!==null) {
            // Mevcut inputlarla gÃ¼ncelle
            const loc = document.getElementById('loc').value;
            const dia = parseFloat(document.getElementById('dia').value);
            const bar = parseFloat(document.getElementById('bar').value);
            
            // Global deÄŸerleri de gÃ¼ncelle
            const hours = parseFloat(document.getElementById('hours').value);
            const price = parseFloat(document.getElementById('price').value);
            const specPower = parseFloat(document.getElementById('specPower').value);
            const curr = document.getElementById('curr').value;

            const res = getCalculation(dia, bar, hours, price, specPower, curr);

            LIST[editingIndex].loc = loc;
            LIST[editingIndex].dia = dia;
            LIST[editingIndex].bar = bar;
            LIST[editingIndex].img = currImg;
            LIST[editingIndex].res = res;
            LIST[editingIndex].inputs = { hours, price, specPower, curr };
        }
        
        editingIndex = null;
        document.getElementById('btnAdd').classList.remove('hidden');
        document.getElementById('btnUpdate').classList.add('hidden');
        resetForm();
        render();
    }

    function edit(index){
        editingIndex = index;
        const item = LIST[index];
        
        document.getElementById('loc').value = item.loc;
        document.getElementById('dia').value = item.dia;
        document.getElementById('diaRange').value = item.dia;
        document.getElementById('bar').value = item.bar;
        
        // Resmi geri yÃ¼kle
        currImg = item.img;
        if(currImg) {
            document.getElementById('prevImg').src = currImg;
            document.getElementById('prevImg').classList.remove('hidden');
        } else {
            document.getElementById('prevImg').classList.add('hidden');
        }

        document.getElementById('btnAdd').classList.add('hidden');
        document.getElementById('btnUpdate').classList.remove('hidden');
    }

    function del(index){
        if(confirm(currentLang==='tr'?'Silinsin mi?':'Delete?')){
            LIST.splice(index, 1);
            render();
        }
    }

    function clearAll(){
        if(confirm(currentLang==='tr'?'TÃ¼m liste silinecek?':'Clear all list?')){
            LIST = [];
            render();
        }
    }

    function resetForm(){
        document.getElementById('loc').value = '';
        currImg = null;
        document.getElementById('prevImg').classList.add('hidden');
        document.getElementById('imgInp').value = '';
    }

    function render(){
        const tb = document.getElementById('gridBody');
        tb.innerHTML = '';
        
        let tFlow = 0, tPower = 0, tCost = 0, tCo2 = 0;
        const currSym = document.getElementById('curr').value;

        LIST.forEach((item, i) => {
            tFlow += item.res.flow;
            tPower += item.res.power;
            tCost += item.res.cost;
            tCo2 += item.res.co2;

            const imgHtml = item.img 
                ? `<img src="${item.img}" class="w-10 h-10 object-cover rounded border border-white/10">` 
                : `<div class="w-10 h-10 bg-slate-800 rounded flex items-center justify-center text-xs text-slate-500"><i data-lucide="image-off" class="w-4 h-4"></i></div>`;

            tb.innerHTML += `
                <tr class="hover:bg-slate-800/30 transition border-b border-slate-700/50 ${i===editingIndex?'bg-cyan-900/20':''}">
                    <td class="px-4 py-3">${imgHtml}</td>
                    <td class="px-4 py-3 font-bold text-white">${item.loc}</td>
                    <td class="px-4 py-3 text-center text-xs font-mono text-slate-400">
                        <span class="text-cyan-400 font-bold">${item.dia}mm</span> / ${item.bar}bar
                    </td>
                    <td class="px-4 py-3 text-right font-mono text-cyan-400">${item.res.flow.toFixed(2)}</td>
                    <td class="px-4 py-3 text-right font-mono font-bold text-red-400">${Math.round(item.res.cost).toLocaleString()}</td>
                    <td class="px-4 py-3 text-right">
                        <button onclick="edit(${i})" class="text-cyan-400 mr-2 hover:text-white"><i data-lucide="pencil" class="w-4 h-4"></i></button>
                        <button onclick="del(${i})" class="text-red-400 hover:text-white"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                    </td>
                </tr>
            `;
        });

        if(LIST.length === 0) {
            tb.innerHTML = `<tr><td colspan="6" class="px-6 py-20 text-center text-slate-500"><i data-lucide="wind" class="w-12 h-12 mx-auto mb-3 opacity-20"></i><span>${TRANSLATIONS[currentLang].msg_empty}</span></td></tr>`;
        }

        // Dashboard Update
        document.getElementById('dashFlow').innerText = tFlow.toFixed(2);
        document.getElementById('dashPower').innerText = tPower.toFixed(1);
        document.getElementById('dashCost').innerText = currSym + " " + Math.round(tCost).toLocaleString();
        document.getElementById('dashCo2').innerHTML = tCo2.toFixed(1) + ' <span class="text-sm font-normal text-slate-500">Ton</span>';

        lucide.createIcons();
    }

    function printRep(){
        const T = TRANSLATIONS[currentLang];
        const d = new Date().toLocaleDateString(currentLang==='tr'?'tr-TR':'en-US');
        
        let tCost = 0;
        const tb = document.getElementById('rTable');
        tb.innerHTML = '';
        
        // BaÅŸlÄ±klar
        document.getElementById('rep_table_head').innerHTML = `
            <th class="w-8">#</th>
            <th class="w-24 text-center">${T.th_img}</th>
            <th class="text-left">${T.th_loc}</th>
            <th class="text-center w-24">${T.lbl_dia}</th>
            <th class="text-center w-24">${T.lbl_bar}</th>
            <th class="text-right text-cyan-600">${T.th_flow} (mÂ³/dk)</th>
            <th class="text-right text-red-600 font-black">${T.th_cost}</th>
        `;

        LIST.forEach((item, i) => {
            tCost += item.res.cost;
            const imgHtml = item.img 
                ? `<img src="${item.img}" class="w-20 h-20 object-cover rounded border border-slate-200 mx-auto">` 
                : `<div class="w-8 h-8 bg-slate-100 rounded mx-auto flex items-center justify-center text-[8px]">-</div>`;

            tb.innerHTML += `
                <tr>
                    <td class="text-center font-bold text-slate-400">${i+1}</td>
                    <td class="text-center py-2">${imgHtml}</td>
                    <td class="font-bold text-slate-800 align-middle">${item.loc}</td>
                    <td class="text-center font-mono text-slate-600 align-middle">${item.dia} mm</td>
                    <td class="text-center font-mono text-slate-600 align-middle">${item.bar} bar</td>
                    <td class="text-right font-mono text-cyan-600 font-bold align-middle">${item.res.flow.toFixed(2)}</td>
                    <td class="text-right font-mono text-red-600 font-black align-middle text-lg">${Math.round(item.res.cost).toLocaleString()}</td>
                </tr>
            `;
        });

        // Kapak Bilgileri
        document.getElementById('rep_title_top').innerHTML = T.rep_title_top;
        document.getElementById('rep_title_main').innerHTML = T.rep_title_main;
        document.getElementById('rep_client_lbl').innerText = T.rep_client_lbl;
        document.getElementById('rep_prep_lbl').innerText = T.rep_prep_lbl;
        document.getElementById('rep_p2_title').innerText = T.rep_p2_title;
        
        document.getElementById('covClient').innerText = document.getElementById('cName').value || "CLIENT";
        document.getElementById('covProv').innerText = document.getElementById('pName').value || "OPTIMIZI INC.";
        document.getElementById('rDate').innerText = d;
        
        const currSym = document.getElementById('curr').value;
        document.getElementById('covTotalCost').innerText = Math.round(tCost).toLocaleString();
        document.getElementById('covCurr').innerText = currSym + " / " + (currentLang==='tr'?'YIL KAYIP':'YEAR LOSS');

        setTimeout(() => { window.print(); }, 200);
    }

    // Sidebar Toggle
    function toggleMenu() {
        const sidebar = document.getElementById('sidebar');
        const backdrop = document.getElementById('backdrop');
        if (sidebar.classList.contains('-translate-x-full')) {
            sidebar.classList.remove('-translate-x-full');
            backdrop.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        } else {
            sidebar.classList.add('-translate-x-full');
            backdrop.classList.add('hidden');
            document.body.style.overflow = 'auto';
        }
    }
</script>
</body>
</html>
