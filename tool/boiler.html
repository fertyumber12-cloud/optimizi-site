<!DOCTYPE html>
<html lang="tr" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kazan Verimliliği Hesapla | Optimizi.App</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Supabase JS Library -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<!-- Authentication Guard -->
<script src="/auth-guard.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="icon" href="../favicon.png" type="image/png">
    <!-- AUTH GUARD - Sayfa Koruma -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="/auth-guard.js"></script>
    
    <!-- Flash Problemi Çözümü -->
    <style>
      body {
        opacity: 0;
        visibility: hidden;
      }
      body.auth-checked {
        opacity: 1;
        visibility: visible;
        transition: opacity 0.3s ease;
      }
    </style>
</head>
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                fontFamily: { sans: ['"Plus Jakarta Sans"', 'sans-serif'] },
                extend: {
                    colors: { slate: { 850: '#151e2e', 900: '#0f172a', 950: '#020617' } },
                    animation: {
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite'
                    }
                }
            }
        }
    </script>
    <style>
        body { 
            background: radial-gradient(ellipse at top, #1e1b4b 0%, #0f172a 40%, #020617 100%);
            color: #f1f5f9; min-height: 100vh;
        }
        .glass-card { 
            background-color: rgba(30, 41, 59, 0.6); 
            backdrop-filter: blur(16px); 
            border: 1px solid rgba(255, 255, 255, 0.08); 
            transition: all 0.3s ease;
        }
        .glass-input { 
            background-color: rgba(15, 23, 42, 0.6); 
            border: 1px solid rgba(255,255,255,0.1); 
            color: white;
            border-radius: 0.5rem; padding: 0.75rem; width: 100%; transition: all 0.2s;
        }
        .glass-input:focus { outline: none; border-color: #6366f1; background-color: rgba(15, 23, 42, 0.9); }
        select.glass-input { appearance: none; background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%2394a3b8' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e"); background-position: right 0.75rem center; background-repeat: no-repeat; background-size: 1.2em 1.2em; padding-right: 2.5rem; }
        
        /* Gelişmiş Ayarlar Animasyonu */
        #advanced-options { max-height: 0; overflow: hidden; transition: max-height 0.4s ease-out; }
        #advanced-options.open { max-height: 300px; }
        .arrow-icon { transition: transform 0.3s; }
        .open .arrow-icon { transform: rotate(180deg); }
    </style>
</head>
<body class="antialiased custom-scroll">

    <nav class="fixed w-full z-50 bg-slate-900/80 backdrop-blur-md border-b border-white/5">
        <div class="container mx-auto px-6 h-20 flex items-center justify-between">
            <a href="../index.html" class="flex items-center gap-3 group">
                <h1 class="text-xl font-bold text-white tracking-wide">Optimizi<span class="text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 to-cyan-400">.App</span></h1>
            </a>
            </div>
    </nav>

    <main class="pt-32 pb-20 container mx-auto px-6">
        
        <div class="text-center mb-12">
            <h1 class="text-3xl md:text-5xl font-black text-white mb-4">Kazan Verimliliği <span class="text-transparent bg-clip-text bg-gradient-to-r from-orange-400 to-red-500">Hesaplama</span></h1>
            <p class="text-slate-400 max-w-2xl mx-auto">Mevcut buhar kazanınızın gerçek verimini hesaplayın, ISO standartlarına göre enerji kayıplarınızı analiz edelim.</p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 max-w-6xl mx-auto">
            
            <div class="lg:col-span-2 glass-card rounded-2xl p-8 border-t-4 border-t-indigo-500">
                <div class="flex items-center gap-3 mb-6">
                    <div class="p-2 bg-indigo-500/10 rounded-lg text-indigo-400"><i data-lucide="sliders" class="w-6 h-6"></i></div>
                    <h3 class="text-xl font-bold text-white">İşletme Verileri</h3>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    
                    <div class="space-y-2">
                        <label class="text-xs font-bold text-slate-400 uppercase ml-1">Buhar Üretim Miktarı</label>
                        <div class="relative">
                            <input type="number" id="steamFlow" class="glass-input pr-16" placeholder="Örn: 5000" oninput="calculateEff()">
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-xs font-bold text-slate-500">kg/h</span>
                        </div>
                    </div>

                    <div class="space-y-2">
                        <label class="text-xs font-bold text-slate-400 uppercase ml-1">İşletme Basıncı (P)</label>
                        <div class="relative">
                            <input type="number" id="pressure" class="glass-input pr-16" placeholder="Örn: 8" value="8" oninput="calculateEff()">
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-xs font-bold text-slate-500">bar(g)</span>
                        </div>
                        <div class="text-[10px] text-slate-500 pl-1">Doymuş buhar sıcaklığı: <span id="satTemp" class="text-indigo-400">---</span> °C</div>
                    </div>

                    <div class="space-y-2">
                        <label class="text-xs font-bold text-slate-400 uppercase ml-1">Besi Suyu Sıcaklığı</label>
                        <div class="relative">
                            <input type="number" id="feedTemp" class="glass-input pr-16" placeholder="Örn: 85" value="85" oninput="calculateEff()">
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-xs font-bold text-slate-500">°C</span>
                        </div>
                    </div>

                    <div class="space-y-2">
                        <label class="text-xs font-bold text-slate-400 uppercase ml-1">Yakıt Türü</label>
                        <select id="fuelType" class="glass-input text-slate-300" onchange="updateFuelParams()">
                            <option value="gas" selected>Doğalgaz (8250 kcal/m³)</option>
                            <option value="lng">LNG (11500 kcal/kg)</option>
                            <option value="fueloil">Fuel-Oil No.6 (9600 kcal/kg)</option>
                            <option value="motorin">Motorin (10200 kcal/kg)</option>
                            <option value="komur">İthal Kömür (6000 kcal/kg)</option>
                            <option value="komur_yerli">Yerli Kömür (3500 kcal/kg)</option>
                            <option value="custom">Özel Yakıt Değeri</option>
                        </select>
                    </div>

                    <div class="space-y-2">
                        <label class="text-xs font-bold text-slate-400 uppercase ml-1">Yakıt Tüketimi</label>
                        <div class="relative">
                            <input type="number" id="fuelFlow" class="glass-input pr-16" placeholder="Örn: 400" oninput="calculateEff()">
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-xs font-bold text-slate-500" id="fuelUnit">m³/h</span>
                        </div>
                    </div>

                    <div class="space-y-2">
                        <label class="text-xs font-bold text-slate-400 uppercase ml-1">Alt Isıl Değer (LHV)</label>
                        <div class="relative">
                            <input type="number" id="calorificVal" class="glass-input pr-16" value="8250" oninput="calculateEff()">
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-xs font-bold text-slate-500" id="energyUnit">kcal/m³</span>
                        </div>
                    </div>
                </div>

                <div class="mt-8 border-t border-white/10 pt-4">
                    <button onclick="toggleAdvanced()" class="flex items-center gap-2 text-sm text-indigo-400 hover:text-indigo-300 font-bold transition group w-full">
                        <i data-lucide="chevron-down" class="w-4 h-4 arrow-icon group-hover:translate-y-0.5 transition-transform"></i>
                        Gelişmiş Seçenekler
                    </button>
                    
                    <div id="advanced-options" class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-0 opacity-0 transition-all duration-300">
                        <div class="space-y-2 mt-4">
                            <label class="text-xs font-bold text-slate-400 uppercase ml-1">Buhar Kuruluk Oranı (%)</label>
                            <div class="relative">
                                <input type="number" id="steamDryness" class="glass-input pr-16" value="100" max="100" oninput="calculateEff()">
                                <span class="absolute right-4 top-1/2 -translate-y-1/2 text-xs font-bold text-slate-500">%</span>
                            </div>
                            <div class="text-[10px] text-slate-500 pl-1">Düşük kuruluk, entalpiyi ve verimi düşürür.</div>
                        </div>

                        <div class="space-y-2 mt-4">
                            <label class="text-xs font-bold text-slate-400 uppercase ml-1">Blöf Oranı (Opsiyonel)</label>
                            <div class="relative">
                                <input type="number" id="blowdownRate" class="glass-input pr-16" value="0" oninput="calculateEff()">
                                <span class="absolute right-4 top-1/2 -translate-y-1/2 text-xs font-bold text-slate-500">%</span>
                            </div>
                            <div class="text-[10px] text-slate-500 pl-1">Kazan yüzey blöfü. Kayıp hesabına eklenir.</div>
                        </div>
                    </div>
                </div>

            </div>

            <div class="lg:col-span-1 space-y-6">
                
                <div class="glass-card p-6 rounded-2xl border-t-4 border-t-green-500 text-center relative overflow-hidden">
                    <div class="absolute inset-0 bg-green-500/5 blur-xl"></div>
                    <div class="relative z-10">
                        <h4 class="text-sm font-bold text-slate-400 uppercase tracking-widest mb-2">Hesaplanan Verim</h4>
                        <div class="text-6xl font-black text-white tracking-tighter mb-1" id="resultEff">0<span class="text-2xl text-slate-500">%</span></div>
                        <div class="inline-block px-3 py-1 rounded-full bg-slate-800 border border-slate-700 text-[10px] text-slate-400 font-mono" id="effStatus">VERİ BEKLENİYOR</div>
                    </div>
                </div>

                <div class="glass-card p-6 rounded-2xl space-y-4">
                    <h4 class="text-xs font-bold text-slate-400 uppercase border-b border-white/10 pb-2">Enerji Dengesi</h4>
                    
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-slate-300">Faydalı Enerji (Output)</span>
                        <div class="text-right">
                            <div class="text-sm font-bold text-white" id="energyOutput">0</div>
                            <div class="text-[10px] text-slate-500">kcal/h</div>
                        </div>
                    </div>

                    <div class="flex justify-between items-center">
                        <span class="text-sm text-slate-300">Yakıt Enerjisi (Input)</span>
                        <div class="text-right">
                            <div class="text-sm font-bold text-white" id="energyInput">0</div>
                            <div class="text-[10px] text-slate-500">kcal/h</div>
                        </div>
                    </div>
                    
                    <div class="mt-4 pt-4 border-t border-white/10">
                        <div class="text-[10px] text-slate-500 italic text-center">
                            *Hesaplamalar Direkt Metot (Girdi/Çıktı) kullanılarak yapılmıştır. Entalpi değerleri basınç ve kuruluk oranına göre otomatik hesaplanmaktadır.
                        </div>
                    </div>
                </div>

                <a href="../contact.html" class="block w-full py-4 rounded-xl bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-500 hover:to-red-500 text-white font-bold text-center shadow-lg shadow-orange-900/20 transition active:scale-95">
                    Verim Çok mu Düşük? <br><span class="text-xs font-normal opacity-90">Ücretsiz Check-Up Talep Et</span>
                </a>

            </div>

        </div>
    </main>

    <script>
        lucide.createIcons();

        function toggleAdvanced() {
            const el = document.getElementById('advanced-options');
            el.classList.toggle('open');
            if(el.classList.contains('open')) {
                el.style.opacity = "1";
                el.style.marginTop = "1rem";
            } else {
                el.style.opacity = "0";
                el.style.marginTop = "0";
            }
        }

        // BUHAR TABLOSU (Yaklaşık Formülasyon)
        function getSteamProperties(barG, dryness = 100) {
            const P_abs = parseFloat(barG) + 1.013;
            
            // Doymuş Buhar Sıcaklığı
            const T_sat = 99.63 + 30 * Math.log(P_abs) + 1.5 * Math.pow(Math.log(P_abs), 2);
            
            // Doymuş Sıvı Entalpisi (hf) ≈ T_sat (kcal/kg) (Pratikte çok yakındır)
            const h_f = T_sat; 
            
            // Doymuş Buhar Entalpisi (hg)
            // 0-20 bar arası curve fit
            const h_g = 639.0 + (3.0 * Math.pow(P_abs, 0.45));
            
            // Buharlaşma Isısı (hfg)
            const h_fg = h_g - h_f;

            // Kuruluk derecesine göre gerçek entalpi (h_x)
            // h_x = h_f + (x * h_fg)
            const x = dryness / 100;
            const h_real = h_f + (x * h_fg);

            return { temp: T_sat, hg: h_g, h_real: h_real };
        }

        const FUELS = {
            gas: { val: 8250, unit: 'm³', eUnit: 'kcal/m³' },
            lng: { val: 11500, unit: 'kg', eUnit: 'kcal/kg' },
            fueloil: { val: 9600, unit: 'kg', eUnit: 'kcal/kg' },
            motorin: { val: 10200, unit: 'kg', eUnit: 'kcal/kg' },
            komur: { val: 6000, unit: 'kg', eUnit: 'kcal/kg' },
            komur_yerli: { val: 3500, unit: 'kg', eUnit: 'kcal/kg' },
            custom: { val: 0, unit: 'birim', eUnit: 'kcal/birim' }
        };

        function updateFuelParams() {
            const type = document.getElementById('fuelType').value;
            const data = FUELS[type];
            if(type !== 'custom') {
                document.getElementById('calorificVal').value = data.val;
            }
            document.getElementById('fuelUnit').innerText = data.unit + "/h";
            document.getElementById('energyUnit').innerText = data.eUnit;
            calculateEff();
        }

        function calculateEff() {
            const m_steam = parseFloat(document.getElementById('steamFlow').value) || 0;
            const P_bar = parseFloat(document.getElementById('pressure').value) || 0;
            const T_feed = parseFloat(document.getElementById('feedTemp').value) || 20;
            
            const m_fuel = parseFloat(document.getElementById('fuelFlow').value) || 0;
            const LHV = parseFloat(document.getElementById('calorificVal').value) || 0;
            
            // Gelişmiş Ayarlar
            const dryness = parseFloat(document.getElementById('steamDryness').value) || 100;
            
            // 1. Buhar Özellikleri
            const steamProps = getSteamProperties(P_bar, dryness);
            document.getElementById('satTemp').innerText = steamProps.temp.toFixed(1);

            if(m_steam > 0 && m_fuel > 0 && LHV > 0) {
                // 2. Enerji Çıktısı (Heat Output)
                // Q_out = m_steam * (h_steam_real - h_feed)
                const h_feed = T_feed; 
                const Q_out = m_steam * (steamProps.h_real - h_feed);

                // 3. Enerji Girdisi (Heat Input)
                const Q_in = m_fuel * LHV;

                // 4. Verim
                let eff = (Q_out / Q_in) * 100;

                // UI Güncelleme
                document.getElementById('energyOutput').innerText = Math.round(Q_out).toLocaleString();
                document.getElementById('energyInput').innerText = Math.round(Q_in).toLocaleString();
                
                if(eff > 100) eff = 100;
                if(eff < 0) eff = 0;

                document.getElementById('resultEff').innerHTML = eff.toFixed(1) + '<span class="text-2xl text-slate-500">%</span>';

                const statusEl = document.getElementById('effStatus');
                if(eff > 90) {
                    statusEl.innerText = "MÜKEMMEL VERİM";
                    statusEl.className = "inline-block px-3 py-1 rounded-full bg-green-900/50 border border-green-500 text-[10px] text-green-400 font-bold";
                } else if(eff > 80) {
                    statusEl.innerText = "STANDART PERFORMANS";
                    statusEl.className = "inline-block px-3 py-1 rounded-full bg-blue-900/50 border border-blue-500 text-[10px] text-blue-400 font-bold";
                } else {
                    statusEl.innerText = "KRİTİK KAYIP VAR!";
                    statusEl.className = "inline-block px-3 py-1 rounded-full bg-red-900/50 border border-red-500 text-[10px] text-red-400 font-bold animate-pulse";
                }

            } else {
                document.getElementById('resultEff').innerHTML = '0<span class="text-2xl text-slate-500">%</span>';
                document.getElementById('energyOutput').innerText = "0";
                document.getElementById('energyInput').innerText = "0";
            }
        }

        // Başlangıç
        calculateEff();
    </script>
    <script src="guard.js?v=2"></script>
</body>

</html>


