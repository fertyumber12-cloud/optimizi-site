<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>YoÄŸuÅŸma Hesaplama</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
<link rel="icon" href="../favicon.png" type="image/png">
<script>
  tailwind.config = {
    theme: {
      fontFamily: { sans: ['"Plus Jakarta Sans"', 'sans-serif'], mono: ['"JetBrains Mono"', 'monospace'] },
      extend: {
        colors: { slate: { 850: '#151e2e', 900: '#0f172a', 950: '#020617' } },
        boxShadow: { 'print': '0 1px 0px rgba(0,0,0,0.05)' }
      }
    }
  }
</script>

<style>
  :root {
    --bg-color: #fdfdfd; 
    --glass-bg: rgba(255, 255, 255, 0.85);
    --glass-border: rgba(14, 165, 233, 0.15);
    --input-bg: #ffffff;
    --input-border: #bae6fd;
    --text-main: #1e293b; 
    --card-shadow: 0 4px 20px -4px rgba(14, 165, 233, 0.1);
  }

  body { 
    background-color: var(--bg-color);
    background-image: linear-gradient(rgba(14, 165, 233, 0.03) 1px, transparent 1px),
    linear-gradient(90deg, rgba(14, 165, 233, 0.03) 1px, transparent 1px);
    background-size: 20px 20px;
    color: var(--text-main); 
    overflow-x: hidden; 
  }

  .glass-card { 
    background-color: var(--glass-bg); 
    backdrop-filter: blur(12px); 
    border: 1px solid var(--glass-border); 
    box-shadow: var(--card-shadow);
    transition: all 0.3s ease;
  }

  .glass-input { 
    transition: all 0.2s; border-radius: 0.5rem; padding: 0.5rem 0.7rem; width: 100%; 
    background-color: var(--input-bg); border: 1px solid var(--input-border); color: var(--text-main);
    font-size: 0.8rem;
  }
  .glass-input:focus { outline: none; border-color: #06b6d4; box-shadow: 0 0 0 3px rgba(6, 182, 212, 0.1); }

  .selection-card {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    cursor: pointer;
    border: 2px solid transparent;
  }
  
  .selection-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 12px 24px -8px rgba(6, 182, 212, 0.2);
    border-color: #06b6d4;
  }
  
  .selection-card.safe {
    border-color: #10b981;
    background: linear-gradient(135deg, rgba(16, 185, 129, 0.05) 0%, rgba(5, 150, 105, 0.05) 100%);
  }
  
  .selection-card.insufficient {
    border-color: #ef4444;
    background: linear-gradient(135deg, rgba(239, 68, 68, 0.05) 0%, rgba(220, 38, 38, 0.05) 100%);
  }

  .added-item {
    animation: slideIn 0.3s ease-out;
  }

  @keyframes slideIn {
    from {
      opacity: 0;
      transform: translateX(-20px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  /* Custom scrollbar */
  #selectionArea::-webkit-scrollbar,
  #selectedList::-webkit-scrollbar {
    width: 6px;
  }

  #selectionArea::-webkit-scrollbar-track,
  #selectedList::-webkit-scrollbar-track {
    background: #f1f5f9;
    border-radius: 10px;
  }

  #selectionArea::-webkit-scrollbar-thumb,
  #selectedList::-webkit-scrollbar-thumb {
    background: #cbd5e1;
    border-radius: 10px;
  }

  #selectionArea::-webkit-scrollbar-thumb:hover,
  #selectedList::-webkit-scrollbar-thumb:hover {
    background: #94a3b8;
  }

  /* Print styles */
  @media print {
    @page { margin: 0; size: A4; } 
    html, body { height: 100%; background: white; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    
    .main-interface, nav { display: none !important; }
    #print-wrapper { display: block !important; }
    
    .print-page { 
      page-break-after: always; 
      page-break-inside: avoid;
      padding: 35px 45px 45px 45px;
      height: 297mm;
      width: 210mm;
      box-sizing: border-box;
      background: white;
      position: relative;
      overflow: hidden;
    }
    
    .print-page:last-child { page-break-after: auto; }
    
    .cover-bg {
      background-color: white !important;
      color: #1e293b !important;
      padding: 0 !important;
    }
    
    .cover-accent {
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 12mm;
      background: linear-gradient(180deg, #06b6d4, #3b82f6);
      z-index: 0;
    }
    
    .cover-content {
      position: relative;
      z-index: 10;
      height: 100%;
      padding: 20mm 20mm 20mm 35mm;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    
    .print-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-bottom: 10px;
      border-bottom: 2px solid #e0e7ff;
      margin-bottom: 16px;
    }

    .print-section {
      margin-bottom: 14px;
      page-break-inside: avoid;
      break-inside: avoid;
      orphans: 3;
      widows: 3;
    }
    
    .audit-table {
      width: 100%;
      border-collapse: collapse;
      margin: 10px 0;
      font-size: 8px;
      page-break-inside: auto;
    }

    .audit-table th {
      background-color: #ecfeff !important;
      color: #0891b2 !important;
      font-weight: 700;
      text-transform: uppercase;
      font-size: 6.5px;
      padding: 5px;
      border: 1px solid #cffafe !important;
      text-align: left;
    }

    .audit-table td {
      padding: 5px;
      border: 1px solid #e2e8f0 !important;
      color: #1e293b !important;
      vertical-align: top;
    }

    .audit-table tr:nth-child(even) {
      background-color: #f8fafc !important;
    }

    .print-footer {
      position: absolute; 
      bottom: 18px; 
      left: 45px; 
      right: 45px; 
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
      border-top: 1px solid #e2e8f0; 
      padding-top: 6px;
    }
  }
</style>
</head>
<body>

<!-- NAV -->
<nav class="glass-card sticky top-3 mx-4 mb-6 z-50 rounded-2xl p-4 shadow-xl">
  <div class="max-w-7xl mx-auto flex items-center justify-between">
    <div class="flex items-center space-x-2">
      <div class="w-9 h-9 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-xl flex items-center justify-center shadow-lg">
        <i data-lucide="droplets" class="w-5 h-5 text-white"></i>
      </div>
      <div>
        <h1 class="text-xl font-black bg-gradient-to-r from-cyan-600 to-blue-600 bg-clip-text text-transparent">Optimizi.App</h1>
        <p class="text-xs text-slate-500 font-semibold">YoÄŸuÅŸma KontrolÃ¼</p>
      </div>
    </div>
  </div>
</nav>

<!-- MAIN INTERFACE -->
<div class="main-interface max-w-7xl mx-auto px-4 pb-12">
  
  <!-- GÄ°RÄ°Å PARAMETRELERÄ° -->
  <div class="glass-card rounded-2xl p-6 mb-6 shadow-2xl">
    <div class="flex items-center mb-4">
      <div class="w-10 h-10 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl flex items-center justify-center mr-3 shadow-lg">
        <i data-lucide="sliders" class="w-5 h-5 text-white"></i>
      </div>
      <h2 class="text-xl font-black text-slate-900">Sistem Parametreleri</h2>
    </div>

    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
      <div>
        <label class="block text-xs font-bold text-slate-700 mb-1.5 uppercase tracking-wide">Boru Ã‡apÄ± (DN)</label>
        <select id="dn" onchange="calculate()" class="glass-input font-mono font-bold">
          <!-- Dinamik olarak doldurulacak -->
        </select>
      </div>

      <div>
        <label class="block text-xs font-bold text-slate-700 mb-1.5 uppercase tracking-wide">Ortam SÄ±c. (Â°C)</label>
        <input type="number" id="t_ort" value="25" onchange="calculate()" class="glass-input font-mono font-bold">
      </div>

      <div>
        <label class="block text-xs font-bold text-slate-700 mb-1.5 uppercase tracking-wide">BaÄŸÄ±l Nem (%)</label>
        <input type="number" id="rh" value="70" min="0" max="100" onchange="calculate()" class="glass-input font-mono font-bold">
      </div>

      <div>
        <label class="block text-xs font-bold text-slate-700 mb-1.5 uppercase tracking-wide">Ä°Ã§ AkÄ±ÅŸ. SÄ±c. (Â°C)</label>
        <input type="number" id="t_ic" value="7" onchange="calculate()" class="glass-input font-mono font-bold">
      </div>

      <div>
        <label class="block text-xs font-bold text-slate-700 mb-1.5 uppercase tracking-wide">Hava HÄ±zÄ± (m/s)</label>
        <input type="number" id="v_hava" value="0.5" step="0.1" min="0" onchange="calculate()" class="glass-input font-mono font-bold">
      </div>

      <div>
        <label class="block text-xs font-bold text-slate-700 mb-1.5 uppercase tracking-wide">Emisivite (Îµ)</label>
        <input type="number" id="emis" value="0.9" step="0.05" min="0.1" max="1" onchange="calculate()" class="glass-input font-mono font-bold">
      </div>

      <div>
        <label class="block text-xs font-bold text-slate-700 mb-1.5 uppercase tracking-wide">Boru Uzun. (m)</label>
        <input type="number" id="pipe_length" value="1" step="0.1" min="0.1" onchange="calculate()" class="glass-input font-mono font-bold">
      </div>

      <div>
        <label class="block text-xs font-bold text-slate-700 mb-1.5 uppercase tracking-wide">GÃ¼v. MarjÄ± (Â°C)</label>
        <input type="number" id="safety_margin" value="3" step="0.5" min="0" onchange="calculate()" class="glass-input font-mono font-bold">
      </div>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    
    <!-- SOL: HESAPLAMA SONUÃ‡LARI + MANUEL -->
    <div class="lg:col-span-1 space-y-6">
      
      <!-- HESAPLAMA SONUÃ‡LARI -->
      <div class="glass-card rounded-2xl p-5 shadow-2xl">
        <div class="flex items-center mb-4">
          <div class="w-9 h-9 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-xl flex items-center justify-center mr-3 shadow-lg">
            <i data-lucide="calculator" class="w-5 h-5 text-white"></i>
          </div>
          <h2 class="text-lg font-black text-slate-900">SonuÃ§lar</h2>
        </div>

        <div id="results" class="space-y-3">
          <!-- Dinamik olarak doldurulacak -->
        </div>
      </div>

      <!-- MANUEL HESAPLAMA -->
      <div class="glass-card rounded-2xl p-5 shadow-2xl">
        <div class="flex items-center mb-4">
          <div class="w-9 h-9 bg-gradient-to-br from-amber-500 to-orange-600 rounded-xl flex items-center justify-center mr-3 shadow-lg">
            <i data-lucide="ruler" class="w-5 h-5 text-white"></i>
          </div>
          <h2 class="text-lg font-black text-slate-900">Manuel Hesap</h2>
        </div>

        <div class="space-y-3">
          <div>
            <label class="block text-xs font-bold text-slate-700 mb-1.5 uppercase tracking-wide">Dolgu Malzemesi</label>
            <select id="manual_insulation" class="glass-input font-mono font-bold text-xs">
              <!-- Dinamik olarak doldurulacak -->
            </select>
          </div>

          <div>
            <label class="block text-xs font-bold text-slate-700 mb-1.5 uppercase tracking-wide">KalÄ±nlÄ±k (mm)</label>
            <input type="number" id="manual_thickness" value="30" min="1" max="200" step="1" class="glass-input font-mono font-bold">
          </div>

          <button onclick="calculateManual()" class="w-full bg-gradient-to-r from-amber-500 to-orange-600 text-white font-black py-2.5 px-4 rounded-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105 text-sm">
            <i data-lucide="play" class="w-4 h-4 inline mr-1"></i>
            Hesapla
          </button>
        </div>

        <div id="manualResults" class="hidden mt-4">
          <div class="bg-gradient-to-br from-slate-50 to-slate-100 rounded-xl p-4 border-2 border-slate-200">
            <h3 class="text-xs font-black text-slate-700 mb-2 uppercase tracking-wide">SonuÃ§</h3>
            <div class="space-y-1.5 text-xs mb-3">
              <div class="flex justify-between">
                <span class="text-slate-600">YÃ¼zey SÄ±c.:</span>
                <span id="manual_surface_temp" class="font-mono font-bold text-slate-900"></span>
              </div>
              <div class="flex justify-between">
                <span class="text-slate-600">Ã‡iÄŸ NoktasÄ±:</span>
                <span id="manual_dew_point" class="font-mono font-bold text-slate-900"></span>
              </div>
              <div class="flex justify-between">
                <span class="text-slate-600">Fark:</span>
                <span id="manual_diff" class="font-mono font-bold text-slate-900"></span>
              </div>
              <div class="flex justify-between">
                <span class="text-slate-600">IsÄ± KaybÄ±:</span>
                <span id="manual_heat_loss" class="font-mono font-bold text-slate-900"></span>
              </div>
            </div>
            <div id="manual_status" class="rounded-lg p-3 text-center text-xs">
              <!-- Dinamik olarak doldurulacak -->
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- SAÄ: OTOMATÄ°K Ã‡Ã–ZÃœMLER -->
    <div class="lg:col-span-2 glass-card rounded-2xl p-5 shadow-2xl">
      <div class="flex items-center justify-between mb-4">
        <div class="flex items-center">
          <div class="w-9 h-9 bg-gradient-to-br from-emerald-500 to-teal-600 rounded-xl flex items-center justify-center mr-3 shadow-lg">
            <i data-lucide="layers" class="w-5 h-5 text-white"></i>
          </div>
          <h2 class="text-lg font-black text-slate-900">Otomatik Ã‡Ã¶zÃ¼mler</h2>
        </div>
      </div>

      <div id="selectionArea" class="grid grid-cols-2 md:grid-cols-3 gap-3 max-h-[500px] overflow-y-auto pr-2 mb-4">
        <!-- Dinamik olarak doldurulacak -->
      </div>

      <div class="border-t-2 border-slate-200 pt-4">
        <div class="flex items-center justify-between mb-3">
          <h3 class="text-base font-black text-slate-900">SeÃ§ili Ã‡Ã¶zÃ¼mler</h3>
          <button onclick="generateReport()" class="bg-gradient-to-r from-violet-600 to-purple-600 text-white font-black py-2 px-5 rounded-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105 flex items-center space-x-1.5 text-sm">
            <i data-lucide="file-text" class="w-4 h-4"></i>
            <span>PDF Rapor</span>
          </button>
        </div>

        <div id="selectedList" class="space-y-2.5 max-h-[300px] overflow-y-auto pr-2">
          <div class="text-center text-slate-400 py-8">
            <i data-lucide="inbox" class="w-12 h-12 mx-auto mb-3 opacity-50"></i>
            <p class="font-bold text-sm">HenÃ¼z Ã§Ã¶zÃ¼m seÃ§ilmedi</p>
            <p class="text-xs mt-1">YukarÄ±daki kartlardan seÃ§in</p>
          </div>
        </div>
      </div>
    </div>

  </div>

</div>

<!-- PRINT WRAPPER (Hidden) -->
<div id="print-wrapper" style="display: none;"></div>

<script>
// ====================================
// VERÄ° TANIMLARI
// ====================================
const PIPES = {
  25: 33.7, 32: 42.4, 40: 48.3, 50: 60.3, 65: 76.1, 80: 88.9,
  100: 114.3, 125: 139.7, 150: 168.3, 200: 219.1, 250: 273, 300: 323.9
};

const INSULATIONS = [
  { name: 'Elastomerik KauÃ§uk', lambda: 0.037, thicknesses: [9, 13, 19, 25, 32] },
  { name: 'TaÅŸyÃ¼nÃ¼ (Rockwool)', lambda: 0.040, thicknesses: [30, 40, 50, 60, 80, 100] },
  { name: 'CamyÃ¼nÃ¼ (Glasswool)', lambda: 0.038, thicknesses: [30, 40, 50, 60, 80, 100] },
  { name: 'PoliÃ¼retan (PUR)', lambda: 0.028, thicknesses: [30, 40, 50, 60, 80] },
  { name: 'PoliizosiyonÃ¼rat (PIR)', lambda: 0.025, thicknesses: [30, 40, 50, 60, 80] },
  { name: 'Aerogel', lambda: 0.015, thicknesses: [5, 10, 15, 20] }
];

let selectedSolutions = [];

// ====================================
// HESAPLAMA FONKSÄ°YONLARI
// ====================================
function calculateDewPoint(t, rh) {
  const a = 17.27;
  const b = 237.7;
  const alpha = ((a * t) / (b + t)) + Math.log(rh / 100);
  return (b * alpha) / (a - alpha);
}

function calculateConvectionCoeff(v) {
  return 10.45 - v + 10 * Math.sqrt(v);
}

function calculateRadiationCoeff(t_surf, t_amb, emis) {
  const sigma = 5.67e-8;
  const T_surf_K = t_surf + 273.15;
  const T_amb_K = t_amb + 273.15;
  return emis * sigma * (Math.pow(T_surf_K, 2) + Math.pow(T_amb_K, 2)) * (T_surf_K + T_amb_K);
}

function calculateSurfaceTemp(r1, r2, lambda, t_ic, t_ort, h_conv, h_rad, L) {
  const R_ins = Math.log(r2 / r1) / (2 * Math.PI * lambda * L);
  const R_ext = 1 / (2 * Math.PI * r2 * (h_conv + h_rad) * L);
  
  const iterations = 10;
  let t_surf = t_ort;
  
  for (let i = 0; i < iterations; i++) {
    const h_rad_calc = calculateRadiationCoeff(t_surf, t_ort, 0.9);
    const R_ext_new = 1 / (2 * Math.PI * r2 * (h_conv + h_rad_calc) * L);
    const R_total = R_ins + R_ext_new;
    t_surf = t_ic + (t_ort - t_ic) * (R_ins / R_total);
  }
  
  return t_surf;
}

function calculateHeatLoss(r1, r2, lambda, t_ic, t_surf, L) {
  const R_ins = Math.log(r2 / r1) / (2 * Math.PI * lambda * L);
  return (t_surf - t_ic) / R_ins;
}

// ====================================
// ANA HESAPLAMA
// ====================================
function calculate() {
  const dn = parseInt(document.getElementById('dn').value);
  const t_ort = parseFloat(document.getElementById('t_ort').value);
  const rh = parseFloat(document.getElementById('rh').value);
  const t_ic = parseFloat(document.getElementById('t_ic').value);
  const v_hava = parseFloat(document.getElementById('v_hava').value);
  const emis = parseFloat(document.getElementById('emis').value);
  const L = parseFloat(document.getElementById('pipe_length').value);
  const safety_margin = parseFloat(document.getElementById('safety_margin').value);

  const od = PIPES[dn];
  const r1 = od / 2000; // mm -> m
  
  const t_dew = calculateDewPoint(t_ort, rh);
  const h_conv = calculateConvectionCoeff(v_hava);

  // SONUÃ‡LARI GÃ–STER
  const resultsDiv = document.getElementById('results');
  resultsDiv.innerHTML = `
    <div class="bg-gradient-to-br from-blue-50 to-cyan-50 rounded-xl p-4 border-2 border-blue-200">
      <div class="text-xs font-bold text-blue-700 uppercase tracking-wide mb-1">Ã‡iÄŸ NoktasÄ±</div>
      <div class="text-2xl font-black text-blue-900">${t_dew.toFixed(2)}Â°C</div>
    </div>
    
    <div class="bg-gradient-to-br from-emerald-50 to-teal-50 rounded-xl p-4 border-2 border-emerald-200">
      <div class="text-xs font-bold text-emerald-700 uppercase tracking-wide mb-1">Min. YÃ¼zey SÄ±c.</div>
      <div class="text-2xl font-black text-emerald-900">${(t_dew + safety_margin).toFixed(2)}Â°C</div>
    </div>
    
    <div class="bg-gradient-to-br from-purple-50 to-violet-50 rounded-xl p-4 border-2 border-purple-200">
      <div class="text-xs font-bold text-purple-700 uppercase tracking-wide mb-1">Konveksiyon Kat.</div>
      <div class="text-2xl font-black text-purple-900">${h_conv.toFixed(2)}</div>
      <div class="text-xs text-purple-600 font-semibold">W/mÂ²K</div>
    </div>
  `;

  // Ã‡Ã–ZÃœM ÃœRETÄ°MÄ°
  const solutions = [];
  
  INSULATIONS.forEach(mat => {
    mat.thicknesses.forEach(thick => {
      const r2 = r1 + thick / 1000;
      const h_rad = calculateRadiationCoeff(t_ort, t_ort, emis);
      const t_surf = calculateSurfaceTemp(r1, r2, mat.lambda, t_ic, t_ort, h_conv, h_rad, L);
      const q_loss = calculateHeatLoss(r1, r2, mat.lambda, t_ic, t_surf, L);
      const safe = t_surf >= (t_dew + safety_margin);
      
      solutions.push({
        material: mat.name,
        lambda: mat.lambda,
        thickness: thick,
        surfaceTemp: t_surf,
        heatLoss: q_loss,
        safe: safe,
        dewPoint: t_dew,
        minTemp: t_dew + safety_margin
      });
    });
  });

  // KARTLARI GÃ–STER
  const selectionArea = document.getElementById('selectionArea');
  selectionArea.innerHTML = '';
  
  solutions.forEach((sol, idx) => {
    const card = document.createElement('div');
    card.className = `selection-card glass-card rounded-xl p-4 ${sol.safe ? 'safe' : 'insufficient'}`;
    card.onclick = () => toggleSelection(sol, card);
    
    const statusBadge = sol.safe
      ? '<div class="inline-flex items-center space-x-1 bg-emerald-500 text-white px-2 py-0.5 rounded-full text-xs font-black"><i data-lucide="check" class="w-3 h-3"></i><span>GÃœVENLÄ°</span></div>'
      : '<div class="inline-flex items-center space-x-1 bg-red-500 text-white px-2 py-0.5 rounded-full text-xs font-black"><i data-lucide="x" class="w-3 h-3"></i><span>YETERSÄ°Z</span></div>';
    
    card.innerHTML = `
      <div class="flex items-start justify-between mb-3">
        <div>
          <h3 class="text-sm font-black text-slate-900">${sol.material}</h3>
          <p class="text-xs text-slate-500 font-semibold">Î»=${sol.lambda}</p>
        </div>
        ${statusBadge}
      </div>
      
      <div class="bg-white bg-opacity-50 rounded-lg p-3 mb-3">
        <div class="text-2xl font-black text-cyan-600 mb-0.5">${sol.thickness} mm</div>
        <div class="text-xs text-slate-600 font-bold">KalÄ±nlÄ±k</div>
      </div>
      
      <div class="space-y-1 text-xs">
        <div class="flex justify-between">
          <span class="text-slate-600">YÃ¼zey:</span>
          <span class="font-mono font-bold ${sol.safe ? 'text-emerald-600' : 'text-red-600'}">${sol.surfaceTemp.toFixed(2)}Â°C</span>
        </div>
        <div class="flex justify-between">
          <span class="text-slate-600">Min:</span>
          <span class="font-mono font-bold text-slate-900">${sol.minTemp.toFixed(2)}Â°C</span>
        </div>
        <div class="flex justify-between">
          <span class="text-slate-600">KayÄ±p:</span>
          <span class="font-mono font-bold text-slate-900">${Math.abs(sol.heatLoss).toFixed(2)}W</span>
        </div>
      </div>
    `;
    
    selectionArea.appendChild(card);
  });
  
  lucide.createIcons();
}

// ====================================
// MANUEL HESAPLAMA
// ====================================
function calculateManual() {
  const dn = parseInt(document.getElementById('dn').value);
  const t_ort = parseFloat(document.getElementById('t_ort').value);
  const rh = parseFloat(document.getElementById('rh').value);
  const t_ic = parseFloat(document.getElementById('t_ic').value);
  const v_hava = parseFloat(document.getElementById('v_hava').value);
  const emis = parseFloat(document.getElementById('emis').value);
  const L = parseFloat(document.getElementById('pipe_length').value);
  const safety_margin = parseFloat(document.getElementById('safety_margin').value);
  
  const manualSelect = document.getElementById('manual_insulation');
  const lambda = parseFloat(manualSelect.value);
  const thickness = parseFloat(document.getElementById('manual_thickness').value);
  
  const od = PIPES[dn];
  const r1 = od / 2000;
  const r2 = r1 + thickness / 1000;
  
  const t_dew = calculateDewPoint(t_ort, rh);
  const h_conv = calculateConvectionCoeff(v_hava);
  const h_rad = calculateRadiationCoeff(t_ort, t_ort, emis);
  const t_surf = calculateSurfaceTemp(r1, r2, lambda, t_ic, t_ort, h_conv, h_rad, L);
  const q_loss = calculateHeatLoss(r1, r2, lambda, t_ic, t_surf, L);
  const min_temp = t_dew + safety_margin;
  const safe = t_surf >= min_temp;
  const diff = t_surf - t_dew;
  
  // SonuÃ§larÄ± gÃ¶ster
  document.getElementById('manual_surface_temp').textContent = `${t_surf.toFixed(2)}Â°C`;
  document.getElementById('manual_dew_point').textContent = `${t_dew.toFixed(2)}Â°C`;
  document.getElementById('manual_diff').textContent = `${diff.toFixed(2)}Â°C`;
  document.getElementById('manual_heat_loss').textContent = `${Math.abs(q_loss).toFixed(2)} W`;
  
  const statusDiv = document.getElementById('manual_status');
  if (safe) {
    statusDiv.className = 'rounded-lg p-3 text-center bg-gradient-to-br from-emerald-50 to-green-50 border-2 border-emerald-500';
    statusDiv.innerHTML = `
      <div class="flex items-center justify-center space-x-2 mb-1">
        <i data-lucide="check-circle" class="w-6 h-6 text-emerald-600"></i>
        <span class="text-lg font-black text-emerald-900">GÃœVENLÄ°</span>
      </div>
      <p class="text-xs text-emerald-700">YoÄŸuÅŸma Ã¶nleme iÃ§in yeterli</p>
      <p class="text-xs text-emerald-600 mt-1 font-bold">MarjÄ±: +${(t_surf - min_temp).toFixed(2)}Â°C</p>
    `;
  } else {
    statusDiv.className = 'rounded-lg p-3 text-center bg-gradient-to-br from-red-50 to-orange-50 border-2 border-red-500';
    statusDiv.innerHTML = `
      <div class="flex items-center justify-center space-x-2 mb-1">
        <i data-lucide="alert-triangle" class="w-6 h-6 text-red-600"></i>
        <span class="text-lg font-black text-red-900">YETERSÄ°Z</span>
      </div>
      <p class="text-xs text-red-700">YoÄŸuÅŸma Ã¶nleme iÃ§in yetersiz</p>
      <p class="text-xs text-red-600 mt-1 font-bold">Eksik: ${(min_temp - t_surf).toFixed(2)}Â°C</p>
    `;
  }
  
  document.getElementById('manualResults').classList.remove('hidden');
  lucide.createIcons();
}

// ====================================
// SEÃ‡Ä°M YÃ–NETÄ°MÄ°
// ====================================
function toggleSelection(solution, cardElement) {
  const exists = selectedSolutions.find(s => 
    s.material === solution.material && s.thickness === solution.thickness
  );
  
  if (exists) {
    selectedSolutions = selectedSolutions.filter(s => 
      !(s.material === solution.material && s.thickness === solution.thickness)
    );
    showNotification(`${solution.material} ${solution.thickness}mm kaldÄ±rÄ±ldÄ±`, 'info');
  } else {
    selectedSolutions.push(solution);
    showNotification(`${solution.material} ${solution.thickness}mm eklendi`, 'success');
  }
  
  updateSelectedList();
}

function updateSelectedList() {
  const listDiv = document.getElementById('selectedList');
  
  if (selectedSolutions.length === 0) {
    listDiv.innerHTML = `
      <div class="text-center text-slate-400 py-8">
        <i data-lucide="inbox" class="w-12 h-12 mx-auto mb-3 opacity-50"></i>
        <p class="font-bold text-sm">HenÃ¼z Ã§Ã¶zÃ¼m seÃ§ilmedi</p>
        <p class="text-xs mt-1">YukarÄ±daki kartlardan seÃ§in</p>
      </div>
    `;
  } else {
    listDiv.innerHTML = selectedSolutions.map((sol, idx) => `
      <div class="added-item glass-card rounded-xl p-3 flex items-center justify-between">
        <div class="flex-1">
          <div class="flex items-center space-x-2 mb-1.5">
            <h4 class="text-sm font-black text-slate-900">${sol.material} - ${sol.thickness}mm</h4>
            ${sol.safe 
              ? '<span class="inline-flex items-center bg-emerald-500 text-white px-1.5 py-0.5 rounded text-xs font-black">âœ“</span>'
              : '<span class="inline-flex items-center bg-red-500 text-white px-1.5 py-0.5 rounded text-xs font-black">âœ—</span>'
            }
          </div>
          <div class="grid grid-cols-3 gap-2 text-xs">
            <div>
              <span class="text-slate-600">YÃ¼zey:</span>
              <span class="font-mono font-bold ml-1 ${sol.safe ? 'text-emerald-600' : 'text-red-600'}">${sol.surfaceTemp.toFixed(2)}Â°C</span>
            </div>
            <div>
              <span class="text-slate-600">Min:</span>
              <span class="font-mono font-bold ml-1">${sol.minTemp.toFixed(2)}Â°C</span>
            </div>
            <div>
              <span class="text-slate-600">KayÄ±p:</span>
              <span class="font-mono font-bold ml-1">${Math.abs(sol.heatLoss).toFixed(2)}W</span>
            </div>
          </div>
        </div>
        <button onclick="removeSelection(${idx})" class="ml-3 w-8 h-8 bg-red-500 hover:bg-red-600 text-white rounded-lg flex items-center justify-center transition-all">
          <i data-lucide="trash-2" class="w-4 h-4"></i>
        </button>
      </div>
    `).join('');
  }
  
  lucide.createIcons();
}

function removeSelection(index) {
  const removed = selectedSolutions[index];
  selectedSolutions.splice(index, 1);
  showNotification(`${removed.material} ${removed.thickness}mm kaldÄ±rÄ±ldÄ±`, 'info');
  updateSelectedList();
}

// ====================================
// RAPOR OLUÅTURMA
// ====================================
function generateReport() {
  if (selectedSolutions.length === 0) {
    showNotification('LÃ¼tfen en az bir Ã§Ã¶zÃ¼m seÃ§in', 'warning');
    return;
  }

  const dn = parseInt(document.getElementById('dn').value);
  const t_ort = parseFloat(document.getElementById('t_ort').value);
  const rh = parseFloat(document.getElementById('rh').value);
  const t_ic = parseFloat(document.getElementById('t_ic').value);
  const v_hava = parseFloat(document.getElementById('v_hava').value);
  const L = parseFloat(document.getElementById('pipe_length').value);
  const safety_margin = parseFloat(document.getElementById('safety_margin').value);

  const od = PIPES[dn];
  const t_dew = calculateDewPoint(t_ort, rh);
  
  const today = new Date().toLocaleDateString('tr-TR', { year: 'numeric', month: 'long', day: 'numeric' });
  const wrapper = document.getElementById('print-wrapper');
  
  // SAYFA SAYISI HESAPLAMA - Her sayfada maksimum 4 Ã§Ã¶zÃ¼m
  const solutionsPerPage = 4;
  const solutionPages = Math.ceil(selectedSolutions.length / solutionsPerPage);
  const totalPages = 2 + solutionPages; // Kapak + Metodoloji + Ã‡Ã¶zÃ¼m sayfalarÄ±
  
  let pagesHTML = '';
  
  // KAPAK SAYFASI
  pagesHTML += `
    <div class="print-page cover-bg">
      <div class="cover-accent"></div>
      <div class="cover-content">
        <div>
          <div style="width: 55px; height: 55px; background: linear-gradient(135deg, #06b6d4, #3b82f6); border-radius: 14px; display: flex; align-items: center; justify-content: center; margin-bottom: 25px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/></svg>
          </div>
          
          <h1 style="font-size: 42px; font-weight: 900; color: #0f172a; margin: 0 0 18px 0; line-height: 1.1;">
            YoÄŸuÅŸma Ã–nleme<br>Analiz Raporu
          </h1>
          
          <div style="width: 75px; height: 4px; background: linear-gradient(90deg, #06b6d4, #3b82f6); border-radius: 10px; margin-bottom: 25px;"></div>
          
          <div style="background: rgba(6, 182, 212, 0.08); border-left: 4px solid #06b6d4; padding: 18px; border-radius: 10px; margin-bottom: 25px;">
            <table style="width: 100%; font-size: 10px; color: #0f172a;">
              <tr><td style="padding: 7px 0; font-weight: 600; color: #64748b; width: 170px;">Boru Ã‡apÄ±:</td><td style="font-weight: 800;">DN ${dn} (Ã˜ ${od}mm)</td></tr>
              <tr><td style="padding: 7px 0; font-weight: 600; color: #64748b;">Ortam SÄ±caklÄ±ÄŸÄ±:</td><td style="font-weight: 800;">${t_ort}Â°C</td></tr>
              <tr><td style="padding: 7px 0; font-weight: 600; color: #64748b;">BaÄŸÄ±l Nem:</td><td style="font-weight: 800;">${rh}%</td></tr>
              <tr><td style="padding: 7px 0; font-weight: 600; color: #64748b;">Ä°Ã§ AkÄ±ÅŸkan SÄ±caklÄ±ÄŸÄ±:</td><td style="font-weight: 800;">${t_ic}Â°C</td></tr>
              <tr><td style="padding: 7px 0; font-weight: 600; color: #64748b;">Ã‡iÄŸ NoktasÄ±:</td><td style="font-weight: 800; color: #0891b2;">${t_dew.toFixed(2)}Â°C</td></tr>
              <tr><td style="padding: 7px 0; font-weight: 600; color: #64748b;">Min. YÃ¼zey SÄ±caklÄ±ÄŸÄ±:</td><td style="font-weight: 800; color: #059669;">${(t_dew + safety_margin).toFixed(2)}Â°C</td></tr>
            </table>
          </div>
        </div>
        
        <div>
          <div style="margin-bottom: 22px;">
            <div style="font-size: 9px; color: #64748b; font-weight: 600; margin-bottom: 6px;">RAPOR TARÄ°HÄ°</div>
            <div style="font-size: 13px; color: #0f172a; font-weight: 800;">${today}</div>
          </div>
          
          <div style="border-top: 2px solid #e2e8f0; padding-top: 18px;">
            <div style="font-size: 8px; color: #94a3b8; margin-bottom: 4px;">OLUÅTURAN</div>
            <div style="font-size: 15px; font-weight: 900; background: linear-gradient(135deg, #06b6d4, #3b82f6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">Optimizi</div>
            <div style="font-size: 8px; color: #64748b; font-weight: 600; margin-top: 2px;">YoÄŸuÅŸma Ã–nleme Pro</div>
          </div>
        </div>
      </div>
    </div>
  `;
  
  // Ã‡Ã–ZÃœM SAYFALARI
  for (let pageNum = 0; pageNum < solutionPages; pageNum++) {
    const startIdx = pageNum * solutionsPerPage;
    const endIdx = Math.min(startIdx + solutionsPerPage, selectedSolutions.length);
    const pageSolutions = selectedSolutions.slice(startIdx, endIdx);
    
    pagesHTML += `
      <div class="print-page">
        <div class="print-header">
          <div>
            <div style="font-size: 8px; color: #06b6d4; font-weight: 700; letter-spacing: 1px; margin-bottom: 2px;">Ã‡Ã–ZÃœM ANALÄ°ZÄ°</div>
            <h2 style="font-size: 16px; font-weight: 900; color: #0f172a; margin: 0;">YalÄ±tÄ±m Ã‡Ã¶zÃ¼mleri ${pageNum > 0 ? `(${pageNum + 1})` : ''}</h2>
          </div>
          <div style="text-align: right;">
            <div style="font-size: 7px; color: #94a3b8; margin-bottom: 2px;">${today}</div>
            <div style="font-size: 7px; color: #94a3b8;">Sayfa ${pageNum + 2} / ${totalPages}</div>
          </div>
        </div>
        
        <table class="audit-table">
          <thead>
            <tr>
              <th style="width: 15%;">Malzeme</th>
              <th style="width: 10%;">Î» (W/mK)</th>
              <th style="width: 11%;">KalÄ±nlÄ±k</th>
              <th style="width: 12%;">T<sub>yÃ¼zey</sub></th>
              <th style="width: 12%;">T<sub>Ã§iÄŸ</sub></th>
              <th style="width: 10%;">Fark</th>
              <th style="width: 15%;">IsÄ± KaybÄ±</th>
              <th style="width: 15%;">Durum</th>
            </tr>
          </thead>
          <tbody>
            ${pageSolutions.map(sol => `
              <tr>
                <td style="font-weight: 800;">${sol.material}</td>
                <td style="font-family: monospace;">${sol.lambda}</td>
                <td style="font-family: monospace; font-weight: 700;">${sol.thickness} mm</td>
                <td style="font-family: monospace; font-weight: 700; color: ${sol.safe ? '#059669' : '#dc2626'};">${sol.surfaceTemp.toFixed(2)}Â°C</td>
                <td style="font-family: monospace;">${sol.dewPoint.toFixed(2)}Â°C</td>
                <td style="font-family: monospace; font-weight: 700; color: ${sol.safe ? '#059669' : '#dc2626'};">${(sol.surfaceTemp - sol.dewPoint).toFixed(2)}Â°C</td>
                <td style="font-family: monospace;">${Math.abs(sol.heatLoss).toFixed(2)} W</td>
                <td style="font-weight: 800; color: ${sol.safe ? '#059669' : '#dc2626'};">
                  ${sol.safe ? 'âœ“ GÃœVENLÄ°' : 'âš ï¸ YETERSÄ°Z'}
                </td>
              </tr>
            `).join('')}
          </tbody>
        </table>
        
        <div style="background: #f8fafc; padding: 14px; border-radius: 8px; border-left: 3px solid #06b6d4; margin-top: 14px;">
          <h3 style="font-size: 9px; font-weight: 800; color: #0f172a; margin: 0 0 7px 0;">ğŸ“Š Analiz NotlarÄ±</h3>
          <p style="font-size: 8px; color: #475569; margin: 0; line-height: 1.5;">
            Radyasyon ve doÄŸal konveksiyon Ä±sÄ± transferi dahil edilmiÅŸtir. GÃ¼venlik marjÄ± ${safety_margin}Â°C olarak alÄ±nmÄ±ÅŸtÄ±r.
            ${pageSolutions.filter(s => s.safe).length > 0 ? 
              `<br><strong style="color: #059669; font-size: 8px;">âœ“ Bu sayfada ${pageSolutions.filter(s => s.safe).length} adet gÃ¼venli Ã§Ã¶zÃ¼m bulunmaktadÄ±r.</strong>` : 
              `<br><strong style="color: #dc2626; font-size: 8px;">âš ï¸ Bu sayfadaki Ã§Ã¶zÃ¼mler yetersizdir.</strong>`
            }
          </p>
        </div>
        
        <div class="print-footer">
          <div style="font-size: 7px; color: #94a3b8;">Optimizi.YoÄŸuÅŸma Â© ${new Date().getFullYear()}</div>
          <div style="font-size: 7px; color: #94a3b8;">Sayfa ${pageNum + 2} / ${totalPages}</div>
        </div>
      </div>
    `;
  }
  
  // METODOLOJÄ° VE YAK RÄ°SK SAYFASI
  pagesHTML += `
    <div class="print-page">
      <div class="print-header">
        <div>
          <div style="font-size: 8px; color: #06b6d4; font-weight: 700; letter-spacing: 1px; margin-bottom: 2px;">TEKNÄ°K METODOLOJÄ°</div>
          <h2 style="font-size: 16px; font-weight: 900; color: #0f172a; margin: 0;">Hesaplama StandartlarÄ± & YAK Risk DeÄŸerlendirmesi</h2>
        </div>
        <div style="text-align: right;">
          <div style="font-size: 7px; color: #94a3b8; margin-bottom: 2px;">${today}</div>
          <div style="font-size: 7px; color: #94a3b8;">Sayfa ${totalPages} / ${totalPages}</div>
        </div>
      </div>
      
      <div class="print-section">
        <h3 style="font-size: 10px; font-weight: 800; color: #0e7490; text-transform: uppercase; margin-bottom: 8px; letter-spacing: 0.5px;">
          ğŸ“ Hesaplama Metodu
        </h3>
        
        <div style="background: #f8fafc; padding: 12px; border-radius: 8px; border: 1px solid #e2e8f0; margin-bottom: 10px;">
          <h4 style="font-size: 8.5px; font-weight: 800; color: #0f172a; margin: 0 0 6px 0;">1. Ã‡iÄŸ NoktasÄ± (Magnus FormÃ¼lÃ¼)</h4>
          <p style="font-size: 7.5px; color: #475569; margin: 0 0 5px 0; line-height: 1.4;">
            Ã‡iÄŸ noktasÄ± sÄ±caklÄ±ÄŸÄ± Magnus-Tetens formÃ¼lÃ¼ ile hesaplanÄ±r:
          </p>
          <div style="background: white; padding: 8px; border-radius: 5px; border: 1px solid #e2e8f0; font-family: monospace; font-size: 7.5px; color: #0f172a; margin-bottom: 5px;">
            T_Ã§iÄŸ = (b Ã— Î±) / (a âˆ’ Î±), Î± = (a Ã— T) / (b + T) + ln(RH/100), a = 17.27, b = 237.7Â°C
          </div>
        </div>
        
        <div style="background: #f8fafc; padding: 12px; border-radius: 8px; border: 1px solid #e2e8f0; margin-bottom: 10px;">
          <h4 style="font-size: 8.5px; font-weight: 800; color: #0f172a; margin: 0 0 6px 0;">2. IsÄ± Transferi & YÃ¼zey SÄ±caklÄ±ÄŸÄ± (ISO 12241)</h4>
          <p style="font-size: 7.5px; color: #475569; margin: 0 0 5px 0; line-height: 1.4;">
            YÃ¼zey sÄ±caklÄ±ÄŸÄ± termal direnÃ§ aÄŸÄ± ile hesaplanÄ±r:
          </p>
          <div style="background: white; padding: 8px; border-radius: 5px; border: 1px solid #e2e8f0; font-family: monospace; font-size: 7px; color: #0f172a; margin-bottom: 5px; line-height: 1.5;">
            R_yal = ln(râ‚‚/râ‚) / (2Ï€ Ã— Î» Ã— L), R_dÄ±ÅŸ = 1 / (2Ï€ Ã— râ‚‚ Ã— h_toplam Ã— L)<br>
            h_konv = 10.45 âˆ’ v + 10âˆšv, h_rad = Îµ Ã— Ïƒ Ã— (T_ortÂ² + T_yÃ¼zÂ²) Ã— (T_ort + T_yÃ¼z)
          </div>
        </div>
        
        <div style="background: #f8fafc; padding: 12px; border-radius: 8px; border: 1px solid #e2e8f0; margin-bottom: 10px;">
          <h4 style="font-size: 8.5px; font-weight: 800; color: #0f172a; margin: 0 0 5px 0;">3. GÃ¼venlik MarjÄ±</h4>
          <p style="font-size: 7.5px; color: #475569; margin: 0; line-height: 1.4;">
            YÃ¼zey sÄ±caklÄ±ÄŸÄ± min. <strong>T_Ã§iÄŸ + ${safety_margin}Â°C</strong> tutulmalÄ±dÄ±r. ASHRAE & CIBSE standartlarÄ±na uygundur.
          </p>
        </div>
      </div>
      
      <div class="print-section">
        <h3 style="font-size: 10px; font-weight: 800; color: #dc2626; text-transform: uppercase; margin-bottom: 8px; letter-spacing: 0.5px;">
          âš ï¸ YAK Risk (YalÄ±tÄ±m AltÄ± Korozyon)
        </h3>
        
        <div style="background: #fef2f2; padding: 12px; border-radius: 7px; border-left: 3px solid #dc2626; margin-bottom: 9px;">
          <h4 style="font-size: 8.5px; font-weight: 800; color: #991b1b; margin: 0 0 6px 0;">YAK Nedir?</h4>
          <p style="font-size: 7.5px; color: #7f1d1d; margin: 0; line-height: 1.4;">
            SoÄŸuk boru sistemlerindeki en ciddi tehdit. Nem, yalÄ±tÄ±mdan geÃ§erek boru yÃ¼zeyinde yoÄŸuÅŸur ve 
            gÃ¶rsel denetimle tespit edilemeyen korozyon oluÅŸturur.
          </p>
        </div>
        
        <div style="background: white; padding: 10px; border-radius: 7px; border: 1px solid #fee2e2; margin-bottom: 9px;">
          <h4 style="font-size: 8.5px; font-weight: 800; color: #dc2626; margin: 0 0 6px 0;">Risk FaktÃ¶rleri:</h4>
          <div style="font-size: 7px; color: #475569; line-height: 1.5;">
            <strong>1.</strong> Yetersiz yalÄ±tÄ±m kalÄ±nlÄ±ÄŸÄ±<br>
            <strong>2.</strong> HatalÄ± buhar bariyeri uygulamasÄ±<br>
            <strong>3.</strong> SÄ±caklÄ±k dalgalanmalarÄ±<br>
            <strong>4.</strong> YÃ¼ksek nem ortamlarÄ±<br>
            <strong>5.</strong> AÃ§Ä±k hava/dÄ±ÅŸ ortam
          </div>
        </div>
        
        <div style="background: #fff7ed; padding: 10px; border-radius: 7px; border: 1px solid #fed7aa; margin-bottom: 9px;">
          <h4 style="font-size: 8.5px; font-weight: 800; color: #c2410c; margin: 0 0 5px 0;">SonuÃ§lar:</h4>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 7px; color: #7c2d12; line-height: 1.4;">
            <div>
              â€¢ YapÄ±sal hasar<br>
              â€¢ GÃ¼venlik tehlikeleri<br>
              â€¢ Ãœretim kaybÄ±
            </div>
            <div>
              â€¢ YÃ¼ksek ekonomik etki<br>
              â€¢ Ã‡evresel risk<br>
              â€¢ Mevzuat uyumsuzluÄŸu
            </div>
          </div>
        </div>
        
        <div style="background: #ecfdf5; padding: 10px; border-radius: 7px; border-left: 3px solid #059669;">
          <h4 style="font-size: 8.5px; font-weight: 800; color: #065f46; margin: 0 0 5px 0;">DoÄŸru TasarÄ±m ile Ã–nleme:</h4>
          <p style="font-size: 7px; color: #064e3b; margin: 0; line-height: 1.4;">
            <strong style="color: #059669;">"GÃœVENLÄ°"</strong> Ã§Ã¶zÃ¼mleri seÃ§erek YAK'a karÅŸÄ± uzun vadeli koruma saÄŸlar, 
            varlÄ±k Ã¶mrÃ¼nÃ¼ 15-20 yÄ±l uzatÄ±r ve maliyetli onarÄ±mlarÄ± Ã¶nlersiniz.
          </p>
        </div>
      </div>
      
      <div class="print-footer">
        <div style="font-size: 7px; color: #94a3b8;">Optimizi.YoÄŸuÅŸma Â© ${new Date().getFullYear()}</div>
        <div style="font-size: 7px; color: #94a3b8;">Sayfa ${totalPages} / ${totalPages}</div>
      </div>
    </div>
  `;
  
  wrapper.innerHTML = pagesHTML;
  
  setTimeout(() => {
    window.print();
  }, 500);
}

// ====================================
// BÄ°LDÄ°RÄ°M
// ====================================
function showNotification(message, type = 'success') {
  const colors = {
    success: 'bg-emerald-500',
    warning: 'bg-amber-500',
    info: 'bg-blue-500'
  };
  
  const notification = document.createElement('div');
  notification.className = `fixed top-20 right-6 ${colors[type]} text-white px-5 py-2.5 rounded-xl shadow-2xl font-bold text-sm z-50`;
  notification.innerHTML = `
    <i data-lucide="${type === 'success' ? 'check-circle' : type === 'warning' ? 'alert-triangle' : 'info'}" class="w-4 h-4 inline mr-2"></i>
    ${message}
  `;
  
  document.body.appendChild(notification);
  lucide.createIcons();
  
  setTimeout(() => {
    notification.style.opacity = '0';
    notification.style.transform = 'translateX(400px)';
    notification.style.transition = 'all 0.3s ease';
    setTimeout(() => notification.remove(), 300);
  }, 2500);
}

// ====================================
// BAÅLATMA
// ====================================
function initApp() {
  const select = document.getElementById('dn');
  for (const [dn, od] of Object.entries(PIPES)) {
    const opt = document.createElement('option');
    opt.value = dn;
    opt.text = `DN ${dn} (Ã˜ ${od}mm)`;
    select.add(opt);
  }
  select.value = '100';
  
  // Manuel izolasyon seÃ§eneklerini doldur
  const manualSelect = document.getElementById('manual_insulation');
  INSULATIONS.forEach(ins => {
    const opt = document.createElement('option');
    opt.value = ins.lambda;
    opt.text = `${ins.name} (Î»=${ins.lambda})`;
    manualSelect.add(opt);
  });
  
  lucide.createIcons();
  calculate();
}

window.onload = initApp;
</script>
<script src="guard.js?v=2"></script>
</body>
</html>
