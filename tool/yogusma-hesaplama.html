<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>YoÄŸuÅŸma Ã–nleme Pro | Optimizi</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
<link rel="icon" href="../favicon.png" type="image/png">
<script>
  tailwind.config = {
    theme: {
      fontFamily: { sans: ['"Plus Jakarta Sans"', 'sans-serif'], mono: ['"JetBrains Mono"', 'monospace'] },
      extend: {
        colors: { slate: { 850: '#151e2e', 900: '#0f172a', 950: '#020617' } },
        boxShadow: { 'print': '0 1px 0px rgba(0,0,0,0.05)' }
      }
    }
  }
</script>

<style>
  :root {
    --bg-color: #fdfdfd; 
    --glass-bg: rgba(255, 255, 255, 0.85);
    --glass-border: rgba(14, 165, 233, 0.15);
    --input-bg: #ffffff;
    --input-border: #bae6fd;
    --text-main: #1e293b; 
    --card-shadow: 0 4px 20px -4px rgba(14, 165, 233, 0.1);
  }

  body { 
    background-color: var(--bg-color);
    background-image: linear-gradient(rgba(14, 165, 233, 0.03) 1px, transparent 1px),
    linear-gradient(90deg, rgba(14, 165, 233, 0.03) 1px, transparent 1px);
    background-size: 20px 20px;
    color: var(--text-main); 
    overflow-x: hidden; 
  }

  .glass-card { 
    background-color: var(--glass-bg); 
    backdrop-filter: blur(12px); 
    border: 1px solid var(--glass-border); 
    box-shadow: var(--card-shadow);
    transition: all 0.3s ease;
  }

  .glass-input { 
    transition: all 0.2s; border-radius: 0.5rem; padding: 0.6rem 0.8rem; width: 100%; 
    background-color: var(--input-bg); border: 1px solid var(--input-border); color: var(--text-main);
    font-size: 0.85rem;
  }
  .glass-input:focus { outline: none; border-color: #06b6d4; box-shadow: 0 0 0 3px rgba(6, 182, 212, 0.1); }

  .selection-card {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    cursor: pointer;
    border: 2px solid transparent;
  }
  
  .selection-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 12px 24px -8px rgba(6, 182, 212, 0.2);
    border-color: #06b6d4;
  }
  
  .selection-card.safe {
    border-color: #10b981;
    background: linear-gradient(135deg, rgba(16, 185, 129, 0.05) 0%, rgba(5, 150, 105, 0.05) 100%);
  }
  
  .selection-card.insufficient {
    border-color: #ef4444;
    background: linear-gradient(135deg, rgba(239, 68, 68, 0.05) 0%, rgba(220, 38, 38, 0.05) 100%);
  }

  .added-item {
    animation: slideIn 0.3s ease-out;
  }

  @keyframes slideIn {
    from {
      opacity: 0;
      transform: translateX(-20px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  /* Custom scrollbar */
  #selectionArea::-webkit-scrollbar,
  #selectedList::-webkit-scrollbar {
    width: 6px;
  }

  #selectionArea::-webkit-scrollbar-track,
  #selectedList::-webkit-scrollbar-track {
    background: #f1f5f9;
    border-radius: 10px;
  }

  #selectionArea::-webkit-scrollbar-thumb,
  #selectedList::-webkit-scrollbar-thumb {
    background: #cbd5e1;
    border-radius: 10px;
  }

  #selectionArea::-webkit-scrollbar-thumb:hover,
  #selectedList::-webkit-scrollbar-thumb:hover {
    background: #94a3b8;
  }

  /* Print styles */
  @media print {
    @page { margin: 0; size: A4; } 
    html, body { height: 100%; background: white; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    
    .main-interface, nav { display: none !important; }
    #print-wrapper { display: block !important; }
    
    .print-page { 
      page-break-after: always; 
      page-break-inside: avoid;
      padding: 45px 50px 60px 50px;
      height: 297mm;
      width: 210mm;
      box-sizing: border-box;
      background: white;
      position: relative;
      overflow: hidden;
    }
    
    .print-page:last-child { page-break-after: auto; }
    
    .cover-bg {
      background-color: white !important;
      color: #1e293b !important;
      padding: 0 !important;
    }
    
    .cover-accent {
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 12mm;
      background: linear-gradient(180deg, #06b6d4, #3b82f6);
      z-index: 0;
    }
    
    .cover-content {
      position: relative;
      z-index: 10;
      height: 100%;
      padding: 20mm 20mm 20mm 35mm;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    
    .print-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-bottom: 15px;
      border-bottom: 2px solid #e0e7ff;
      margin-bottom: 25px;
    }

    .print-section {
      margin-bottom: 20px;
      page-break-inside: avoid;
      break-inside: avoid;
      orphans: 3;
      widows: 3;
    }
    
    .audit-table {
      width: 100%;
      border-collapse: collapse;
      margin: 15px 0;
      font-size: 9px;
      page-break-inside: auto;
    }

    .audit-table th {
      background-color: #ecfeff !important;
      color: #0891b2 !important;
      font-weight: 700;
      text-transform: uppercase;
      font-size: 7px;
      padding: 8px;
      border: 1px solid #a5f3fc;
      page-break-after: avoid;
      page-break-inside: avoid;
    }

    .audit-table td {
      padding: 6px 8px;
      border: 1px solid #e2e8f0;
      color: #334155;
      page-break-inside: avoid;
    }
    
    .audit-table tr {
      page-break-inside: avoid;
      page-break-after: auto;
    }
    
    .audit-table tr:nth-child(even) {
      background-color: #f8fafc !important;
    }
  }

  #print-wrapper { display: none; }
</style>
</head>
<body class="antialiased">

<!-- NAVIGATION -->
<nav class="sticky top-0 z-50 bg-white/80 border-b border-slate-200 backdrop-blur-xl main-interface">
  <div class="max-w-[1600px] mx-auto px-6 h-16 flex items-center justify-between">
    <div class="flex items-center gap-3">
      <div class="w-9 h-9 bg-gradient-to-br from-cyan-600 to-blue-600 rounded-xl flex items-center justify-center shadow-lg shadow-cyan-200">
        <i data-lucide="droplets" class="text-white w-5 h-5"></i>
      </div>
      <div>
        <h1 class="text-xl font-extrabold text-slate-900 tracking-tight">Optimizi<span class="text-transparent bg-clip-text bg-gradient-to-r from-cyan-600 to-blue-600">.YoÄŸuÅŸma</span></h1>
        <p class="text-[9px] font-bold text-slate-400 uppercase tracking-wider">SoÄŸuk Hat Optimizasyonu</p>
      </div>
    </div>
    <div class="flex items-center gap-3">
      <button onclick="showReportModal()" class="px-4 py-2 bg-gradient-to-r from-cyan-600 to-blue-600 text-white rounded-lg font-bold text-sm hover:shadow-lg transition-all flex items-center gap-2">
        <i data-lucide="printer" class="w-4 h-4"></i>
        Rapor Al
      </button>
    </div>
  </div>
</nav>

<!-- MAIN CONTENT -->
<div class="main-interface max-w-[1600px] mx-auto px-6 py-8">
  <div class="grid lg:grid-cols-3 gap-6">
    
    <!-- LEFT PANEL: INPUT -->
    <div class="lg:col-span-1 space-y-6">
      <div class="glass-card rounded-2xl p-6">
        <div class="flex items-center gap-2 mb-5">
          <div class="w-8 h-8 bg-cyan-100 rounded-lg flex items-center justify-center">
            <i data-lucide="sliders" class="w-4 h-4 text-cyan-600"></i>
          </div>
          <h2 class="text-lg font-bold text-slate-900">GiriÅŸ Parametreleri</h2>
        </div>

        <div class="space-y-4">
          <div>
            <label class="block text-xs font-bold text-slate-700 mb-2 uppercase tracking-wide">Boru Ã‡apÄ± (DN)</label>
            <select id="dn" class="glass-input" onchange="calculate()">
              <!-- Dinamik olarak doldurulacak -->
            </select>
          </div>

          <div>
            <label class="block text-xs font-bold text-slate-700 mb-2 uppercase tracking-wide">Proses SÄ±caklÄ±ÄŸÄ± (Â°C)</label>
            <input type="number" id="tProc" value="5" step="0.5" class="glass-input" onchange="calculate()">
          </div>

          <div>
            <label class="block text-xs font-bold text-slate-700 mb-2 uppercase tracking-wide">Ortam SÄ±caklÄ±ÄŸÄ± (Â°C)</label>
            <input type="number" id="tAmb" value="25" step="0.5" class="glass-input" onchange="calculate()">
          </div>

          <div>
            <label class="block text-xs font-bold text-slate-700 mb-2 uppercase tracking-wide">Ortam BaÄŸÄ±l Nem (%)</label>
            <input type="number" id="rhAmb" value="70" step="1" min="0" max="100" class="glass-input" onchange="calculate()">
          </div>

          <div>
            <label class="block text-xs font-bold text-slate-700 mb-2 uppercase tracking-wide">RÃ¼zgar HÄ±zÄ± (m/s)</label>
            <input type="number" id="vWind" value="0.5" step="0.1" min="0" class="glass-input" onchange="calculate()">
            <p class="text-[9px] text-slate-500 mt-1">Ä°Ã§ mekan: 0-0.5 m/s | DÄ±ÅŸ mekan: 1-5 m/s</p>
          </div>
        </div>

        <div class="mt-6 p-4 bg-cyan-50 rounded-xl border border-cyan-200">
          <div class="flex items-start gap-2">
            <i data-lucide="thermometer" class="w-5 h-5 text-cyan-600 mt-0.5"></i>
            <div>
              <p class="text-xs font-bold text-cyan-900 mb-1">Ã‡Ä°Y NOKTASI</p>
              <p id="dewPointDisplay" class="text-2xl font-black text-cyan-600">--</p>
              <p class="text-[10px] text-cyan-700 mt-1">Hedef YÃ¼zey: <span id="targetTempDisplay" class="font-bold">--</span></p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- MIDDLE PANEL: SELECTION -->
    <div class="lg:col-span-1 space-y-6">
      <div class="glass-card rounded-2xl p-6">
        <div class="flex items-center justify-between mb-5">
          <div class="flex items-center gap-2">
            <div class="w-8 h-8 bg-emerald-100 rounded-lg flex items-center justify-center">
              <i data-lucide="package" class="w-4 h-4 text-emerald-600"></i>
            </div>
            <h2 class="text-lg font-bold text-slate-900">Ä°zolasyon SeÃ§imi</h2>
          </div>
        </div>

        <div id="selectionArea" class="space-y-3 max-h-[calc(100vh-280px)] overflow-y-auto pr-2">
          <!-- Dinamik olarak doldurulacak -->
        </div>
      </div>
    </div>

    <!-- RIGHT PANEL: ADDED LIST -->
    <div class="lg:col-span-1 space-y-6">
      <div class="glass-card rounded-2xl p-6">
        <div class="flex items-center justify-between mb-5">
          <div class="flex items-center gap-2">
            <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center">
              <i data-lucide="list-checks" class="w-4 h-4 text-blue-600"></i>
            </div>
            <h2 class="text-lg font-bold text-slate-900">SeÃ§ilen Ã‡Ã¶zÃ¼mler</h2>
          </div>
          <button onclick="clearAllSelections()" class="text-xs font-bold text-red-600 hover:text-red-700 px-3 py-1 rounded-lg hover:bg-red-50 transition-all">
            TÃ¼mÃ¼nÃ¼ Temizle
          </button>
        </div>

        <div id="selectedList" class="space-y-3 max-h-[calc(100vh-280px)] overflow-y-auto pr-2">
          <div class="text-center py-12 text-slate-400">
            <i data-lucide="inbox" class="w-12 h-12 mx-auto mb-3 opacity-30"></i>
            <p class="text-sm font-medium">HenÃ¼z seÃ§im yapÄ±lmadÄ±</p>
            <p class="text-xs mt-1">Soldaki listeden ekleyin</p>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- PRINT WRAPPER -->
<div id="print-wrapper"></div>

<!-- MODAL FOR COMPANY INFO -->
<div id="reportModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center">
  <div class="glass-card rounded-2xl p-8 max-w-md w-full mx-4 shadow-2xl">
    <div class="flex items-center gap-3 mb-6">
      <div class="w-10 h-10 bg-cyan-100 rounded-xl flex items-center justify-center">
        <i data-lucide="building-2" class="w-5 h-5 text-cyan-600"></i>
      </div>
      <h3 class="text-xl font-bold text-slate-900">Rapor Bilgileri</h3>
    </div>
    
    <div class="space-y-4">
      <div>
        <label class="block text-xs font-bold text-slate-700 mb-2 uppercase tracking-wide">Proje AdÄ±</label>
        <input type="text" id="projectName" class="glass-input" placeholder="Ã–rn: Fabrika SoÄŸutma Sistemi YalÄ±tÄ±mÄ±">
      </div>
      
      <div>
        <label class="block text-xs font-bold text-slate-700 mb-2 uppercase tracking-wide">Firma AdÄ±</label>
        <input type="text" id="companyName" class="glass-input" placeholder="Ã–rn: ABC MÃ¼hendislik A.Å.">
      </div>
      
      <div>
        <label class="block text-xs font-bold text-slate-700 mb-2 uppercase tracking-wide">Yetkili KiÅŸi</label>
        <input type="text" id="contactPerson" class="glass-input" placeholder="Ã–rn: Ahmet YÄ±lmaz">
      </div>
    </div>
    
    <div class="flex gap-3 mt-6">
      <button onclick="closeReportModal()" class="flex-1 px-4 py-2.5 bg-slate-200 hover:bg-slate-300 text-slate-700 rounded-lg font-bold text-sm transition-all">
        Ä°ptal
      </button>
      <button onclick="proceedWithReport()" class="flex-1 px-4 py-2.5 bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-700 hover:to-blue-700 text-white rounded-lg font-bold text-sm transition-all flex items-center justify-center gap-2">
        <i data-lucide="check" class="w-4 h-4"></i>
        Rapor OluÅŸtur
      </button>
    </div>
  </div>
</div>

<script>
// ====================================
// VERÄ° YAPILARI
// ====================================
const PIPES = {
  25: 33.7, 32: 42.4, 40: 48.3, 50: 60.3, 65: 76.1, 80: 88.9,
  100: 114.3, 125: 139.7, 150: 168.3, 200: 219.1, 250: 273, 300: 323.9
};

const INSULATIONS = [
  { name: 'Elastomerik KauÃ§uk', lambda: 0.037, thicknesses: [9, 13, 19, 25, 32] },
  { name: 'TaÅŸyÃ¼nÃ¼ (Rockwool)', lambda: 0.040, thicknesses: [30, 40, 50, 60, 80, 100] },
  { name: 'CamyÃ¼nÃ¼ (Glasswool)', lambda: 0.038, thicknesses: [30, 40, 50, 60, 80, 100] },
  { name: 'PoliÃ¼retan (PUR)', lambda: 0.028, thicknesses: [30, 40, 50, 60, 80] },
  { name: 'PoliizosiyonÃ¼rat (PIR)', lambda: 0.025, thicknesses: [30, 40, 50, 60, 80] },
  { name: 'Aerogel', lambda: 0.015, thicknesses: [5, 10, 15, 20] }
];

const STEFANBOLTZ = 5.67e-8;
const EMISSIVITY_INSULATION = 0.9;

let selectedSolutions = [];
let currentInputs = {};

// ====================================
// Ã‡Ä°Y NOKTASI HESAPLAMA
// ====================================
function dewPoint(t, rh) {
  const a = 17.27, b = 237.7;
  const alpha = ((a * t) / (b + t)) + Math.log(rh / 100.0);
  return (b * alpha) / (a - alpha);
}

// ====================================
// ISI TRANSFERÄ° HESAPLAMA
// ====================================
function calculateSurfaceTemp(tProc, tAmb, pipeOD, insThick, lambda, vWind) {
  const r1 = pipeOD / 2000;
  const r2 = r1 + (insThick / 1000);
  
  // Konveksiyon katsayÄ±sÄ± - rÃ¼zgar hÄ±zÄ±na baÄŸlÄ±
  const hConv = 10.45 - vWind + 10 * Math.sqrt(vWind);
  
  const hRad = EMISSIVITY_INSULATION * STEFANBOLTZ * 
    (Math.pow((tAmb + 273.15), 2) + Math.pow((tProc + 273.15), 2)) *
    ((tAmb + 273.15) + (tProc + 273.15));
  
  const hTotal = hConv + hRad;
  
  const Rins = Math.log(r2 / r1) / (2 * Math.PI * lambda);
  const Rext = 1 / (2 * Math.PI * r2 * hTotal);
  const Rtotal = Rins + Rext;
  
  const q = (tProc - tAmb) / Rtotal;
  const tSurf = tAmb + (q * Rext);
  
  return tSurf;
}

// ====================================
// HESAPLAMA
// ====================================
function calculate() {
  const dn = document.getElementById('dn').value;
  const tProc = parseFloat(document.getElementById('tProc').value);
  const tAmb = parseFloat(document.getElementById('tAmb').value);
  const rhAmb = parseFloat(document.getElementById('rhAmb').value);
  const vWind = parseFloat(document.getElementById('vWind').value) || 0.5;
  
  const pipeOD = PIPES[dn];
  const tDew = dewPoint(tAmb, rhAmb);
  const tTarget = tDew + 3;
  
  currentInputs = { dn, tProc, tAmb, rhAmb, vWind, pipeOD, tDew, tTarget };
  
  document.getElementById('dewPointDisplay').textContent = tDew.toFixed(1) + 'Â°C';
  document.getElementById('targetTempDisplay').textContent = tTarget.toFixed(1) + 'Â°C';
  
  renderSelectionArea();
}

// ====================================
// SEÃ‡Ä°M ALANI OLUÅTURMA
// ====================================
function renderSelectionArea() {
  const container = document.getElementById('selectionArea');
  container.innerHTML = '';
  
  INSULATIONS.forEach((insul, insulIdx) => {
    const card = document.createElement('div');
    card.className = 'glass-card rounded-xl p-4 space-y-3';
    
    card.innerHTML = `
      <div class="flex items-center justify-between">
        <h3 class="font-bold text-sm text-slate-900">${insul.name}</h3>
        <span class="text-xs font-mono text-slate-600 bg-slate-100 px-2 py-1 rounded">Î»=${insul.lambda.toFixed(3)}</span>
      </div>
      <div class="grid grid-cols-2 gap-2" id="thickness-grid-${insulIdx}"></div>
    `;
    
    container.appendChild(card);
    
    const grid = document.getElementById(`thickness-grid-${insulIdx}`);
    
    insul.thicknesses.forEach(thick => {
      const tSurf = calculateSurfaceTemp(
        currentInputs.tProc,
        currentInputs.tAmb,
        currentInputs.pipeOD,
        thick,
        insul.lambda,
        currentInputs.vWind
      );
      
      const margin = tSurf - currentInputs.tDew;
      const isSafe = margin >= 3;
      
      const btn = document.createElement('button');
      btn.className = `selection-card p-3 rounded-lg ${isSafe ? 'safe' : 'insufficient'} text-left`;
      btn.innerHTML = `
        <div class="text-lg font-black ${isSafe ? 'text-emerald-600' : 'text-red-600'}">${thick}mm</div>
        <div class="text-xs text-slate-600 mt-1">
          <div class="font-mono">${tSurf.toFixed(1)}Â°C</div>
          <div class="font-bold ${margin >= 3 ? 'text-emerald-600' : 'text-red-600'}">
            ${isSafe ? 'âœ“' : 'âœ—'} ${margin >= 0 ? '+' : ''}${margin.toFixed(1)}Â°C
          </div>
        </div>
      `;
      
      btn.onclick = () => addToList({
        material: insul.name,
        lambda: insul.lambda,
        thickness: thick,
        surfTemp: tSurf,
        margin: margin,
        safe: isSafe,
        ...currentInputs
      });
      
      grid.appendChild(btn);
    });
  });
  
  lucide.createIcons();
}

// ====================================
// LÄ°STEYE EKLEME
// ====================================
function addToList(solution) {
  // AynÄ± kombinasyon var mÄ± kontrol et
  const exists = selectedSolutions.some(s => 
    s.material === solution.material && 
    s.thickness === solution.thickness &&
    s.dn === solution.dn
  );
  
  if (exists) {
    showNotification('Bu Ã§Ã¶zÃ¼m zaten listede!', 'warning');
    return;
  }
  
  selectedSolutions.push(solution);
  renderSelectedList();
  showNotification('Listeye eklendi!', 'success');
}

// ====================================
// SEÃ‡Ä°LÄ° LÄ°STE RENDER
// ====================================
function renderSelectedList() {
  const container = document.getElementById('selectedList');
  
  if (selectedSolutions.length === 0) {
    container.innerHTML = `
      <div class="text-center py-12 text-slate-400">
        <i data-lucide="inbox" class="w-12 h-12 mx-auto mb-3 opacity-30"></i>
        <p class="text-sm font-medium">HenÃ¼z seÃ§im yapÄ±lmadÄ±</p>
        <p class="text-xs mt-1">Soldaki listeden ekleyin</p>
      </div>
    `;
    lucide.createIcons();
    return;
  }
  
  container.innerHTML = selectedSolutions.map((sol, idx) => `
    <div class="added-item glass-card rounded-xl p-4 ${sol.safe ? 'border-2 border-emerald-500' : 'border-2 border-red-500'}">
      <div class="flex items-start justify-between mb-3">
        <div class="flex-1">
          <div class="font-bold text-sm text-slate-900">${sol.material}</div>
          <div class="text-xs text-slate-600 mt-1">DN${sol.dn} â€¢ ${sol.thickness}mm</div>
        </div>
        <button onclick="removeFromList(${idx})" class="text-red-600 hover:text-red-700 p-1 rounded hover:bg-red-50">
          <i data-lucide="x" class="w-4 h-4"></i>
        </button>
      </div>
      
      <div class="grid grid-cols-2 gap-2 text-xs">
        <div>
          <div class="text-slate-600">YÃ¼zey SÄ±c.</div>
          <div class="font-bold text-slate-900">${sol.surfTemp.toFixed(1)}Â°C</div>
        </div>
        <div>
          <div class="text-slate-600">Marj</div>
          <div class="font-bold ${sol.margin >= 3 ? 'text-emerald-600' : 'text-red-600'}">
            ${sol.margin >= 0 ? '+' : ''}${sol.margin.toFixed(1)}Â°C
          </div>
        </div>
      </div>
      
      <div class="mt-3 pt-3 border-t border-slate-200">
        <div class="flex items-center gap-2 text-xs">
          ${sol.safe ? 
            '<i data-lucide="check-circle" class="w-4 h-4 text-emerald-600"></i><span class="font-bold text-emerald-600">GÃœVENLÄ°</span>' : 
            '<i data-lucide="alert-circle" class="w-4 h-4 text-red-600"></i><span class="font-bold text-red-600">YETERSÄ°Z</span>'
          }
        </div>
      </div>
    </div>
  `).join('');
  
  lucide.createIcons();
}

// ====================================
// LÄ°STEDEN Ã‡IKARMA
// ====================================
function removeFromList(index) {
  selectedSolutions.splice(index, 1);
  renderSelectedList();
  showNotification('Listeden Ã§Ä±karÄ±ldÄ±', 'info');
}

function clearAllSelections() {
  if (selectedSolutions.length === 0) return;
  
  if (confirm('TÃ¼m seÃ§imleri temizlemek istediÄŸinizden emin misiniz?')) {
    selectedSolutions = [];
    renderSelectedList();
    showNotification('TÃ¼m seÃ§imler temizlendi', 'info');
  }
}

// ====================================
// MODAL FONKSÄ°YONLARI
// ====================================
function showReportModal() {
  if (selectedSolutions.length === 0) {
    alert('LÃ¼tfen en az bir Ã§Ã¶zÃ¼m seÃ§in!');
    return;
  }
  
  document.getElementById('reportModal').classList.remove('hidden');
  lucide.createIcons();
}

function closeReportModal() {
  document.getElementById('reportModal').classList.add('hidden');
}

function proceedWithReport() {
  const projectName = document.getElementById('projectName').value.trim();
  const companyName = document.getElementById('companyName').value.trim();
  const contactPerson = document.getElementById('contactPerson').value.trim();
  
  if (!projectName || !companyName || !contactPerson) {
    alert('LÃ¼tfen tÃ¼m bilgileri giriniz!');
    return;
  }
  
  closeReportModal();
  generateReport(projectName, companyName, contactPerson);
}

// ====================================
// RAPOR OLUÅTURMA
// ====================================
function generateReport(projectName, companyName, contactPerson) {
  // Grup by DN
  const groupedByDN = {};
  selectedSolutions.forEach(sol => {
    if (!groupedByDN[sol.dn]) {
      groupedByDN[sol.dn] = [];
    }
    groupedByDN[sol.dn].push(sol);
  });
  
  const wrapper = document.getElementById('print-wrapper');
  const today = new Date().toLocaleDateString('tr-TR', { day: '2-digit', month: '2-digit', year: 'numeric' });
  const totalPages = Object.keys(groupedByDN).length + 2; // +2 Ã§Ã¼nkÃ¼ kapak ve metodoloji sayfasÄ± var
  
  let pagesHTML = `
    <!-- COVER PAGE -->
    <div class="print-page cover-bg">
      <div class="cover-accent"></div>
      <div class="cover-content">
        <!-- Ãœst KÄ±sÄ±m - BaÅŸlÄ±k ve Alt BaÅŸlÄ±k -->
        <div style="padding-top: 40px;">
          <h1 style="font-size: 56px; font-weight: 900; color: #0f172a; line-height: 1; margin: 0 0 8px 0; letter-spacing: -1px;">
            YOÄUÅMA<br>Ã–NLEYÄ°CÄ°<br>YALITIM RAPORU
          </h1>
          <p style="font-size: 13px; color: #64748b; line-height: 1.6; margin: 0; font-weight: 500; max-width: 450px;">
            Termal yalÄ±tÄ±m analizi, yÃ¼zey sÄ±caklÄ±ÄŸÄ± hesaplamalarÄ± ve yalÄ±tÄ±m altÄ± korozyon (YAK) risk deÄŸerlendirmesi.
          </p>
        </div>
        
        <!-- Orta KÄ±sÄ±m - Proje KartÄ± -->
        <div style="background: white; padding: 30px 35px; border-radius: 12px; border: 1px solid #e2e8f0; box-shadow: 0 4px 20px rgba(0,0,0,0.06); margin: 40px 0;">
          <div style="font-size: 9px; color: #06b6d4; font-weight: 800; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 15px;">
            PROJE BÄ°LGÄ°LERÄ°
          </div>
          
          <div style="margin-bottom: 22px; padding-bottom: 22px; border-bottom: 1px solid #f1f5f9;">
            <div style="font-size: 10px; color: #64748b; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 6px;">Proje AdÄ±</div>
            <div style="font-size: 18px; color: #0f172a; font-weight: 900; line-height: 1.3;">${projectName}</div>
          </div>
          
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 22px; margin-bottom: 22px;">
            <div>
              <div style="font-size: 9px; color: #64748b; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 5px;">MÃ¼ÅŸteri</div>
              <div style="font-size: 14px; color: #0f172a; font-weight: 800;">${companyName}</div>
            </div>
            <div>
              <div style="font-size: 9px; color: #64748b; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 5px;">Ä°lgili KiÅŸi</div>
              <div style="font-size: 14px; color: #0f172a; font-weight: 800;">${contactPerson}</div>
            </div>
          </div>
          
          <div style="background: #f8fafc; padding: 16px 20px; border-radius: 8px; border: 1px solid #e2e8f0;">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; align-items: center;">
              <div>
                <div style="font-size: 9px; color: #64748b; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px;">HazÄ±rlayan</div>
                <div style="font-size: 13px; color: #0f172a; font-weight: 800;">Optimizi.App</div>
              </div>
              <div>
                <div style="font-size: 9px; color: #64748b; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px;">Tarih</div>
                <div style="font-size: 13px; color: #0f172a; font-weight: 800;">${today}</div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Alt KÄ±sÄ±m - Logo ve Copyright -->
        <div style="margin-top: auto; padding-top: 30px;">
          <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
            <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #06b6d4 0%, #3b82f6 100%); border-radius: 10px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(6, 182, 212, 0.3);">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"></path>
              </svg>
            </div>
            <div>
              <div style="font-size: 20px; font-weight: 900; color: #0f172a; line-height: 1;">
                Optimizi<span style="background: linear-gradient(135deg, #06b6d4, #3b82f6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">.App</span>
              </div>
              <div style="font-size: 8px; color: #94a3b8; font-weight: 600; letter-spacing: 1.5px; margin-top: 2px;">YOÄUÅMA Ã–NLEYÄ°CÄ° YALITIM MODÃœLÃœ</div>
            </div>
          </div>
          <div style="font-size: 8px; color: #cbd5e1; line-height: 1.5;">
            Â© ${new Date().getFullYear()} Optimizi.YoÄŸuÅŸma - TÃ¼m haklarÄ± saklÄ±dÄ±r<br>
            Bu rapor Optimizi.App termal analiz yazÄ±lÄ±mÄ± kullanÄ±larak oluÅŸturulmuÅŸtur
          </div>
        </div>
      </div>
    </div>
  `;
  
  let pageNum = 1;
  Object.keys(groupedByDN).forEach(dn => {
    pageNum++;
    const solutions = groupedByDN[dn];
    const firstSol = solutions[0];
    
    pagesHTML += `
      <div class="print-page">
        <div class="print-header">
          <div>
            <div style="font-size: 9px; color: #06b6d4; font-weight: 700; letter-spacing: 1px; margin-bottom: 3px;">YOÄUÅMA Ã–NLEME ANALÄ°ZÄ°</div>
            <h2 style="font-size: 18px; font-weight: 900; color: #0f172a; margin: 0;">DN${dn} - Boru Ã‡apÄ± Analizi</h2>
          </div>
          <div style="text-align: right;">
            <div style="font-size: 8px; color: #94a3b8; margin-bottom: 2px;">${today}</div>
            <div style="font-size: 8px; color: #94a3b8;">Sayfa ${pageNum} / ${totalPages}</div>
          </div>
        </div>
        
        <div class="print-section">
          <div style="background: linear-gradient(135deg, #ecfeff, #dbeafe); padding: 15px; border-radius: 10px; border-left: 4px solid #06b6d4; margin-bottom: 20px;">
            <h3 style="font-size: 11px; font-weight: 800; color: #0e7490; text-transform: uppercase; margin: 0 0 12px 0; letter-spacing: 0.5px;">
              ğŸ“‹ Proje Parametreleri
            </h3>
            <table style="width: 100%; font-size: 9px;">
              <tr>
                <td style="padding: 5px 0; color: #475569; width: 140px;">Boru Ã‡apÄ±</td>
                <td style="padding: 5px 0; font-weight: 700; color: #0f172a; width: 140px;">DN${dn} (DÄ±ÅŸ Ã‡ap: ${firstSol.pipeOD}mm)</td>
                <td style="padding: 5px 0; color: #475569; width: 140px;">Proses SÄ±caklÄ±ÄŸÄ±</td>
                <td style="padding: 5px 0; font-weight: 700; color: #dc2626;">${firstSol.tProc}Â°C</td>
              </tr>
              <tr>
                <td style="padding: 5px 0; color: #475569;">Ortam SÄ±caklÄ±ÄŸÄ±</td>
                <td style="padding: 5px 0; font-weight: 700; color: #2563eb;">${firstSol.tAmb}Â°C</td>
                <td style="padding: 5px 0; color: #475569;">Ortam BaÄŸÄ±l Nem</td>
                <td style="padding: 5px 0; font-weight: 700; color: #0f172a;">${firstSol.rhAmb}%</td>
              </tr>
              <tr>
                <td style="padding: 5px 0; color: #475569;">RÃ¼zgar HÄ±zÄ±</td>
                <td style="padding: 5px 0; font-weight: 700; color: #0f172a;">${firstSol.vWind} m/s</td>
                <td style="padding: 5px 0; color: #475569;">Ortam Tipi</td>
                <td style="padding: 5px 0; font-weight: 700; color: #0f172a;">${firstSol.vWind <= 0.5 ? 'Ä°Ã§ Mekan' : 'DÄ±ÅŸ Mekan'}</td>
              </tr>
              <tr style="background: #fef3c7;">
                <td style="padding: 8px 5px; color: #92400e; font-weight: 700;">Ã‡iy NoktasÄ± (Kritik)</td>
                <td style="padding: 8px 5px; font-weight: 900; color: #b45309; font-size: 11px;">${firstSol.tDew.toFixed(1)}Â°C</td>
                <td style="padding: 8px 5px; color: #92400e; font-weight: 700;">Hedef YÃ¼zey SÄ±caklÄ±ÄŸÄ±</td>
                <td style="padding: 8px 5px; font-weight: 900; color: #059669; font-size: 11px;">${firstSol.tTarget.toFixed(1)}Â°C (Ã‡iy + 3Â°C)</td>
              </tr>
            </table>
          </div>
        </div>
        
        <div class="print-section">
          <h3 style="font-size: 11px; font-weight: 800; color: #0e7490; text-transform: uppercase; margin-bottom: 12px; letter-spacing: 0.5px;">
            ğŸ¯ SeÃ§ilen Ä°zolasyon Ã‡Ã¶zÃ¼mleri
          </h3>
          <table class="audit-table" style="width: 100%; border-collapse: collapse;">
            <thead>
              <tr>
                <th style="text-align: center; width: 30px;">#</th>
                <th style="text-align: left;">Ä°zolasyon Malzemesi</th>
                <th style="text-align: center; width: 70px;">Î» (W/mÂ·K)</th>
                <th style="text-align: center; width: 60px;">KalÄ±nlÄ±k</th>
                <th style="text-align: center; width: 70px;">YÃ¼zey SÄ±c.</th>
                <th style="text-align: center; width: 70px;">GÃ¼v. MarjÄ±</th>
                <th style="text-align: center; width: 70px;">Durum</th>
              </tr>
            </thead>
            <tbody>
              ${solutions.map((sol, idx) => `
                <tr ${!sol.safe ? 'style="background-color: #fee2e2 !important;"' : ''}>
                  <td style="text-align: center; font-weight: 700; color: #64748b;">${idx + 1}</td>
                  <td style="font-weight: 700; color: #0f172a;">${sol.material}</td>
                  <td style="text-align: center; font-family: monospace; color: #475569;">${sol.lambda.toFixed(3)}</td>
                  <td style="text-align: center; font-weight: 700; font-size: 9px; color: #0f172a;">${sol.thickness}mm</td>
                  <td style="text-align: center; font-weight: 700; font-size: 9px; color: #0f172a;">${sol.surfTemp.toFixed(1)}Â°C</td>
                  <td style="text-align: center; font-weight: 700; font-size: 9px; color: ${sol.margin >= 3 ? '#059669' : '#dc2626'};">
                    ${sol.margin >= 0 ? '+' : ''}${sol.margin.toFixed(1)}Â°C
                  </td>
                  <td style="text-align: center; font-weight: 700; font-size: 9px;">
                    ${sol.safe ? '<span style="color: #059669;">âœ“ GÃœVENLÄ°</span>' : '<span style="color: #dc2626;">âœ— YETERSÄ°Z</span>'}
                  </td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        </div>
        
        <div style="margin-top: 20px; padding: 12px; background: #f0f9ff; border-radius: 8px; border: 1px solid #bae6fd;">
          <p style="font-size: 8px; color: #075985; margin: 0; line-height: 1.5;">
            <strong style="font-size: 9px;">ğŸ“Œ Teknik Not:</strong> Hesaplamalar ISO 12241 standardÄ±na gÃ¶re yapÄ±lmÄ±ÅŸtÄ±r. 
            Radyasyon ve doÄŸal konveksiyon Ä±sÄ± transferi dahil edilmiÅŸtir. GÃ¼venlik marjÄ± 3Â°C olarak alÄ±nmÄ±ÅŸtÄ±r.
            ${solutions.filter(s => s.safe).length > 0 ? 
              `<br><strong style="color: #059669; font-size: 9px;">âœ“ Bu sayfada ${solutions.filter(s => s.safe).length} adet gÃ¼venli Ã§Ã¶zÃ¼m bulunmaktadÄ±r.</strong>` : 
              `<br><strong style="color: #dc2626; font-size: 9px;">âš ï¸ SeÃ§ilen Ã§Ã¶zÃ¼mlerin hiÃ§biri yoÄŸuÅŸma Ã¶nleme iÃ§in yeterli deÄŸildir.</strong>`
            }
          </p>
        </div>
        
        <div style="position: absolute; bottom: 20px; left: 50px; right: 50px; display: flex; justify-content: space-between; align-items: center; border-top: 1px solid #e2e8f0; padding-top: 10px;">
          <div style="font-size: 7px; color: #94a3b8;">Optimizi.YoÄŸuÅŸma Â© ${new Date().getFullYear()}</div>
          <div style="font-size: 7px; color: #94a3b8;">Sayfa ${pageNum} / ${totalPages}</div>
        </div>
      </div>
    `;
  });
  
  // METODOLOJÄ° VE CUI RÄ°SK SAYFASI
  pagesHTML += `
    <div class="print-page">
      <div class="print-header">
        <div>
          <div style="font-size: 9px; color: #06b6d4; font-weight: 700; letter-spacing: 1px; margin-bottom: 3px;">TEKNÄ°K METODOLOJÄ°</div>
          <h2 style="font-size: 18px; font-weight: 900; color: #0f172a; margin: 0;">Hesaplama StandartlarÄ± & YAK Risk DeÄŸerlendirmesi</h2>
        </div>
        <div style="text-align: right;">
          <div style="font-size: 8px; color: #94a3b8; margin-bottom: 2px;">${today}</div>
          <div style="font-size: 8px; color: #94a3b8;">Sayfa ${totalPages} / ${totalPages}</div>
        </div>
      </div>
      
      <!-- HESAPLAMA METODOLOJÄ°SÄ° -->
      <div class="print-section">
        <h3 style="font-size: 12px; font-weight: 800; color: #0e7490; text-transform: uppercase; margin-bottom: 12px; letter-spacing: 0.5px;">
          ğŸ“ Hesaplama Metodu
        </h3>
        
        <div style="background: #f8fafc; padding: 18px; border-radius: 10px; border: 1px solid #e2e8f0; margin-bottom: 15px;">
          <h4 style="font-size: 10px; font-weight: 800; color: #0f172a; margin: 0 0 10px 0;">1. Ã‡iÄŸ NoktasÄ± HesaplamasÄ± (Magnus FormÃ¼lÃ¼)</h4>
          <p style="font-size: 9px; color: #475569; margin: 0 0 8px 0; line-height: 1.6;">
            Ã‡iÄŸ noktasÄ± sÄ±caklÄ±ÄŸÄ± Magnus-Tetens yaklaÅŸÄ±m formÃ¼lÃ¼ ile hesaplanÄ±r:
          </p>
          <div style="background: white; padding: 12px; border-radius: 6px; border: 1px solid #e2e8f0; font-family: monospace; font-size: 9px; color: #0f172a; margin-bottom: 8px;">
            T_Ã§iÄŸ = (b Ã— Î±) / (a âˆ’ Î±)<br>
            burada: Î± = (a Ã— T) / (b + T) + ln(RH/100)<br>
            a = 17.27, b = 237.7Â°C
          </div>
          <p style="font-size: 8px; color: #64748b; margin: 0; line-height: 1.5;">
            <strong>Standart:</strong> HVAC ÅŸartlarÄ±nda Â±0.4Â°C doÄŸrulukla meteorolojide yaygÄ±n kullanÄ±lan formÃ¼l.
          </p>
        </div>
        
        <div style="background: #f8fafc; padding: 18px; border-radius: 10px; border: 1px solid #e2e8f0; margin-bottom: 15px;">
          <h4 style="font-size: 10px; font-weight: 800; color: #0f172a; margin: 0 0 10px 0;">2. IsÄ± Transferi & YÃ¼zey SÄ±caklÄ±ÄŸÄ± (ISO 12241)</h4>
          <p style="font-size: 9px; color: #475569; margin: 0 0 8px 0; line-height: 1.6;">
            YÃ¼zey sÄ±caklÄ±ÄŸÄ± termal direnÃ§ aÄŸÄ± ile hesaplanÄ±r:
          </p>
          <div style="background: white; padding: 12px; border-radius: 6px; border: 1px solid #e2e8f0; font-family: monospace; font-size: 8px; color: #0f172a; margin-bottom: 8px; line-height: 1.8;">
            R_yal = ln(râ‚‚/râ‚) / (2Ï€ Ã— Î» Ã— L)<br>
            R_dÄ±ÅŸ = 1 / (2Ï€ Ã— râ‚‚ Ã— h_toplam Ã— L)<br>
            h_toplam = h_konv + h_rad<br><br>
            <strong>Konveksiyon:</strong> h_konv = 10.45 âˆ’ v + 10âˆšv (McAdams korelasyonu)<br>
            <strong>Radyasyon:</strong> h_rad = Îµ Ã— Ïƒ Ã— (T_ortÂ² + T_yÃ¼zÂ²) Ã— (T_ort + T_yÃ¼z)
          </div>
          <p style="font-size: 8px; color: #64748b; margin: 0; line-height: 1.5;">
            <strong>Standartlar:</strong> ISO 12241 (Bina ekipmanÄ± termal yalÄ±tÄ±mÄ±), ASTM C680 (IsÄ± kaybÄ± hesaplama), EN ISO 12241.
          </p>
        </div>
        
        <div style="background: #f8fafc; padding: 18px; border-radius: 10px; border: 1px solid #e2e8f0;">
          <h4 style="font-size: 10px; font-weight: 800; color: #0f172a; margin: 0 0 10px 0;">3. GÃ¼venlik MarjÄ± & TasarÄ±m Kriterleri</h4>
          <p style="font-size: 9px; color: #475569; margin: 0; line-height: 1.6;">
            YÃ¼zey sÄ±caklÄ±ÄŸÄ± minimum <strong>T_Ã§iÄŸ + 3Â°C</strong> seviyesinde tutulmalÄ±dÄ±r. Bu deÄŸer:<br>
            â€¢ TÃ¼m Ã§alÄ±ÅŸma ÅŸartlarÄ±nda yoÄŸuÅŸma oluÅŸumunu Ã¶nler<br>
            â€¢ Nem dalgalanmalarÄ± iÃ§in gÃ¼venlik marjÄ± saÄŸlar<br>
            â€¢ ASHRAE ve CIBSE standartlarÄ±na uygunluk saÄŸlar
          </p>
        </div>
      </div>
      
      <!-- YAK RÄ°SK DEÄERLENDÄ°RMESÄ° -->
      <div class="print-section">
        <h3 style="font-size: 12px; font-weight: 800; color: #dc2626; text-transform: uppercase; margin-bottom: 12px; letter-spacing: 0.5px;">
          âš ï¸ YAK Risk DeÄŸerlendirmesi (YalÄ±tÄ±m AltÄ± Korozyon)
        </h3>
        
        <div style="background: #fef2f2; padding: 18px; border-radius: 10px; border-left: 4px solid #dc2626; margin-bottom: 12px;">
          <h4 style="font-size: 10px; font-weight: 800; color: #991b1b; margin: 0 0 10px 0;">YAK Nedir?</h4>
          <p style="font-size: 9px; color: #7f1d1d; margin: 0; line-height: 1.7;">
            YalÄ±tÄ±m AltÄ± Korozyon (YAK), soÄŸuk boru sistemlerindeki en ciddi ve maliyetli bÃ¼tÃ¼nlÃ¼k tehdididir. 
            Nem, yalÄ±tÄ±m bariyerlerinden geÃ§erek boru yÃ¼zeyinde yoÄŸuÅŸtuÄŸunda, gÃ¶rsel denetimle tespit edilemeyen 
            elektrokimyasal bir korozyon hÃ¼cresi oluÅŸturur. YoÄŸuÅŸma, korozyonun tetikleyicisidir.
          </p>
        </div>
        
        <div style="background: white; padding: 15px; border-radius: 8px; border: 1px solid #fee2e2; margin-bottom: 12px;">
          <h4 style="font-size: 10px; font-weight: 800; color: #dc2626; margin: 0 0 10px 0;">Birincil Risk FaktÃ¶rleri:</h4>
          <div style="font-size: 8px; color: #475569; line-height: 1.8;">
            <strong>1. Yetersiz YalÄ±tÄ±m KalÄ±nlÄ±ÄŸÄ±:</strong> YÃ¼zey sÄ±caklÄ±ÄŸÄ± Ã§iÄŸ noktasÄ±nÄ±n altÄ±na dÃ¼ÅŸtÃ¼ÄŸÃ¼nde yoÄŸuÅŸma kaÃ§Ä±nÄ±lmazdÄ±r<br>
            <strong>2. HatalÄ± Buhar Bariyeri UygulamasÄ±:</strong> BoÅŸluklar, yÄ±rtÄ±klar veya sÄ±zdÄ±rmaz olmayan baÄŸlantÄ±lar nem giriÅŸine izin verir<br>
            <strong>3. SÄ±caklÄ±k DalgalanmalarÄ±:</strong> Tekrarlayan termal genleÅŸme/bÃ¼zÃ¼lme mekanik stres ve conta arÄ±zalarÄ±na neden olur<br>
            <strong>4. YÃ¼ksek Nem OrtamlarÄ±:</strong> YÃ¼ksek Ã§iÄŸ noktalarÄ± daha kalÄ±n yalÄ±tÄ±m sistemleri gerektirir<br>
            <strong>5. AÃ§Ä±k Hava/DÄ±ÅŸ Ortam:</strong> YaÄŸmur, rÃ¼zgar kaynaklÄ± nem ve UV bozunmasÄ± bariyer arÄ±zasÄ±nÄ± hÄ±zlandÄ±rÄ±r
          </div>
        </div>
        
        <div style="background: #fff7ed; padding: 15px; border-radius: 8px; border: 1px solid #fed7aa; margin-bottom: 12px;">
          <h4 style="font-size: 10px; font-weight: 800; color: #c2410c; margin: 0 0 8px 0;">YAK'Ä±n SonuÃ§larÄ±:</h4>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 8px; color: #7c2d12;">
            <div>
              â€¢ <strong>YapÄ±sal Hasar:</strong> Boru duvar incelmesi, sÄ±zÄ±ntÄ±lar, patlama<br>
              â€¢ <strong>GÃ¼venlik Tehlikeleri:</strong> SoÄŸuk akÄ±ÅŸkan sÄ±zÄ±ntÄ±sÄ±, kayma riskleri<br>
              â€¢ <strong>Ãœretim KaybÄ±:</strong> PlanlanmamÄ±ÅŸ duruÅŸlar, onarÄ±mlar
            </div>
            <div>
              â€¢ <strong>Ekonomik Etki:</strong> DeÄŸiÅŸtirme maliyeti Ã¶nlemenin 5-10 katÄ±<br>
              â€¢ <strong>Ã‡evresel Risk:</strong> SoÄŸutucu akÄ±ÅŸkan sÄ±zÄ±ntÄ±sÄ± cezalarÄ±<br>
              â€¢ <strong>Mevzuat UyumsuzluÄŸu:</strong> Kod ihlalleri, para cezalarÄ±
            </div>
          </div>
        </div>
        
        <div style="background: #ecfdf5; padding: 15px; border-radius: 8px; border-left: 4px solid #059669;">
          <h4 style="font-size: 10px; font-weight: 800; color: #065f46; margin: 0 0 8px 0;">DoÄŸru TasarÄ±m ile YoÄŸuÅŸma Ã–nleme:</h4>
          <p style="font-size: 8px; color: #064e3b; margin: 0; line-height: 1.7;">
            Bu rapor, yÃ¼zey sÄ±caklÄ±klarÄ±nÄ± kritik Ã§iÄŸ noktasÄ± eÅŸiÄŸinin Ã¼zerinde tutan bilimsel olarak hesaplanmÄ±ÅŸ yalÄ±tÄ±m 
            kalÄ±nlÄ±klarÄ± sunar. <strong style="color: #059669;">"GÃœVENLÄ°"</strong> iÅŸaretli Ã§Ã¶zÃ¼mleri seÃ§erek, yoÄŸuÅŸma kaynaklÄ± 
            YAK'a karÅŸÄ± uzun vadeli koruma saÄŸlar, varlÄ±k Ã¶mrÃ¼nÃ¼ 15-20 yÄ±l uzatÄ±r ve maliyetli onarÄ±m dÃ¶ngÃ¼lerini ortadan kaldÄ±rÄ±rsÄ±nÄ±z. 
            SÃ¼rekli buhar bariyerli uygun montaj, sistem performansÄ± iÃ§in eÅŸit derecede kritiktir.
          </p>
        </div>
      </div>
      
      <div style="position: absolute; bottom: 20px; left: 50px; right: 50px; display: flex; justify-content: space-between; align-items: center; border-top: 1px solid #e2e8f0; padding-top: 10px;">
        <div style="font-size: 7px; color: #94a3b8;">Optimizi.YoÄŸuÅŸma Â© ${new Date().getFullYear()}</div>
        <div style="font-size: 7px; color: #94a3b8;">Sayfa ${totalPages} / ${totalPages}</div>
      </div>
    </div>
  `;
  
  wrapper.innerHTML = pagesHTML;
  
  setTimeout(() => {
    window.print();
  }, 500);
}

// ====================================
// BÄ°LDÄ°RÄ°M
// ====================================
function showNotification(message, type = 'success') {
  const colors = {
    success: 'bg-emerald-500',
    warning: 'bg-amber-500',
    info: 'bg-blue-500'
  };
  
  const notification = document.createElement('div');
  notification.className = `fixed top-24 right-8 ${colors[type]} text-white px-6 py-3 rounded-xl shadow-2xl font-bold text-sm z-50`;
  notification.innerHTML = `
    <i data-lucide="${type === 'success' ? 'check-circle' : type === 'warning' ? 'alert-triangle' : 'info'}" class="w-4 h-4 inline mr-2"></i>
    ${message}
  `;
  
  document.body.appendChild(notification);
  lucide.createIcons();
  
  setTimeout(() => {
    notification.style.opacity = '0';
    notification.style.transform = 'translateX(400px)';
    notification.style.transition = 'all 0.3s ease';
    setTimeout(() => notification.remove(), 300);
  }, 2500);
}

// ====================================
// BAÅLATMA
// ====================================
function initApp() {
  const select = document.getElementById('dn');
  for (const [dn, od] of Object.entries(PIPES)) {
    const opt = document.createElement('option');
    opt.value = dn;
    opt.text = `DN ${dn} (Ã˜ ${od}mm)`;
    select.add(opt);
  }
  select.value = '100';
  
  lucide.createIcons();
  calculate();
}

window.onload = initApp;
</script>
<script src="guard.js?v=2"></script>
</body>
</html>
