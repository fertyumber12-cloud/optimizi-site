<!doctype html>
<html lang="tr" class="dark">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Canlı Tasarruf Takibi | Optimizi.App</title>
<meta name="robots" content="noindex">
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700;800&family=JetBrains+Mono:wght@700&display=swap" rel="stylesheet">
<link rel="icon" href="favicon.png" type="image/png">

<script>
  tailwind.config = {
    darkMode: 'class',
    theme: {
      fontFamily: { sans: ['"Plus Jakarta Sans"', 'sans-serif'], mono: ['"JetBrains Mono"', 'monospace'] },
      extend: {}
    }
  }
</script>
<style>
  body { background: #010409; color: #f1f5f9; min-height: 100vh; display: flex; flex-direction: column; overflow: hidden; position: relative; }
  .glass-card { background-color: rgba(10, 15, 29, 0.85); backdrop-filter: blur(25px); border: 1px solid rgba(255, 255, 255, 0.05); z-index: 10; }
  
  .bg-grid { 
      background-size: 40px 40px; 
      background-image: linear-gradient(to right, rgba(255, 255, 255, 0.02) 1px, transparent 1px), linear-gradient(to bottom, rgba(255, 255, 255, 0.02) 1px, transparent 1px); 
  }
  .counter-text { font-variant-numeric: tabular-nums; }
</style>
</head>
<body class="antialiased font-sans">

<div class="fixed inset-0 z-0 bg-grid opacity-20"></div>

<main class="relative z-10 flex-1 flex flex-col items-center justify-center p-4 w-full max-w-md mx-auto">
    
    <div class="mb-6 scale-110">
        <h1 class="text-2xl font-black text-white tracking-tighter uppercase italic">Optimizi<span class="text-green-500">.App</span></h1>
    </div>

    <div class="glass-card p-8 rounded-[2.5rem] w-full relative overflow-hidden shadow-[0_0_50px_rgba(0,0,0,0.5)]">
        
        <div class="flex justify-between items-start mb-6">
            <div class="text-left">
                <div class="text-[10px] text-slate-500 uppercase font-black tracking-widest mb-1">Ürün / Lokasyon</div>
                <h2 class="text-xl font-bold text-white tracking-tight leading-none mb-1" id="prdName">Yükleniyor...</h2>
                <div class="text-[10px] text-green-500 font-mono font-bold" id="prdSerial">ID: ---</div>
            </div>
            <div class="flex items-center gap-1.5 px-3 py-1 rounded-full bg-green-500/10 border border-green-500/20 text-[10px] text-green-400 font-bold uppercase tracking-tighter">
                <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse shadow-[0_0_10px_#22c55e]"></span> Canlı
            </div>
        </div>
        
        <div class="text-center py-8 rounded-[2rem] bg-black/40 border border-white/5 mb-6 relative group">
            <div class="absolute inset-0 bg-green-500/5 blur-xl rounded-[2rem] transition"></div>
            <div class="relative z-10 w-full px-2">
                <div class="text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-2">Toplam Finansal Kazanç</div>
                <div class="flex items-baseline justify-center gap-1 flex-wrap">
                    <span id="liveMoney" class="font-black text-white counter-text tracking-tighter drop-shadow-[0_0_10px_rgba(34,197,94,0.5)] transition-all duration-300 text-5xl">0,00</span>
                    <span class="text-2xl font-bold text-green-500">₺</span>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-2 gap-4 mb-6">
            <div class="p-4 rounded-2xl bg-white/[0.03] border border-white/5 text-center relative overflow-hidden">
                <div class="text-[10px] font-bold text-green-400 uppercase mb-2 flex items-center justify-center gap-1.5">
                    <i data-lucide="leaf" class="w-3.5 h-3.5"></i> CO2 Azaltım
                </div>
                <div class="text-xl font-bold text-white tracking-tight"><span id="liveCarbon" class="counter-text">0,00</span> <span class="text-[9px] text-slate-500 font-bold uppercase">Ton</span></div>
                <div class="text-[10px] text-green-500/80 mt-2 font-bold flex items-center justify-center gap-1">
                    <i data-lucide="sprout" class="w-3 h-3"></i> <span id="liveTree">0 Ağaç</span>
                </div>
            </div>

            <div class="p-4 rounded-2xl bg-white/[0.03] border border-white/5 text-center relative overflow-hidden">
                <div class="text-[10px] font-bold text-orange-400 uppercase mb-2 flex items-center justify-center gap-1.5">
                    <i data-lucide="flame" class="w-3.5 h-3.5"></i> <span id="fuelLabel">Yakıt</span>
                </div>
                <div class="text-xl font-bold text-white tracking-tight"><span id="liveFuel" class="counter-text">0,00</span> <span id="fuelUnit" class="text-[9px] text-slate-500 font-bold uppercase">m³</span></div>
                <div class="text-[8px] text-slate-500 mt-2 font-black italic uppercase tracking-tighter text-center">Enerji Verimliliği</div>
            </div>
        </div>

        <div class="grid grid-cols-2 gap-4 border-t border-white/10 pt-6">
            <div class="font-sans text-left">
                <div class="flex items-center gap-1.5 text-[10px] text-slate-500 font-bold uppercase mb-1">
                    <i data-lucide="calendar" class="w-3 h-3"></i> Montaj
                </div>
                <div id="installDate" class="text-xs text-white font-mono tracking-wide">...</div>
            </div>
            <div class="font-sans text-right">
                <div class="flex items-center justify-end gap-1.5 text-[10px] text-slate-500 font-bold uppercase mb-1">
                    Süre <i data-lucide="clock" class="w-3 h-3"></i>
                </div>
                <div id="runTime" class="text-xs text-white font-mono tracking-wide">...</div>
            </div>
        </div>
        
        <div id="clientBox" class="mt-6 pt-4 border-t border-white/5 text-center hidden">
            <div class="inline-flex items-center gap-2 px-3 py-1 bg-slate-800 rounded text-[10px] text-slate-400 font-bold uppercase tracking-wider">
                <i data-lucide="building-2" class="w-3 h-3"></i> <span id="clientName"></span>
            </div>
        </div>

    </div>
    
    <div class="mt-8 opacity-50 hover:opacity-100 transition">
        <div class="flex items-center justify-center gap-2 text-[10px] text-slate-500 font-bold tracking-widest">
            <i data-lucide="shield-check" class="w-3 h-3 text-green-500"></i> Verified by Optimizi.App
        </div>
    </div>
</main>

<script>
    lucide.createIcons();
    
    const params = new URLSearchParams(window.location.search);
    
    const config = {
        name: decodeURIComponent(params.get('p') || 'Endüstriyel Yalıtım'),
        sn: params.get('s') || 'DEMO-001',
        start: params.get('d') || new Date().toISOString().split('T')[0],
        save: parseFloat(params.get('v')) || 10000,
        fuel: params.get('f') || 'gas',
        price: parseFloat(params.get('up')) || 10.0,
        client: params.get('c') ? decodeURIComponent(params.get('c')) : null
    };

    // --- YAKIT AYARLARI (GENERATOR İLE EŞİTLENDİ) ---
    const fuels = {
        gas:       { unit: 'm³',  co2: 0.0019, label: 'Doğalgaz' },    
        elec:      { unit: 'kWh', co2: 0.00045, label: 'Elektrik' },   
        lng:       { unit: 'kg',  co2: 0.0028, label: 'LNG' },         
        fueloil:   { unit: 'kg',  co2: 0.0031, label: 'Fuel Oil' },    
        // İthal ve Yerli Kömür Eklendi:
        coal_imp:  { unit: 'kg',  co2: 0.0025, label: 'İthal Kömür' }, 
        coal_loc:  { unit: 'kg',  co2: 0.0015, label: 'Yerli Kömür' },
        // Eski kodlarla uyumluluk için (Fallback)
        coal:      { unit: 'kg',  co2: 0.0025, label: 'Kömür' } 
    };

    // Seçilen yakıtı ayarla
    const f = fuels[config.fuel] || fuels.gas;

    // UI Doldur
    document.getElementById('prdName').innerText = config.name;
    document.getElementById('prdSerial').innerText = `ID: ${config.sn}`;
    document.getElementById('fuelUnit').innerText = f.unit;
    document.getElementById('fuelLabel').innerText = f.label;
    
    if(config.client) {
        document.getElementById('clientBox').classList.remove('hidden');
        document.getElementById('clientName').innerText = config.client;
    }

    const p = config.start.split('-');
    const startDate = new Date(p[0], p[1]-1, p[2], 0, 0, 0).getTime();
    document.getElementById('installDate').innerText = new Date(startDate).toLocaleDateString('tr-TR', {day:'2-digit', month:'long', year:'numeric'});

    const savePerMs = config.save / 31536000000;

    function updateCounter() {
        const now = new Date().getTime();
        const diff = now - startDate;

        if (diff > 0) {
            const money = diff * savePerMs;
            const unitPrice = config.price > 0 ? config.price : 1; 
            const fuelAmount = money / unitPrice;
            const co2Ton = fuelAmount * f.co2;
            const trees = co2Ton / 0.025;

            // Para Formatı
            const moneyStr = money.toLocaleString('tr-TR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            const moneyEl = document.getElementById('liveMoney');
            moneyEl.innerText = moneyStr;

            // --- AUTO-SCALE FONT BOYUTU ---
            // Rakamın uzunluğuna göre fontu küçült (Örn: 1.250.000,00 -> 12 karakter)
            const len = moneyStr.length;
            if(len > 13) {
                moneyEl.className = "font-black text-white counter-text tracking-tighter drop-shadow-[0_0_10px_rgba(34,197,94,0.5)] transition-all duration-300 text-3xl"; 
            } else if (len > 10) {
                moneyEl.className = "font-black text-white counter-text tracking-tighter drop-shadow-[0_0_10px_rgba(34,197,94,0.5)] transition-all duration-300 text-4xl"; 
            } else {
                moneyEl.className = "font-black text-white counter-text tracking-tighter drop-shadow-[0_0_10px_rgba(34,197,94,0.5)] transition-all duration-300 text-5xl"; 
            }

            document.getElementById('liveFuel').innerText = fuelAmount.toLocaleString('tr-TR', { minimumFractionDigits: 1, maximumFractionDigits: 1 });
            document.getElementById('liveCarbon').innerText = co2Ton.toLocaleString('tr-TR', { minimumFractionDigits: 3, maximumFractionDigits: 3 });
            document.getElementById('liveTree').innerText = `${Math.floor(trees)} Ağaç`;

            const d = Math.floor(diff/86400000);
            const h = Math.floor((diff/3600000)%24);
            const m = Math.floor((diff/60000)%60);
            const s = Math.floor((diff/1000)%60);
            
            let timeStr = "";
            if(d > 0) timeStr = `${d} Gün ${h} Saat`;
            else timeStr = `${h} Saat ${m} Dakika`;
            
            document.getElementById('runTime').innerHTML = `${timeStr} <span class="opacity-30 text-[9px]">(${s}sn)</span>`;
        } else {
            document.getElementById('runTime').innerText = "Başlıyor...";
        }
        
        requestAnimationFrame(updateCounter);
    }

    updateCounter();
</script>
</body>
</html>
