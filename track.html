<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>Canlı Tasarruf | Optimizi</title>
<meta name="robots" content="noindex">
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700;800&family=JetBrains+Mono:wght@700&display=swap" rel="stylesheet">
<script>tailwind.config = { theme: { fontFamily: { sans: ['"Plus Jakarta Sans"', 'sans-serif'], mono: ['"JetBrains Mono"', 'monospace'] } } }</script>
<style>
  body { 
      background-color: #0f172a; 
      background-image: 
          radial-gradient(at 0% 0%, rgba(34, 197, 94, 0.15) 0px, transparent 50%),
          radial-gradient(at 100% 100%, rgba(30, 41, 59, 1) 0px, transparent 50%);
      min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; overflow-x: hidden;
      color: #f8fafc;
  }
  .grid-bg {
      position: absolute; inset: 0; pointer-events: none; z-index: 0;
      background-image: linear-gradient(rgba(255,255,255,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px);
      background-size: 30px 30px;
  }
  .spotlight {
      position: absolute; top: -20%; left: 50%; transform: translateX(-50%);
      width: 120%; height: 60vh;
      background: radial-gradient(circle, rgba(74, 222, 128, 0.2) 0%, rgba(34, 197, 94, 0) 60%);
      filter: blur(40px); z-index: 1; pointer-events: none;
  }
  .glass-card { 
      background: rgba(255, 255, 255, 0.05); 
      backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px);
      border: 1px solid rgba(255, 255, 255, 0.1); 
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); 
      z-index: 10; 
  }
  .counter-text { font-variant-numeric: tabular-nums; }
</style>
</head>
<body class="antialiased font-sans">

<div class="grid-bg"></div>
<div class="spotlight"></div>

<main class="relative z-10 w-full max-w-md p-4 flex flex-col items-center justify-center min-h-[90vh]">
    
    <div class="mb-8 scale-100 flex flex-col items-center animate-[fadeIn_0.5s_ease-out]">
        <h1 class="text-3xl font-black text-white tracking-tight">Optimizi<span class="text-green-400">.App</span></h1>
        <p class="text-[10px] text-slate-400 uppercase font-bold tracking-[0.3em] mt-1">Energy Intelligence</p>
    </div>

    <div class="glass-card p-6 rounded-[2rem] w-full border-t-2 border-t-green-500/50">
        
        <div class="flex flex-col gap-4 mb-6">
            <div class="flex justify-between items-start">
                <div class="flex items-center gap-1.5 px-2 py-1 rounded-full bg-green-500/10 border border-green-500/20 text-[10px] text-green-400 font-bold uppercase tracking-wider">
                    <span class="w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"></span> Canlı İzleme
                </div>
                <div class="text-[10px] text-slate-400 font-mono mt-1 opacity-50" id="prdSerial">ID: ---</div>
            </div>
            <div class="text-left pl-1">
                <div id="clientDisplay" class="text-sm font-extrabold text-white uppercase tracking-tight mb-1"></div>
                <h2 class="text-lg font-bold text-slate-300 leading-tight" id="prdName">...</h2>
            </div>
        </div>
        
        <div class="text-center py-8 rounded-3xl bg-white/5 border border-white/10 mb-6 relative overflow-hidden group">
            <div class="absolute inset-0 bg-green-500/5 group-hover:bg-green-500/10 transition duration-500"></div>
            
            <div class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1 relative z-10">Toplam Kazanç</div>
            <div class="flex items-baseline justify-center gap-1 flex-wrap px-2 relative z-10">
                <span id="liveMoney" class="font-black text-white counter-text tracking-tighter text-5xl drop-shadow-lg">0,00</span>
                <span class="text-2xl font-bold text-green-400">₺</span>
            </div>
            <div class="mt-2 text-[9px] text-slate-500 flex items-center justify-center gap-1 relative z-10">
                <i data-lucide="shield-check" class="w-3 h-3"></i> ISO 12241 Standartlarına Göre
            </div>
        </div>

        <div class="grid grid-cols-2 gap-3 mb-6">
            <div class="p-3 rounded-2xl bg-white/5 border border-white/5 text-center">
                <div class="text-[10px] font-bold text-slate-500 uppercase mb-1 flex items-center justify-center gap-1">
                    <i data-lucide="leaf" class="w-3 h-3 text-green-500"></i> Karbon
                </div>
                <div class="text-lg font-bold text-slate-200"><span id="liveCarbon">0</span> <span class="text-[9px] text-slate-500">Ton</span></div>
            </div>
            
            <div class="p-3 rounded-2xl bg-white/5 border border-white/5 text-center">
                <div class="text-[10px] font-bold text-slate-500 uppercase mb-1 flex items-center justify-center gap-1">
                    <i data-lucide="flame" class="w-3 h-3 text-orange-500"></i> <span id="fuelLabel">Yakıt</span>
                </div>
                <div class="text-lg font-bold text-slate-200"><span id="liveFuel">0</span> <span id="fuelUnit" class="text-[9px] text-slate-500">...</span></div>
            </div>
        </div>

        <div class="bg-white/5 border border-white/10 rounded-xl p-4 mb-4">
            <div class="flex items-start gap-3">
                <i data-lucide="info" class="w-4 h-4 text-slate-400 mt-0.5 shrink-0"></i>
                <p class="text-[10px] text-slate-400 leading-relaxed">
                    Bu hesaplama, projenin yıllık <strong class="text-slate-200" id="dispHours">---</strong> saat çalışma süresi ve <strong class="text-slate-200" id="dispPrice">---</strong> birim enerji bedeli baz alınarak oluşturulan ROI raporuna dayanmaktadır.
                </p>
            </div>
        </div>

        <div class="grid grid-cols-2 gap-4 border-t border-white/10 pt-4 text-slate-400">
            <div>
                <div class="text-[10px] font-bold uppercase mb-1 flex items-center gap-1"><i data-lucide="calendar" class="w-3 h-3"></i> Montaj</div>
                <div id="installDate" class="text-xs font-bold text-slate-200">...</div>
                <div id="installTime" class="text-[10px] opacity-60">...</div>
            </div>
            <div class="text-right">
                <div class="text-[10px] font-bold uppercase mb-1 flex items-center justify-end gap-1">Süre <i data-lucide="clock" class="w-3 h-3"></i></div>
                <div id="runTime" class="text-xs font-bold text-slate-200">...</div>
            </div>
        </div>
    </div>
</main>

<script>
    lucide.createIcons();
    const params = new URLSearchParams(window.location.search);

    const config = {
        client: decodeURIComponent(params.get('c') || ''),
        sn: decodeURIComponent(params.get('s') || 'DEMO'),
        start: params.get('d') || new Date().toISOString(),
        saveTL: parseFloat(params.get('v')) || 0, 
        unitPrice: parseFloat(params.get('up')) || 0,
        workHours: params.get('wh') || "---",
        fuel: params.get('f') || 'gas'
    };

    const fData = {
        gas: { unit: 'm³', co2: 0.0019, label: 'Doğalgaz' }, 
        elec: { unit: 'kWh', co2: 0.00045, label: 'Elektrik' }, 
        lng: { unit: 'kg', co2: 0.0028, label: 'LNG' }, 
        fueloil: { unit: 'kg', co2: 0.0031, label: 'Fuel Oil' }, 
        coal_imp: { unit: 'kg', co2: 0.0025, label: 'İthal Kömür' }, 
        coal_loc: { unit: 'kg', co2: 0.0015, label: 'Yerli Kömür' }
    }[config.fuel] || { unit: 'br', co2: 0, label: 'Yakıt' };

    // Verileri Yerleştir
    document.getElementById('prdSerial').innerText = `ID: ${config.sn}`;
    document.getElementById('clientDisplay').innerText = config.client || 'Yalıtım Projesi';
    document.getElementById('fuelUnit').innerText = fData.unit;
    document.getElementById('fuelLabel').innerText = fData.label; // <-- Yakıt ismini burada yazıyoruz
    document.getElementById('prdName').innerText = (config.client ? "Enerji Takip Sistemi" : "Endüstriyel Yalıtım");

    document.getElementById('dispHours').innerText = config.workHours;
    document.getElementById('dispPrice').innerText = `${config.unitPrice} TL (${fData.label})`;

    // Tarih ve Saat
    const p = config.start.split('-');
    const startDate = new Date(p[0], p[1]-1, p[2], p[3]||0, p[4]||0).getTime();
    
    document.getElementById('installDate').innerText = new Date(startDate).toLocaleDateString('tr-TR', {day:'2-digit', month:'long', year:'numeric'});
    document.getElementById('installTime').innerText = `Saat: ${String(p[3]||0).padStart(2,'0')}:${String(p[4]||0).padStart(2,'0')}`;

    // Sayaç Hesaplama
    const savePerMs = config.saveTL / 31536000000;
    const impliedTotalQuantity = config.unitPrice > 0 ? (config.saveTL / config.unitPrice) : 0;
    const quantityPerMs = impliedTotalQuantity / 31536000000;

    function updateCounter() {
        const now = new Date().getTime();
        const diff = now - startDate;

        if(diff > 0) {
            const money = diff * savePerMs;
            const fuelAmount = diff * quantityPerMs;
            const co2Ton = fuelAmount * fData.co2;

            document.getElementById('liveMoney').innerText = money.toLocaleString('tr-TR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            document.getElementById('liveFuel').innerText = fuelAmount.toLocaleString('tr-TR', { minimumFractionDigits: 1, maximumFractionDigits: 1 });
            document.getElementById('liveCarbon').innerText = co2Ton.toLocaleString('tr-TR', { minimumFractionDigits: 3, maximumFractionDigits: 3 });

            const d = Math.floor(diff/86400000);
            const h = Math.floor((diff/3600000)%24);
            const m = Math.floor((diff/60000)%60);
            
            let timeStr = "";
            if(d > 0) timeStr = `${d} Gün ${h} Sa`;
            else timeStr = `${h} Sa ${m} Dk`;

            document.getElementById('runTime').innerText = timeStr;
        } else {
            document.getElementById('runTime').innerText = "Bekleniyor...";
        }
        requestAnimationFrame(updateCounter);
    }

    updateCounter();
</script>
</body>
</html>
