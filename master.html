<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>INSJACK® Pro Pricing | Optimizi</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600;700&display=swap');

:root {
    /* DARK THEME */
    --bg-grad: radial-gradient(circle at top right, #1e1b4b, #0f172a, #020617);
    --bg-nav: rgba(15, 23, 42, 0.75);
    --bg-card: rgba(30, 41, 59, 0.6);
    --bg-card-hov: rgba(30, 41, 59, 0.9);
    --bg-th: rgba(15, 23, 42, 0.95);
    --bg-inp: rgba(0, 0, 0, 0.3);
    
    --brd: rgba(255, 255, 255, 0.08);
    --brd-td: rgba(255, 255, 255, 0.04);
    
    --tx: #f8fafc;
    --tx-mut: #94a3b8;
    
    --ac: #6366f1;
    --cy: #06b6d4;
    --gn: #10b981;
    --rd: #f43f5e;
    --am: #f59e0b;
    
    --sW: 250px;
}

[data-theme="light"] {
    /* LIGHT THEME */
    --bg-grad: radial-gradient(circle at top right, #e0e7ff, #f8fafc, #f1f5f9);
    --bg-nav: rgba(255, 255, 255, 0.8);
    --bg-card: rgba(255, 255, 255, 0.6);
    --bg-card-hov: rgba(255, 255, 255, 0.95);
    --bg-th: rgba(241, 245, 249, 0.95);
    --bg-inp: rgba(0, 0, 0, 0.04);
    
    --brd: rgba(0, 0, 0, 0.1);
    --brd-td: rgba(0, 0, 0, 0.05);
    
    --tx: #0f172a;
    --tx-mut: #64748b;
}

* { margin:0; padding:0; box-sizing:border-box; }
body { font-family:'Plus Jakarta Sans',sans-serif; background:var(--bg-grad); color:var(--tx); height:100vh; overflow:hidden; display:flex; transition: background 0.3s ease, color 0.3s ease; }

::-webkit-scrollbar { width:6px; height:6px; }
::-webkit-scrollbar-thumb { background:var(--brd); border-radius:4px; }

/* LAYOUT */
.snav { width:var(--sW); min-width:var(--sW); height:100vh; background:var(--bg-nav); backdrop-filter:blur(16px); border-right:1px solid var(--brd); display:flex; flex-direction:column; overflow:hidden; z-index:20; transition:0.3s; }
.snav .logo { padding:24px; display:flex; align-items:center; gap:12px; border-bottom:1px solid var(--brd); }
.snav .logo .ic { width:40px; height:40px; border-radius:10px; background:linear-gradient(135deg,var(--cy),var(--ac)); display:flex; align-items:center; justify-content:center; box-shadow: 0 4px 15px rgba(99,102,241,.2); }
.snav .links { flex:1; padding:16px; display:flex; flex-direction:column; gap:4px; overflow-y:auto; }

.slink { display:flex; align-items:center; gap:12px; padding:12px 16px; border-radius:10px; cursor:pointer; font-size:.85rem; font-weight:600; color:var(--tx-mut); transition:.2s; border:1px solid transparent; background:none; width:100%; text-align:left; }
.slink:hover { color:var(--tx); background:var(--bg-card); }
.slink.on { background:rgba(99,102,241,.15); color:var(--ac); border-color:rgba(99,102,241,.3); box-shadow:0 4px 12px rgba(0,0,0,.05); }

.mn { flex:1; display:flex; flex-direction:column; overflow:hidden; position:relative; }
.tbar { height:64px; display:flex; align-items:center; justify-content:space-between; padding:0 32px; border-bottom:1px solid var(--brd); background:var(--bg-nav); backdrop-filter:blur(16px); flex-shrink:0; z-index:10; transition:0.3s; }
.pane { display:none; flex:1; overflow:auto; padding:24px; }
.pane.on { display:flex; flex-direction:column; animation:fadeIn 0.3s ease; }
@keyframes fadeIn { from{opacity:0; transform:translateY(10px)} to{opacity:1; transform:translateY(0)} }

/* SPREADSHEET */
.ss { width:100%; border-collapse:separate; border-spacing:0; font-size:.76rem; font-family:'JetBrains Mono',monospace; }
.ss th { background:var(--bg-th); color:var(--ac); font-size:.68rem; font-weight:800; text-transform:uppercase; letter-spacing:.5px; padding:10px 12px; text-align:center; border-bottom:1px solid var(--brd); position:sticky; top:0; z-index:2; white-space:nowrap; transition:0.3s; backdrop-filter:blur(8px); }
.ss td { padding:0; border-bottom:1px solid var(--brd-td); height:36px; min-width:50px; transition:.2s; }
.ss tr:hover td { background:var(--bg-inp); }

.ss input, .ss select { width:100%; height:100%; border:none; background:transparent; color:var(--tx); font-family:inherit; font-size:.76rem; padding:4px 8px; outline:none; transition:0.2s; font-weight:500; }
.ss input:focus, .ss select:focus { background:rgba(99,102,241,.1); box-shadow:inset 0 0 0 1px var(--ac); }
.ss input[type=number] { text-align:right; -moz-appearance:textfield; }

.ss .c { font-weight:600; text-align:right; padding:4px 10px; }
.ss .o { background:rgba(245,158,11,.1)!important; color:var(--am)!important; cursor:pointer; }
.ss .o:hover { background:rgba(245,158,11,.2)!important; }
.ss .lb { font-weight:700; padding:4px 12px; color:var(--tx-mut); white-space:nowrap; }
.ss .hd { background:rgba(99,102,241,.07); font-weight:800; color:var(--ac); padding:8px 12px; font-size:.76rem; text-transform:uppercase; letter-spacing:.3px; }
.ss .hd2 { background:rgba(6,182,212,.07); font-weight:700; color:var(--cy); padding:6px 12px; }
.ss .g { color:var(--gn); font-weight:700; text-align:right; padding:4px 10px; }
.ss .r { color:var(--rd); font-weight:700; text-align:right; padding:4px 10px; }

/* Cards & UI */
.cd { background:var(--bg-card); border:1px solid var(--brd); border-radius:12px; padding:16px; backdrop-filter:blur(10px); transition:0.2s; }
.cd:hover { border-color:rgba(99,102,241,.3); }
.st { display:flex; align-items:center; gap:8px; padding:8px 12px; border-radius:8px; font-weight:800; font-size:.85rem; margin-bottom:12px; }
.st.i { background:rgba(99,102,241,.1); color:var(--ac); }
.st.c { background:rgba(6,182,212,.1); color:var(--cy); }
.st.a { background:rgba(245,158,11,.1); color:var(--am); }
.st.e { background:rgba(16,185,129,.1); color:var(--gn); }

.kpi { text-align:center; padding:20px; display:flex; flex-direction:column; justify-content:center; }
.kpi .v { font-size:1.6rem; font-weight:800; letter-spacing:-0.5px; }
.kpi .k { font-size:.65rem; font-weight:700; color:var(--tx-mut); text-transform:uppercase; letter-spacing:1px; margin-top:6px; }

.bt { display:inline-flex; align-items:center; justify-content:center; gap:8px; padding:8px 16px; border-radius:8px; font-weight:700; font-size:.8rem; cursor:pointer; border:none; transition:.2s; }
.bt1 { background:var(--ac); color:#fff; box-shadow:0 4px 15px rgba(99,102,241,.25); } .bt1:hover { filter:brightness(1.1); transform:translateY(-1px); }
.bt2 { background:rgba(244,63,94,.15); color:var(--rd); } .bt2:hover { background:rgba(244,63,94,.25); }
.bt3 { background:rgba(16,185,129,.15); color:var(--gn); } .bt3:hover { background:rgba(16,185,129,.25); }
.bt4 { background:transparent; color:var(--tx-mut); border:1px solid var(--brd); } .bt4:hover { color:var(--tx); border-color:var(--tx); }
.bt4.on { background:var(--ac); color:#fff; border-color:var(--ac); box-shadow:0 4px 12px rgba(99,102,241,.2); }

.pr { display:flex; align-items:center; padding:4px 0; }
.pr .l { flex:1; font-size:.8rem; font-weight:600; color:var(--tx-mut); padding-left:4px; }
.pr input, .pr select { width:100px; background:var(--bg-inp); border:1px solid var(--brd); padding:6px 10px; border-radius:6px; color:var(--tx); font-family:'JetBrains Mono',monospace; font-size:.8rem; text-align:right; outline:none; transition:.2s; }
.pr input:focus, .pr select:focus { border-color:var(--ac); }
.pr input:disabled { opacity: 0.5; cursor: not-allowed; }
.pr .u { font-size:.7rem; color:var(--tx-mut); width:35px; text-align:left; padding-left:8px; }
.ps { background:var(--bg-inp); border:1px solid var(--brd); padding:6px 10px; border-radius:6px; color:var(--tx); font-size:.8rem; outline:none; width:100%; transition:.2s; }
.ps:focus { border-color:var(--ac); }

.tg { display:inline-flex; gap:2px; background:var(--bg-inp); border-radius:8px; padding:3px; }
.tg button { padding:6px 14px; border-radius:6px; font-size:.75rem; font-weight:700; border:none; cursor:pointer; color:var(--tx-mut); background:transparent; transition:0.2s; }
.tg button.on { background:var(--ac); color:#fff; box-shadow:0 2px 8px rgba(0,0,0,0.2); }

/* Modals */
.opt-modal-bg { position:fixed; inset:0; z-index:1000; background:rgba(0,0,0,0.6); backdrop-filter:blur(8px); display:flex; align-items:center; justify-content:center; opacity:0; pointer-events:none; transition:0.2s; }
.opt-modal-bg.show { opacity:1; pointer-events:auto; }
.opt-modal { background:var(--bg-nav); border:1px solid var(--brd); border-radius:16px; padding:28px; width:480px; max-width:95vw; max-height:90vh; overflow-y:auto; box-shadow:0 25px 50px -12px rgba(0,0,0,0.5); transform:scale(0.95); transition:0.2s; color:var(--tx); }
.opt-modal-bg.show .opt-modal { transform:scale(1); }
.opt-modal h3 { font-size:1.1rem; font-weight:800; margin-bottom:16px; display:flex; align-items:center; gap:8px; }
.opt-modal label { display:block; font-size:.75rem; font-weight:700; color:var(--tx-mut); text-transform:uppercase; margin:12px 0 4px; }

.toast-container { position:fixed; bottom:24px; right:24px; z-index:2000; display:flex; flex-direction:column; gap:10px; }
.toast { background:var(--bg-nav); border:1px solid var(--brd); padding:12px 16px; border-radius:10px; display:flex; align-items:center; gap:12px; font-size:.85rem; font-weight:600; box-shadow:0 10px 25px rgba(0,0,0,0.3); animation:slideIn 0.3s cubic-bezier(0.175,0.885,0.32,1.275) forwards; }
@keyframes slideIn { from{transform:translateX(100%);opacity:0} to{transform:translateX(0);opacity:1} }
.toast.ok i { color:var(--gn); } .toast.er i { color:var(--rd); } .toast.in i { color:var(--cy); }
</style>
</head>
<body>

<nav class="snav">
 <div class="logo">
  <div class="ic"><i data-lucide="shield-check" class="text-white"></i></div>
  <div><div class="text-sm font-extrabold tracking-tight">INSJACK</div><div class="text-[9px] text-indigo-400 font-bold uppercase tracking-widest">Optimizi Pro</div></div>
 </div>
 <div class="links">
  <button class="slink on" onclick="go('pl',this)"><i data-lucide="file-spreadsheet"></i>Fiyat Listesi</button>
  <button class="slink" onclick="go('pd',this)"><i data-lucide="layout-grid"></i>Ürün Detay</button>
  <button class="slink" onclick="go('ms',this)"><i data-lucide="pie-chart"></i>Master Özet</button>
  <button class="slink" onclick="go('pm',this)"><i data-lucide="users"></i>Personel Maliyetleri</button>
  <div class="px-4 py-3 mt-2 text-[9px] font-bold text-[var(--tx-mut)] uppercase tracking-widest">Veritabanı</div>
  <button class="slink" onclick="go('mf',this)"><i data-lucide="database"></i>Malzeme Fiyatları</button>
  <button class="slink" onclick="go('pr',this)"><i data-lucide="sliders-horizontal"></i>Parametreler</button>
 </div>
 <div class="p-4 border-t border-[var(--brd)] text-[10px] text-[var(--tx-mut)] font-mono text-center">v2.6 Pro | O.G.</div>
</nav>

<div class="mn">
<div class="tbar">
 <div class="flex gap-4 text-xs font-bold items-center">
  <div class="cd py-1.5 px-4 flex items-center gap-2" style="padding:6px 16px"><span class="text-[10px] text-[var(--tx-mut)] uppercase">Kalem</span><span id="sI" class="text-cyan-400 font-mono text-sm">0</span></div>
  <div class="cd py-1.5 px-4 flex items-center gap-2" style="padding:6px 16px"><span class="text-[10px] text-[var(--tx-mut)] uppercase">Ceket</span><span id="sJ" class="text-indigo-400 font-mono text-sm">0</span></div>
  <div class="cd py-1.5 px-4 flex items-center gap-2" style="padding:6px 16px"><span class="text-[10px] text-[var(--tx-mut)] uppercase">Adam×Sa</span><span id="sH" class="text-amber-400 font-mono text-sm">0</span></div>
 </div>
 <div class="flex gap-3 items-center">
  <button onclick="toggleTheme()" class="bt bt4 px-2" id="themeBtn" title="Tema Değiştir"><i data-lucide="sun" class="w-4 h-4"></i></button>
  <button onclick="saveData()" class="bt bt1"><i data-lucide="save" class="w-4 h-4"></i>Kaydet</button>
  <button onclick="optAlert('PDF Modülü entegrasyonu devam ediyor.')" class="bt bt4"><i data-lucide="file-down" class="w-4 h-4"></i>PDF İndir</button>
 </div>
</div>

<div id="p-pl" class="pane on">
<div class="grid grid-cols-1 lg:grid-cols-4 gap-5" style="height:100%">
 <div class="cd overflow-y-auto" style="max-height:100%">
  <div class="st c"><i data-lucide="settings-2" class="w-4 h-4"></i>Malzeme & Ayarlar</div>
  <div id="plGlobal"></div>
 </div>
 <div class="lg:col-span-3 flex flex-col" style="min-height:0">
  <div class="flex items-center justify-between mb-4">
   <div class="tg" id="curToggle"></div>
   <div class="text-xs text-[var(--tx-mut)] font-semibold"><i data-lucide="info" class="w-3 h-3 inline relative -top-0.5"></i> Listede miktar değiştirmek için adete çift tıkla</div>
  </div>
  <div class="flex-1 overflow-auto rounded-xl border border-[var(--brd)]"><table class="ss" id="tPL"><thead id="plHead"></thead><tbody id="plBody"></tbody>
   <tfoot><tr id="plFoot"></tr></tfoot></table></div>
 </div>
</div>
</div>

<div id="p-pd" class="pane">
<div class="flex items-center gap-3 mb-4 flex-wrap bg-[var(--bg-card)] p-4 rounded-xl border border-[var(--brd)] shadow-sm">
 <select id="aType" class="ps" style="width:170px" onchange="updDN()">
  <option value="">Ekipman Tipi...</option>
  <option value="gate">Gate Vana</option>
  <option value="globe">Globe/Control</option>
  <option value="butterfly">Kelebek/Check</option>
  <option value="yfilter">Y Pislik Tutucu</option>
  <option value="basket">Basket P.T.</option>
  <option value="disco">Disco/Wafer</option>
  <option value="spring">Yaylı Çekvana</option>
  <option value="swing">Swing Check</option>
  <option value="comp">Kompansatör</option>
  <option value="pipe">Boru</option>
  <option value="flange">Flanş</option>
  <option value="manual_pad">Manuel Yastık</option>
  <option value="3way">Üç Yollu Vana</option>
  <option value="ball_2">2 Prç Küresel</option>
  <option value="ball_3">3 Prç Küresel</option>
  <option value="trap">Kondenstop</option>
  <option value="check_clv">Çekvalf (CLV-50)</option>
  <option value="elbow">Dirsek (90°)</option>
 </select>
 <select id="aDN" class="ps" style="width:90px"><option value="">DN</option></select>
 <select id="aCls" class="ps" style="width:100px"><option value="150">PN16/150</option><option value="300">PN25/300</option><option value="400">PN40/400</option><option value="600">600</option><option value="900">900</option><option value="1500">1500</option><option value="2500">2500</option></select>
 <input type="number" id="aQty" class="ps font-mono" style="width:70px;text-align:center" value="1" min="1" title="Adet">
 <button onclick="addItem()" class="bt bt1 px-4"><i data-lucide="plus" class="w-4 h-4"></i>Ekle</button>
 <div class="ml-auto flex items-center gap-3">
  <span class="text-xs font-bold text-[var(--tx-mut)] uppercase tracking-wide">Para Birimi:</span>
  <select id="pdCur" class="ps font-bold" style="width:80px" onchange="recalcAll()"><option value="TL">TL</option><option value="USD">USD</option><option value="EUR">EUR</option></select>
  <button onclick="optConfirm('Tüm listeyi temizlemek istediğinize emin misiniz?', ()=>{IT=[];RN=1;recalcAll()})" class="bt bt2 px-3"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
 </div>
</div>
<div class="flex-1 overflow-auto rounded-xl border border-[var(--brd)] shadow-sm">
 <table class="ss" id="tPD"><thead><tr>
  <th>REF</th><th style="min-width:110px">Tip</th><th>Parça</th><th>DN</th><th>Cls</th><th style="width:55px">Adet</th><th style="width:55px" class="text-indigo-400">Zorluk</th>
  <th>Alt Kumaş</th><th>Üst Kumaş</th><th>Dolgu</th>
  <th style="background:rgba(245,158,11,.1); color:var(--am)">İzol</th><th>F.Çap</th><th>S</th><th>T</th>
  <th style="background:rgba(6,182,212,.08); color:var(--cy)">Kumaş</th><th style="background:rgba(6,182,212,.08); color:var(--cy)">Dolgu</th><th style="background:rgba(6,182,212,.08); color:var(--cy)">Dikiş</th><th style="background:rgba(6,182,212,.08); color:var(--cy)">Boğma</th><th style="background:rgba(6,182,212,.08); color:var(--cy)">Cırt</th><th style="background:rgba(6,182,212,.08); color:var(--cy)">Agf</th><th style="background:rgba(6,182,212,.08); color:var(--cy)">Pul</th>
  <th style="background:rgba(99,102,241,.1)">Mlz</th><th style="background:rgba(99,102,241,.1)">İşç</th><th style="background:rgba(16,185,129,.1)">B.Mly</th><th style="background:rgba(16,185,129,.1)">B.Satış</th><th style="background:rgba(16,185,129,.15)">Toplam</th><th></th>
 </tr></thead><tbody id="pdBody"></tbody><tfoot id="pdFoot"></tfoot></table>
</div>
</div>

<div id="p-ms" class="pane">
<div class="grid grid-cols-2 lg:grid-cols-5 gap-5 mb-6">
 <div class="cd kpi"><div class="v text-cyan-400" id="kC">₺0</div><div class="k">Toplam Maliyet</div></div>
 <div class="cd kpi"><div class="v text-emerald-400" id="kS">₺0</div><div class="k">Satış Bedeli</div></div>
 <div class="cd kpi"><div class="v text-amber-400" id="kP">₺0</div><div class="k">Kâr</div></div>
 <div class="cd kpi"><div class="v text-indigo-400" id="kM">%0</div><div class="k">Kâr Marjı</div></div>
 <div class="cd kpi"><div class="v text-rose-400" id="kJ">0</div><div class="k">Ceket</div></div>
</div>
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
 <div class="cd lg:col-span-2"><div class="flex items-center justify-between"><div class="st e"><i data-lucide="calculator" class="w-4 h-4"></i>Maliyet Kırılımı</div>
  <div class="flex items-center gap-2"><span class="text-xs font-bold text-[var(--tx-mut)]">Satış Çarpanı:</span><input type="number" id="msMul" class="ps font-mono" style="width:70px;text-align:center" value="2.5" step=".1" onchange="P.mul=parseFloat(this.value)||2.5;recalcAll()"></div>
 </div><div class="rounded-xl overflow-hidden border border-[var(--brd)]"><table class="ss" id="tMC"></table></div></div>
 <div class="cd"><div class="st a"><i data-lucide="briefcase" class="w-4 h-4"></i>Hizmet Bedelleri</div>
  <div class="space-y-2 mt-3" id="msServices"></div>
  <div class="mt-4 pt-4 border-t border-[var(--brd)] flex justify-between items-center"><span class="font-extrabold text-sm">Toplam Hizmet</span><span class="font-extrabold text-amber-400 font-mono text-lg" id="msSvcTotal">₺0</span></div>
 </div>
</div>
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6">
 <div class="cd"><div class="st c"><i data-lucide="package" class="w-4 h-4"></i>Malzeme Toplamları</div><div class="overflow-auto max-h-[40vh] rounded-xl border border-[var(--brd)]"><table class="ss" id="tMM"></table></div></div>
 <div class="cd"><div class="st i"><i data-lucide="globe" class="w-4 h-4"></i>Döviz & Kâr Analizi</div><div class="rounded-xl overflow-hidden border border-[var(--brd)]"><table class="ss" id="tMS"></table></div>
  <div class="mt-4 grid grid-cols-3 gap-4">
   <div class="cd kpi" style="padding:16px"><div class="v text-[1.2rem] text-[var(--tx)]" id="msAH">0</div><div class="k">Adam×Saat</div></div>
   <div class="cd kpi" style="padding:16px"><div class="v text-[1.2rem] text-[var(--tx)]" id="msAD">0</div><div class="k">Adam Gün</div></div>
   <div class="cd kpi" style="padding:16px"><div class="v text-[1.2rem] text-[var(--tx)]" id="msJC">0</div><div class="k">Ceket</div></div>
  </div>
 </div>
</div>
</div>

<div id="p-mf" class="pane">
<div class="flex items-center justify-between mb-4"><div class="tg" id="mfBtns"></div><button onclick="openMatModal()" class="bt bt3"><i data-lucide="plus" class="w-4 h-4"></i>Yeni Malzeme</button></div>
<div class="flex-1 overflow-auto rounded-xl border border-[var(--brd)]"><table class="ss"><thead><tr><th>#</th><th>Tür</th><th>Alt Tip</th><th style="min-width:180px">Malzeme Cinsi</th><th>Birim</th><th>Fiyat</th><th>Döviz</th><th style="background:rgba(16,185,129,.1); color:var(--gn)">TL Fiyat</th><th>Kalınlık</th><th></th></tr></thead><tbody id="mBody"></tbody></table></div>
</div>

<div id="p-pm" class="pane">
<div class="grid grid-cols-1 lg:grid-cols-4 gap-5 mb-5">
 <div class="cd kpi"><div class="v text-cyan-400" id="pmAvg">₺0</div><div class="k">Ort. Saat Maliyeti</div></div>
 <div class="cd kpi"><div class="v text-indigo-400" id="pmCnt">0</div><div class="k">Personel Sayısı</div></div>
 <div class="cd kpi"><div class="v text-emerald-400" id="pmTot">₺0</div><div class="k">Yıllık Toplam Maliyet</div></div>
 <div class="cd kpi"><div class="v text-amber-400" id="pmDay">₺0</div><div class="k">Günlük Toplam</div></div>
</div>
<div class="grid grid-cols-1 lg:grid-cols-4 gap-5 mb-5">
 <div class="cd"><div class="st a"><i data-lucide="settings" class="w-4 h-4"></i>Ortak Parametreler</div>
  <div id="pmParams"></div>
 </div>
 <div class="lg:col-span-3 flex flex-col">
  <div class="flex items-center justify-between mb-3">
   <div class="text-xs text-[var(--tx-mut)] font-bold"><i data-lucide="info" class="w-3 h-3 inline relative -top-0.5"></i> Hesaplanan saat maliyeti sistemin ana işçilik gideri olarak kullanılır.</div>
   <button onclick="openPersModal()" class="bt bt3"><i data-lucide="user-plus" class="w-4 h-4"></i>Personel Ekle</button>
  </div>
  <div class="flex-1 overflow-auto rounded-xl border border-[var(--brd)]"><table class="ss"><thead><tr>
   <th>#</th><th>Görev</th><th style="min-width:140px">Ad Soyad</th><th>Aylık Net</th>
   <th style="background:rgba(6,182,212,.08)">Yıllık Brüt</th><th style="background:rgba(6,182,212,.08)">Kıdem</th><th style="background:rgba(6,182,212,.08)">İzin</th>
   <th>Servis</th><th>Yemek</th><th>KKD</th>
   <th style="background:rgba(245,158,11,.1); color:var(--am)">Fazla Ç.</th><th style="background:rgba(99,102,241,.1); color:var(--ac)">Yıllık Top.</th><th style="background:rgba(16,185,129,.15); color:var(--gn)">Saat Mly</th><th></th>
  </tr></thead><tbody id="pmBody"></tbody>
  <tfoot><tr><td colspan="10" class="lb text-right font-extrabold">ORTALAMA / TOPLAM</td><td class="c font-mono text-amber-400" id="pmFcTot"></td><td class="c font-mono text-indigo-400 font-bold" id="pmNTot"></td><td class="c font-mono text-emerald-400 font-black text-[1rem]" id="pmOTot"></td><td></td></tr></tfoot></table></div>
 </div>
</div>
</div>

<div id="p-pr" class="pane">
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
 <div class="cd"><div class="st c"><i data-lucide="coins" class="w-4 h-4"></i>Döviz & İşçilik</div><div id="pDov" class="space-y-1"></div></div>
 <div class="cd"><div class="st a"><i data-lucide="ruler" class="w-4 h-4"></i>Fire & Geometri</div><div id="pFir" class="space-y-1"></div></div>
 <div class="cd"><div class="st e"><i data-lucide="hard-hat" class="w-4 h-4"></i>İşçilik Sabitleri</div><div id="pLab" class="space-y-1"></div></div>
</div>
<div class="cd mt-6"><div class="st i"><i data-lucide="circle" class="w-4 h-4"></i>Flanş Çap Tablosu (mm)</div><div class="overflow-auto max-h-[42vh] rounded-lg border border-[var(--brd)]"><table class="ss" id="tFl"></table></div></div>
<div class="cd mt-6"><div class="st c"><i data-lucide="move-horizontal" class="w-4 h-4"></i>Gövde Uzunluk (L1 / L2)</div>
 <div class="flex gap-2 mb-3"><button onclick="slt('gate')" class="bt bt4 on" id="bl-gate">Gate</button><button onclick="slt('globe')" class="bt bt4" id="bl-globe">Globe</button><button onclick="slt('butterfly')" class="bt bt4" id="bl-butterfly">Kelebek</button></div>
 <div class="overflow-auto max-h-[42vh] rounded-lg border border-[var(--brd)]"><table class="ss" id="tLn"></table></div>
</div>
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6">
 <div class="cd"><div class="st c"><i data-lucide="gauge" class="w-4 h-4"></i>Vana Referans Ölçüleri (PDF Kaynak)</div>
  <div class="flex gap-2 mb-3"><select id="vRefSel" class="ps font-semibold" style="width:260px" onchange="rVRef()"><option value="PV-16">Pistonlu Vana PN16</option><option value="GV-16K">Glob Vana PN16 (Pik Döküm)</option><option value="GV-25Z">Glob Vana PN25 (Sfero Döküm)</option><option value="GV-40K">Glob Vana PN40 (Çelik Döküm)</option><option value="MK-16">Körüklü Vana PN16 (Pik Döküm)</option><option value="MK-25">Körüklü Vana PN25 (Sfero Döküm)</option><option value="MK-40">Körüklü Vana PN40 (Çelik Döküm)</option><option value="GTK-18">Sürgülü Vana PN16 (GGG-50)</option></select></div>
  <div class="overflow-auto max-h-[35vh] rounded-lg border border-[var(--brd)]"><table class="ss" id="tVRef"></table></div>
 </div>
 <div class="cd"><div class="st a"><i data-lucide="circle-dot" class="w-4 h-4"></i>Agraf & Pul (Çap'a Göre)</div><div class="overflow-auto max-h-[35vh] rounded-lg border border-[var(--brd)]"><table class="ss" id="tAg"></table></div></div>
</div>
</div>
</div><div class="opt-modal-bg" id="modalMat"><div class="opt-modal">
 <h3><i data-lucide="plus-circle" class="w-5 h-5 text-emerald-400"></i>Yeni Malzeme Ekle</h3>
 <label>Tür</label><select id="nmType" class="ps"><option>Kumaş</option><option>Dolgu</option><option>Yardımcı</option><option>Isıtıcı</option></select>
 <label>Alt Tip</label><input id="nmSub" class="ps" placeholder="örn: Cam Elyaf, Taş Yünü...">
 <label>Malzeme Cinsi</label><input id="nmName" class="ps" placeholder="örn: 1 Sİ - 0.5 mm - Gri">
 <label>Birim</label><input id="nmUnit" class="ps" value="M²">
 <div class="grid grid-cols-2 gap-3 mt-1">
  <div><label>Fiyat</label><input type="number" id="nmPrice" class="ps" step=".001" value="0"></div>
  <div><label>Döviz</label><select id="nmCur" class="ps"><option>TL</option><option>USD</option><option>EUR</option></select></div>
 </div>
 <label>Kalınlık Sabiti (mm)</label><input type="number" id="nmThick" class="ps" placeholder="opsiyonel">
 <div class="flex gap-3 mt-6"><button onclick="submitMat()" class="bt bt1 flex-1 py-3">Ekle</button><button onclick="document.getElementById('modalMat').classList.remove('show')" class="bt bt4 flex-1 py-3">İptal</button></div>
</div></div>

<div class="opt-modal-bg" id="qtyModal"><div class="opt-modal" style="width:400px">
 <h3><i data-lucide="alert-triangle" class="w-5 h-5 text-amber-400"></i>Adet Uyarısı</h3>
 <p class="text-sm text-[var(--tx-mut)] mb-4 leading-relaxed">Fiyat Listesi'ndeki adet ile Ürün Detay'daki adet <strong class="text-amber-400">birbiriyle çarpılır</strong>.</p>
 <p class="text-sm mb-4 font-bold">Mevcut Çarpan: <span id="qmCur" class="text-indigo-400 font-mono text-lg ml-2">1</span></p>
 <label>Yeni Adet</label><input type="number" id="qmVal" class="ps font-mono text-lg" min="1" value="1">
 <div class="flex gap-3 mt-6"><button onclick="submitQty()" class="bt bt1 flex-1 py-3">Uygula</button><button onclick="document.getElementById('qtyModal').classList.remove('show')" class="bt bt4 flex-1 py-3">İptal</button></div>
</div></div>

<div class="opt-modal-bg" id="persModal"><div class="opt-modal">
 <h3><i data-lucide="user-plus" class="w-5 h-5 text-cyan-400"></i>Personel Ekle</h3>
 <label>Görev</label><select id="npGorev" class="ps"><option>USTABAŞI</option><option>ORTACI</option><option selected>DİKİŞÇİ</option><option>DOLUMCU</option><option>KALİTE</option><option>DİĞER</option></select>
 <label>Ad Soyad</label><input id="npAd" class="ps" placeholder="Ad Soyad">
 <label>Aylık Net Ücret (₺)</label><input type="number" id="npNet" class="ps font-mono text-lg" step="100" value="48000">
 <div class="grid grid-cols-2 gap-3 mt-1">
  <div><label>Kıdem Birikimi Var mı?</label><select id="npKidem" class="ps"><option value="1">Evet (formülle)</option><option value="0">Hayır</option></select></div>
  <div><label>Servis Gideri (₺/ay)</label><input type="number" id="npServis" class="ps font-mono" value="2750"></div>
 </div>
 <div class="flex gap-3 mt-6"><button onclick="submitPers()" class="bt bt1 flex-1 py-3">Ekle</button><button onclick="document.getElementById('persModal').classList.remove('show')" class="bt bt4 flex-1 py-3">İptal</button></div>
</div></div>

<div class="opt-modal-bg" id="optConfirmBg"><div class="opt-modal" style="width:400px">
 <h3 class="text-amber-400"><i data-lucide="alert-circle"></i> Onay Gerekli</h3>
 <p class="text-sm text-[var(--tx-mut)] mb-6 mt-2" id="optConfirmMsg"></p>
 <div class="flex gap-3"><button id="optConfirmYes" class="bt bt2 flex-1 py-3">Evet</button><button onclick="document.getElementById('optConfirmBg').classList.remove('show')" class="bt bt4 flex-1 py-3">İptal</button></div>
</div></div>

<div class="toast-container" id="toastBox"></div>

<script>
// THEME MANAGER
let currentTheme = localStorage.getItem('insjack_theme') || 'dark';
document.documentElement.setAttribute('data-theme', currentTheme);
function toggleTheme() {
    currentTheme = currentTheme === 'dark' ? 'light' : 'dark';
    document.documentElement.setAttribute('data-theme', currentTheme);
    localStorage.setItem('insjack_theme', currentTheme);
    document.getElementById('themeBtn').innerHTML = `<i data-lucide="${currentTheme === 'dark' ? 'sun' : 'moon'}" class="w-4 h-4"></i>`;
    lucide.createIcons();
}

// ====== DATA ======
const VALVE_DATA={"PV-16":{"desc":"Pistonlu Vana PN16","pn":16,"dims":{"15":{"D":95,"L":130,"H":0,"Dk":100},"20":{"D":105,"L":150,"H":0,"Dk":100},"25":{"D":115,"L":160,"H":0,"Dk":120},"32":{"D":135,"L":180,"H":0,"Dk":140},"40":{"D":145,"L":200,"H":0,"Dk":140},"50":{"D":160,"L":230,"H":0,"Dk":200},"65":{"D":180,"L":290,"H":0,"Dk":200},"80":{"D":195,"L":310,"H":0,"Dk":240},"100":{"D":215,"L":350,"H":0,"Dk":280},"125":{"D":245,"L":400,"H":0,"Dk":360},"150":{"D":280,"L":480,"H":0,"Dk":360},"200":{"D":335,"L":600,"H":0,"Dk":400}}},"GV-16K":{"desc":"Glob Vana PN16 (Pik Döküm)","pn":16,"dims":{"15":{"D":95,"L":130,"H":210,"Dk":100},"20":{"D":105,"L":150,"H":210,"Dk":100},"25":{"D":115,"L":160,"H":210,"Dk":120},"32":{"D":140,"L":180,"H":210,"Dk":140},"40":{"D":150,"L":200,"H":245,"Dk":140},"50":{"D":165,"L":230,"H":255,"Dk":200},"65":{"D":185,"L":290,"H":310,"Dk":200},"80":{"D":200,"L":310,"H":325,"Dk":240},"100":{"D":220,"L":350,"H":385,"Dk":280},"125":{"D":250,"L":400,"H":435,"Dk":360},"150":{"D":285,"L":480,"H":475,"Dk":360},"200":{"D":340,"L":600,"H":620,"Dk":400},"250":{"D":405,"L":730,"H":740,"Dk":450},"300":{"D":460,"L":850,"H":853,"Dk":600}}},"GV-25Z":{"desc":"Glob Vana PN25 (Sfero Döküm)","pn":25,"dims":{"15":{"D":95,"L":130,"H":167,"Dk":100},"20":{"D":105,"L":150,"H":167,"Dk":100},"25":{"D":115,"L":160,"H":175,"Dk":120},"32":{"D":140,"L":180,"H":186,"Dk":120},"40":{"D":150,"L":200,"H":235,"Dk":160},"50":{"D":165,"L":230,"H":248,"Dk":160},"65":{"D":185,"L":290,"H":260,"Dk":180},"80":{"D":200,"L":310,"H":291,"Dk":200},"100":{"D":235,"L":350,"H":338,"Dk":250},"125":{"D":270,"L":400,"H":373,"Dk":250},"150":{"D":300,"L":480,"H":429,"Dk":320},"200":{"D":360,"L":600,"H":529,"Dk":360}}},"GV-40K":{"desc":"Glob Vana PN40 (Çelik Döküm)","pn":40,"dims":{"15":{"D":95,"L":130,"H":190,"Dk":140},"20":{"D":105,"L":150,"H":190,"Dk":140},"25":{"D":115,"L":160,"H":195,"Dk":160},"32":{"D":140,"L":180,"H":210,"Dk":180},"40":{"D":150,"L":200,"H":220,"Dk":180},"50":{"D":165,"L":230,"H":230,"Dk":200},"65":{"D":185,"L":290,"H":280,"Dk":200},"80":{"D":200,"L":310,"H":290,"Dk":250},"100":{"D":235,"L":350,"H":365,"Dk":280},"125":{"D":270,"L":400,"H":390,"Dk":300},"150":{"D":300,"L":480,"H":545,"Dk":315},"200":{"D":375,"L":600,"H":680,"Dk":400}}},"MK-16":{"desc":"Körüklü Vana PN16 (Pik Döküm)","pn":16,"dims":{"15":{"D":95,"L":130,"H":178,"Dk":125},"20":{"D":105,"L":150,"H":178,"Dk":125},"25":{"D":115,"L":160,"H":193,"Dk":125},"32":{"D":140,"L":180,"H":201,"Dk":125},"40":{"D":150,"L":200,"H":224,"Dk":150},"50":{"D":165,"L":230,"H":228,"Dk":150},"65":{"D":185,"L":290,"H":270,"Dk":175},"80":{"D":200,"L":310,"H":295,"Dk":200},"100":{"D":220,"L":350,"H":325,"Dk":250},"125":{"D":250,"L":400,"H":380,"Dk":300},"150":{"D":285,"L":480,"H":427,"Dk":400},"200":{"D":340,"L":600,"H":569,"Dk":500},"250":{"D":405,"L":730,"H":645,"Dk":500}}},"MK-25":{"desc":"Körüklü Vana PN25 (Sfero Döküm)","pn":25,"dims":{"15":{"D":95,"L":130,"H":178,"Dk":125},"20":{"D":105,"L":150,"H":178,"Dk":125},"25":{"D":115,"L":160,"H":193,"Dk":125},"32":{"D":140,"L":180,"H":201,"Dk":125},"40":{"D":150,"L":200,"H":224,"Dk":150},"50":{"D":165,"L":230,"H":228,"Dk":150},"65":{"D":185,"L":290,"H":270,"Dk":175},"80":{"D":200,"L":310,"H":295,"Dk":200},"100":{"D":235,"L":350,"H":325,"Dk":250},"125":{"D":270,"L":400,"H":380,"Dk":300},"150":{"D":300,"L":480,"H":427,"Dk":400},"200":{"D":360,"L":600,"H":569,"Dk":500}}},"MK-40":{"desc":"Körüklü Vana PN40 (Çelik Döküm)","pn":40,"dims":{"15":{"D":95,"L":130,"H":189,"Dk":125},"20":{"D":105,"L":150,"H":189,"Dk":125},"25":{"D":115,"L":160,"H":189,"Dk":125},"32":{"D":140,"L":180,"H":220,"Dk":150},"40":{"D":150,"L":200,"H":220,"Dk":150},"50":{"D":165,"L":230,"H":295,"Dk":200},"65":{"D":185,"L":290,"H":295,"Dk":200},"80":{"D":200,"L":310,"H":368,"Dk":300},"100":{"D":235,"L":350,"H":368,"Dk":300},"125":{"D":270,"L":400,"H":523,"Dk":400},"150":{"D":300,"L":480,"H":523,"Dk":400}}},"GTK-18":{"desc":"Sürgülü Vana PN16 (GGG-50)","pn":16,"dims":{"50":{"D":165,"L":150,"H":215,"Dk":200},"65":{"D":185,"L":170,"H":250,"Dk":200},"80":{"D":200,"L":180,"H":275,"Dk":254},"100":{"D":220,"L":190,"H":320,"Dk":254},"125":{"D":250,"L":200,"H":355,"Dk":315},"150":{"D":285,"L":210,"H":398,"Dk":315},"200":{"D":340,"L":230,"H":495,"Dk":315},"250":{"D":405,"L":250,"H":590,"Dk":406},"300":{"D":460,"L":270,"H":670,"Dk":406}}}};
const EXCEL_DATA={"fx":{"USD":43.1,"EUR":50.3},"hc":459.33,"mat":[{"t":"Kumaş","s":"Cam Elyaf","n":"1 Sİ - 0.5 mm - Gri","u":"M²","p":2.49,"c":"USD","k":null},{"t":"Kumaş","s":"Cam Elyaf","n":"2 Sİ - 0.5 mm - Gri","u":"M²","p":2.95,"c":"USD","k":null},{"t":"Kumaş","s":"Cam Elyaf","n":"1 Sİ - 0.5 mm - KIRMIZI","u":"M²","p":2.65,"c":"USD","k":null},{"t":"Kumaş","s":"Cam Elyaf","n":"1 PU - 0.5 mm - Gri","u":"M²","p":1.55,"c":"USD","k":null},{"t":"Kumaş","s":"Cam Elyaf","n":"1 PTFE - 0.5 mm - Gri","u":"M²","p":8.25,"c":"EUR","k":null},{"t":"Kumaş","s":"Cam Elyaf","n":"1 AluFoil - 0.5mm","u":"M²","p":6,"c":"EUR","k":null},{"t":"Kumaş","s":"Cam Elyaf","n":"HT - 0.9  mm","u":"M²","p":1.5,"c":"USD","k":null},{"t":"Kumaş","s":"Cam Elyaf","n":"Türbin - HT1200","u":"M²","p":18,"c":"EUR","k":null},{"t":"Kumaş","s":"Cam Elyaf","n":"V4A - PU","u":"M²","p":14.5,"c":"USD","k":null},{"t":"Kumaş","s":"Cam Elyaf","n":"Kmpnstör Kırmızı","u":"M²","p":6.34,"c":"USD","k":null},{"t":"Kumaş","s":"Cam Elyaf","n":"K.Kırmızı+PTFE Film+Türbin Teli","u":"M²","p":35,"c":"USD","k":null},{"t":"Kumaş","s":"Cam Elyaf","n":"1 Sİ-0,24 mm Gri","u":"M²","p":1.61,"c":"USD","k":null},{"t":"Kumaş","s":"Cam Elyaf","n":"Seramik 2 mm","u":"M²","p":15,"c":"EUR","k":null},{"t":"Kumaş","s":"Cam Elyaf","n":"Hi-Silica 1100 C","u":"M²","p":13,"c":"USD","k":null},{"t":"Kumaş","s":"SS Tel","n":"Türbin Teli (TEK KAT)","u":"M²","p":4.25,"c":"EUR","k":null},{"t":"Kumaş","s":"Slica+SS","n":"Slica+SS","u":"M²","p":17.25,"c":"EUR","k":null},{"t":"Kumaş","s":"Fiyatsız","n":"Fiyatsız-Kumaş","u":"M²","p":0,"c":"TL","k":null},{"t":"Dolgu","s":"Fiyatsız","n":"Fiyatsız-10 mm","u":"M²","p":0,"c":"TL","k":10},{"t":"Dolgu","s":"Fiyatsız","n":"Fiyatsız-20 mm","u":"M²","p":0,"c":"TL","k":20},{"t":"Dolgu","s":"Fiyatsız","n":"Fiyatsız-30 mm","u":"M²","p":0,"c":"TL","k":30},{"t":"Dolgu","s":"Fiyatsız","n":"Fiyatsız-50 mm","u":"M²","p":0,"c":"TL","k":45},{"t":"Dolgu","s":"Fiyatsız","n":"Fiyatsız-60 mm","u":"M²","p":0,"c":"TL","k":50},{"t":"Dolgu","s":"Fiyatsız","n":"Fiyatsız-80 mm","u":"M²","p":0,"c":"TL","k":65},{"t":"Dolgu","s":"Fiyatsız","n":"Fiyatsız-100 mm","u":"M²","p":0,"c":"TL","k":80},{"t":"Dolgu","s":"Taş Yünü","n":"TY-30mm","u":"M²","p":220,"c":"TL","k":25},{"t":"Dolgu","s":"Taş Yünü","n":"TY-40mm","u":"M²","p":285,"c":"TL","k":35},{"t":"Dolgu","s":"Taş Yünü","n":"TY-50mm","u":"M²","p":285,"c":"TL","k":45},{"t":"Dolgu","s":"Taş Yünü","n":"TY-60mm","u":"M²","p":440,"c":"TL","k":50},{"t":"Dolgu","s":"Taş Yünü","n":"TY-70mm","u":"M²","p":505,"c":"TL","k":60},{"t":"Dolgu","s":"Taş Yünü","n":"TY-80mm","u":"M²","p":505,"c":"TL","k":65},{"t":"Dolgu","s":"Taş Yünü","n":"TY-90mm","u":"M²","p":570,"c":"TL","k":80},{"t":"Dolgu","s":"Taş Yünü","n":"TY-100mm","u":"M²","p":570,"c":"TL","k":80},{"t":"Dolgu","s":"Taş Yünü","n":"TY-110mm","u":"M²","p":627,"c":"TL","k":95},{"t":"Dolgu","s":"Taş Yünü","n":"TY-120mm","u":"M²","p":684,"c":"TL","k":100},{"t":"Dolgu","s":"Taş Yünü","n":"TY-130mm","u":"M²","p":741,"c":"TL","k":110},{"t":"Dolgu","s":"Taş Yünü","n":"TY-140mm","u":"M²","p":798,"c":"TL","k":120},{"t":"Dolgu","s":"Taş Yünü","n":"TY-150mm","u":"M²","p":855,"c":"TL","k":135},{"t":"Dolgu","s":"Taş Yünü","n":"TY-160mm","u":"M²","p":912,"c":"TL","k":140},{"t":"Dolgu","s":"Taş Yünü","n":"TY - Levha - 50mm","u":"M²","p":285,"c":"TL","k":50},{"t":"Dolgu","s":"Taş Yünü+İCE","n":"TY30+İCE20","u":"M²","p":536.89,"c":"TL","k":50},{"t":"Dolgu","s":"Taş Yünü+İCE","n":"TY50+İCE25","u":"M²","p":699.97,"c":"TL","k":70},{"t":"Dolgu","s":"Seramik Yün","n":"SR-13mm-96 kg/m³","u":"M²","p":3.87,"c":"EUR","k":13},{"t":"Dolgu","s":"Seramik Yün","n":"SR-25mm-96 kg/m³","u":"M²","p":7.74,"c":"EUR","k":25},{"t":"Dolgu","s":"Seramik Yün","n":"SR-50mm-96 kg/m³","u":"M²","p":15.48,"c":"EUR","k":50},{"t":"Dolgu","s":"Seramik Yün","n":"SR-75mm-96 kg/m³","u":"M²","p":23.22,"c":"EUR","k":75},{"t":"Dolgu","s":"Seramik Yün","n":"SR-100mm-96 kg/m³","u":"M²","p":30.96,"c":"EUR","k":100},{"t":"Dolgu","s":"İğnelenmiş Cam Elyaf","n":"İCE - 10mm","u":"M²","p":3.15,"c":"EUR","k":10},{"t":"Dolgu","s":"İğnelenmiş Cam Elyaf","n":"İCE - 20mm","u":"M²","p":6.3,"c":"EUR","k":20},{"t":"Dolgu","s":"İğnelenmiş Cam Elyaf","n":"İCE - 25mm","u":"M²","p":8.25,"c":"EUR","k":25},{"t":"Dolgu","s":"İğnelenmiş Cam Elyaf","n":"İCE - 50mm","u":"M²","p":16.5,"c":"EUR","k":50},{"t":"Dolgu","s":"İğnelenmiş Cam Elyaf","n":"İCE - 75mm","u":"M²","p":24.75,"c":"EUR","k":75},{"t":"Dolgu","s":"İğnelenmiş Cam Elyaf","n":"İCE - 100mm","u":"M²","p":33,"c":"EUR","k":100},{"t":"Dolgu","s":"Elastomerik Kauçuk Köpük","n":"EKK - 6mm","u":"M²","p":58,"c":"TL","k":6},{"t":"Dolgu","s":"Elastomerik Kauçuk Köpük","n":"EKK - 13mm","u":"M²","p":91,"c":"TL","k":13},{"t":"Dolgu","s":"Elastomerik Kauçuk Köpük","n":"EKK - 19mm","u":"M²","p":125,"c":"TL","k":20},{"t":"Dolgu","s":"Elastomerik Kauçuk Köpük","n":"EKK - 25mm","u":"M²","p":164,"c":"TL","k":25},{"t":"Dolgu","s":"Kompozit","n":"Arg10+İCE10+EKK19","u":"M²","p":0,"c":"TL","k":40},{"t":"Dolgu","s":"Cam Yünü","n":"CY-30mm","u":"M²","p":70,"c":"TL","k":25},{"t":"Dolgu","s":"Aerogel","n":"Argl 5 mm","u":"M²","p":45,"c":"EUR","k":5},{"t":"Dolgu","s":"Aerogel","n":"Argl 10 mm","u":"M²","p":24,"c":"EUR","k":10},{"t":"Dolgu","s":"Aerogel","n":"Argl 15 mm","u":"M²","p":114,"c":"EUR","k":15},{"t":"Dolgu","s":"Aerogel","n":"Argl 20 mm","u":"M²","p":138,"c":"EUR","k":20},{"t":"Dolgu","s":"Aerogel","n":"Argl 25 mm","u":"M²","p":183,"c":"EUR","k":25},{"t":"Dolgu","s":"Aerogel","n":"Argl 30 mm","u":"M²","p":207,"c":"EUR","k":30},{"t":"Dolgu","s":"Aerogel","n":"Argl 35 mm","u":"M²","p":252,"c":"EUR","k":35},{"t":"Dolgu","s":"Earthwool","n":"EW - 100/30 mm","u":"M²","p":110,"c":"TL","k":30},{"t":"Dolgu","s":"TY-70 kg","n":"D3G-20mm","u":"m2","p":2,"c":"EUR","k":20},{"t":"Dolgu","s":"TY-70 kg","n":"D3G-30mm","u":"m2","p":3,"c":"EUR","k":30},{"t":"Dolgu","s":"TY-70 kg","n":"D3G-40mm","u":"m2","p":4,"c":"EUR","k":40},{"t":"Dolgu","s":"TY-70 kg","n":"D3G-50mm","u":"m2","p":5,"c":"EUR","k":50},{"t":"Yardımcı","s":"Dikiş İpi","n":"SS - 3","u":"MT","p":0.013,"c":"USD","k":null},{"t":"Yardımcı","s":"Toka","n":"Toka - 50 mm","u":"ADET","p":5,"c":"TL","k":null},{"t":"Yardımcı","s":"Cırtbant","n":"40 mm - Beyaz","u":"MT","p":0.5,"c":"USD","k":null},{"t":"Yardımcı","s":"Cırtbant","n":"40 mm - Gri","u":"MT","p":0.5,"c":"EUR","k":null},{"t":"Yardımcı","s":"Cırtbant","n":"SS/Kevlar Cırt 25 mm","u":"MT","p":15.29,"c":"EUR","k":null},{"t":"Yardımcı","s":"Cırtbant","n":"SS/Kevlar Cırt 50 mm","u":"MT","p":25.795,"c":"EUR","k":null},{"t":"Yardımcı","s":"Fiyatsız","n":"Fiyatsız-Dikiş","u":"MT","p":0,"c":"TL","k":null},{"t":"Yardımcı","s":"Fiyatsız","n":"Fiyatsız-Cırt","u":"MT","p":0,"c":"TL","k":null},{"t":"Yardımcı","s":"Fiyatsız","n":"Fiyatsız-Boğma","u":"MT","p":0,"c":"TL","k":null},{"t":"Yardımcı","s":"Fiyatsız","n":"Fiyatsız-Agraf","u":"SET","p":0,"c":"TL","k":null},{"t":"Yardımcı","s":"Fiyatsız","n":"Fiyatsız-Ç.Pul Set","u":"SET","p":0,"c":"TL","k":null},{"t":"Yardımcı","s":"Boğma İpi","n":"Kevlar-3mm","u":"MT","p":0.75,"c":"USD","k":null},{"t":"Yardımcı","s":"Boğma İpi","n":"CamElyf-4mm","u":"MT","p":0.25,"c":"USD","k":null},{"t":"Yardımcı","s":"Etiket","n":"30*60","u":"ADET","p":3.2,"c":"TL","k":null},{"t":"Yardımcı","s":"Zımba Set","n":"SS Z+A+P","u":"SET","p":0.06,"c":"USD","k":null},{"t":"Yardımcı","s":"Ç.Pul Set","n":"GALV Ç.Pul Set","u":"ADET","p":0.052,"c":"USD","k":null},{"t":"Yardımcı","s":"Ç.Pul Set","n":"SS Ç.Pul Set","u":"ADET","p":0.15,"c":"USD","k":null},{"t":"Yardımcı","s":"Toka","n":"Kam Tokası","u":"ADET","p":2.5,"c":"USD","k":null},{"t":"Yardımcı","s":"Toka","n":"D-Toka","u":"ADET","p":0.25,"c":"USD","k":null},{"t":"Isıtıcı","s":"1500 W SR Kablo","n":"HT - 1500W","u":"SET","p":240,"c":"EUR","k":null},{"t":"Isıtıcı","s":"2400 W Kablo + 2 Cihaz","n":"HT - 2400W","u":"SET","p":150,"c":"EUR","k":null},{"t":"Yardımcı","s":"Fiyatsız","n":"Fiyatsız-Yardımcı","u":"SET","p":0,"c":"TL","k":null},{"t":"Isıtıcı","s":"1500 W SR Kablo","n":"SRHT-1500W","u":"SET","p":240,"c":"EUR","k":null},{"t":"Isıtıcı","s":"900 W SR Kablo","n":"SRHT-900W","u":"SET","p":167,"c":"EUR","k":null}],"fd":{"15":{"150":89,"300":95,"400":95.2,"600":95.2,"900":121,"1500":121,"2500":133.4},"20":{"150":99,"300":117,"400":117.5,"600":117.5,"900":130,"1500":130,"2500":139.7},"25":{"150":108,"300":124,"400":123.8,"600":123.8,"900":149.2,"1500":149.2,"2500":159},"32":{"150":118,"300":133,"400":133.4,"600":133.4,"900":159,"1500":159,"2500":184.2},"40":{"150":127,"300":155,"400":155,"600":155,"900":178,"1500":178,"2500":203},"50":{"150":152,"300":165,"400":165,"600":165,"900":216,"1500":216,"2500":235},"65":{"150":178,"300":190,"400":190,"600":190,"900":244,"1500":244,"2500":267},"80":{"150":190,"300":210,"400":210,"600":210,"900":241,"1500":267,"2500":305},"100":{"150":229,"300":254,"400":254,"600":273,"900":292,"1500":311,"2500":356},"125":{"150":254,"300":279,"400":279,"600":330,"900":349,"1500":375,"2500":419},"150":{"150":279,"300":318,"400":318,"600":356,"900":381,"1500":394,"2500":483},"200":{"150":343,"300":381,"400":381,"600":419,"900":470,"1500":483,"2500":552},"250":{"150":406,"300":444,"400":444,"600":508,"900":546,"1500":584,"2500":673},"300":{"150":483,"300":521,"400":521,"600":559,"900":610,"1500":673,"2500":762},"350":{"150":533,"300":584,"400":584,"600":603,"900":641,"1500":749},"400":{"150":597,"300":648,"400":648,"600":686,"900":705,"1500":826},"450":{"150":635,"300":711,"400":711,"600":743,"900":787,"1500":914},"500":{"150":698,"300":775,"400":775,"600":813,"900":857,"1500":984},"550":{"150":870,"300":870},"600":{"150":915,"300":915,"400":914,"600":940,"900":1041,"1500":1168},"650":{},"700":{"150":960,"300":960},"750":{"150":1010,"300":1010},"800":{"150":1085,"300":1085},"850":{},"900":{"150":1185,"300":1185},"1000":{"150":1320,"300":1320}},"bl":{"gate":{"15":{"150":{"L1":140,"L1p":162.4,"L2":269},"300":{"L1":151,"L1p":179.4,"L2":260},"600":{"L1":163,"L1p":204.6,"L2":304},"2500":{"L1":264,"L1p":337.2,"L2":450}},"20":{"150":{"L1":140,"L1p":165.4,"L2":269},"300":{"L1":165,"L1p":196.4,"L2":265},"600":{"L1":190,"L1p":234.2,"L2":330},"2500":{"L1":273,"L1p":349.4,"L2":475}},"25":{"150":{"L1":140,"L1p":168.4,"L2":269},"300":{"L1":178,"L1p":212.4,"L2":270},"600":{"L1":216,"L1p":263.8,"L2":355},"900":{"L1":254,"L1p":324,"L2":420},"1500":{"L1":254,"L1p":324,"L2":460},"2500":{"L1":308,"L1p":391,"L2":500}},"32":{"150":{"L1":153,"L1p":184.4,"L2":280},"300":{"L1":191,"L1p":229,"L2":320},"600":{"L1":229,"L1p":283,"L2":370},"900":{"L1":279,"L1p":349,"L2":430},"1500":{"L1":279,"L1p":349,"L2":500},"2500":{"L1":352,"L1p":441,"L2":570}},"40":{"150":{"L1":178,"L1p":212.8,"L2":330},"300":{"L1":203,"L1p":244,"L2":390},"600":{"L1":241,"L1p":299,"L2":400},"900":{"L1":305,"L1p":381.4,"L2":490},"1500":{"L1":305,"L1p":381.4,"L2":570},"2500":{"L1":387,"L1p":489,"L2":640}},"50":{"150":{"L1":191,"L1p":229,"L2":409},"300":{"L1":232,"L1p":276.2,"L2":424},"600":{"L1":295,"L1p":358.6,"L2":458},"900":{"L1":371,"L1p":460,"L2":620},"1500":{"L1":371,"L1p":460,"L2":559},"2500":{"L1":454,"L1p":568.4,"L2":700}},"65":{"150":{"L1":203,"L1p":247.2,"L2":442},"300":{"L1":257,"L1p":307.8,"L2":460},"600":{"L1":333,"L1p":402.6,"L2":508},"900":{"L1":422,"L1p":517,"L2":705},"1500":{"L1":422,"L1p":517,"L2":673},"2500":{"L1":514,"L1p":641.2,"L2":750}},"80":{"150":{"L1":216,"L1p":263.8,"L2":508},"300":{"L1":298,"L1p":354.8,"L2":535},"600":{"L1":359,"L1p":435.4,"L2":570},"900":{"L1":384,"L1p":473,"L2":695},"1500":{"L1":473,"L1p":581.4,"L2":711},"2500":{"L1":584,"L1p":729.8,"L2":887}},"100":{"150":{"L1":242,"L1p":289.8,"L2":590},"300":{"L1":321,"L1p":384.4,"L2":615},"600":{"L1":435,"L1p":518,"L2":650},"900":{"L1":460,"L1p":561.8,"L2":825},"1500":{"L1":549,"L1p":669.4,"L2":838},"2500":{"L1":683,"L1p":848.2,"L2":1079}},"125":{"150":{"L1":267,"L1p":314.8,"L2":673},"300":{"L1":397,"L1p":466.6,"L2":662},"600":{"L1":511,"L1p":612.6,"L2":750},"900":{"L1":562,"L1p":676.4,"L2":825},"1500":{"L1":676,"L1p":835.2,"L2":838},"2500":{"L1":807,"L1p":1003.6,"L2":1079}},"150":{"150":{"L1":280,"L1p":330.8,"L2":767},"300":{"L1":419,"L1p":492.2,"L2":795},"600":{"L1":562,"L1p":670.4,"L2":872},"900":{"L1":613,"L1p":737,"L2":1065},"1500":{"L1":711,"L1p":889,"L2":1397},"2500":{"L1":927,"L1p":1155.8,"L2":1370}},"200":{"150":{"L1":305,"L1p":361.8,"L2":960},"300":{"L1":435,"L1p":517.2,"L2":1012},"600":{"L1":663,"L1p":787,"L2":1101},"900":{"L1":740,"L1p":879.8,"L2":1320},"1500":{"L1":842,"L1p":1039,"L2":1822},"2500":{"L1":1038,"L1p":1304.8,"L2":1530}},"250":{"150":{"L1":343,"L1p":402.8,"L2":1158},"300":{"L1":473,"L1p":568,"L2":1231},"600":{"L1":790,"L1p":929.8,"L2":1279},"900":{"L1":841,"L1p":993.4,"L2":1540},"1500":{"L1":1001,"L1p":1229.8,"L2":2051},"2500":{"L1":1292,"L1p":1635,"L2":2045}},"300":{"150":{"L1":369,"L1p":432.4,"L2":1378},"300":{"L1":518,"L1p":619.6,"L2":1450},"600":{"L1":841,"L1p":986.8,"L2":1468},"900":{"L1":968,"L1p":1139.2,"L2":1840},"1500":{"L1":1146,"L1p":1406.8,"L2":2134},"2500":{"L1":1444,"L1p":1825.2,"L2":2145}},"350":{"150":{"L1":394,"L1p":463.6,"L2":1543},"300":{"L1":778,"L1p":885.6,"L2":1645},"600":{"L1":892,"L1p":1044.4,"L2":1623},"900":{"L1":1039,"L1p":1223.6,"L2":2025},"1500":{"L1":1276,"L1p":1555.6,"L2":2267}},"400":{"150":{"L1":419,"L1p":492.2,"L2":1738},"300":{"L1":854,"L1p":968.2,"L2":1841},"600":{"L1":994,"L1p":1159.2,"L2":1816},"900":{"L1":1140,"L1p":1330.6,"L2":2170},"1500":{"L1":1406,"L1p":1710.8,"L2":2420}},"450":{"150":{"L1":445,"L1p":524.2,"L2":1959},"300":{"L1":930,"L1p":1050.4,"L2":1943},"600":{"L1":1095,"L1p":1273,"L2":2260},"900":{"L1":1232,"L1p":1448,"L2":2232},"1500":{"L1":1559,"L1p":1896,"L2":2600}},"500":{"150":{"L1":470,"L1p":555.2,"L2":2214},"300":{"L1":1010,"L1p":1137,"L2":2154},"600":{"L1":1200,"L1p":1390.6,"L2":2705},"900":{"L1":1334,"L1p":1562.8,"L2":2435},"1500":{"L1":1686,"L1p":2054.4,"L2":2800}},"550":{"600":{"L1":1305,"L1p":null,"L2":2750}},"600":{"150":{"L1":521,"L1p":616,"L2":2599},"300":{"L1":1165,"L1p":1304.6,"L2":2553},"600":{"L1":1407,"L1p":1623,"L2":2810},"900":{"L1":1568,"L1p":1860.2,"L2":2865},"1500":{"L1":1971,"L1p":2390.2,"L2":3250}},"650":{"300":{"L1":1270,"L1p":1375,"L2":2750},"600":{"L1":1461,"L1p":null,"L2":2921}},"700":{"300":{"L1":1371,"L1p":1550,"L2":3100},"600":{"L1":1562,"L1p":null,"L2":3136}},"750":{"300":{"L1":1422,"L1p":1660,"L2":3320},"600":{"L1":1664,"L1p":null,"L2":3327}},"800":{"150":{"L1":1755,"L1p":null,"L2":3910},"300":{"L1":1552,"L1p":1780,"L2":3560},"600":{"L1":1794,"L1p":null,"L2":3581}},"850":{"300":{"L1":1654,"L1p":1800,"L2":3600},"600":{"L1":1946,"L1p":null,"L2":3750}},"900":{"300":{"L1":1755,"L1p":1955,"L2":3910},"600":{"L1":2099,"L1p":null,"L2":4013}},"1000":{}},"globe":{"15":{"150":{"L1":140,"L1p":162.4,"L2":269},"300":{"L1":163,"L1p":191.4,"L2":260},"600":{"L1":163,"L1p":204.6,"L2":304},"900":{"L1":229,"L1p":286.6,"L2":300},"1500":{"L1":216,"L1p":273.6,"L2":300},"2500":{"L1":264,"L1p":337.2,"L2":300}},"20":{"150":{"L1":140,"L1p":165.4,"L2":269},"300":{"L1":191,"L1p":222.4,"L2":265},"600":{"L1":190,"L1p":234.2,"L2":330},"900":{"L1":229,"L1p":292.8,"L2":300},"1500":{"L1":229,"L1p":292.8,"L2":300},"2500":{"L1":273,"L1p":349.4,"L2":300}},"25":{"150":{"L1":140,"L1p":168.4,"L2":269},"300":{"L1":216,"L1p":250.4,"L2":270},"600":{"L1":216,"L1p":263.8,"L2":355},"900":{"L1":254,"L1p":324,"L2":300},"1500":{"L1":254,"L1p":324,"L2":300},"2500":{"L1":308,"L1p":391,"L2":300}},"32":{"150":{"L1":153,"L1p":184.4,"L2":280},"300":{"L1":229,"L1p":267,"L2":320},"600":{"L1":229,"L1p":283,"L2":425},"900":{"L1":279,"L1p":349,"L2":375},"1500":{"L1":279,"L1p":349,"L2":375},"2500":{"L1":352,"L1p":441,"L2":375}},"40":{"150":{"L1":178,"L1p":212.8,"L2":330},"300":{"L1":242,"L1p":283,"L2":390},"600":{"L1":241,"L1p":299,"L2":400},"900":{"L1":305,"L1p":381.4,"L2":450},"1500":{"L1":305,"L1p":381.4,"L2":450},"2500":{"L1":387,"L1p":489,"L2":450}},"50":{"150":{"L1":216,"L1p":254,"L2":410},"300":{"L1":283,"L1p":327.2,"L2":420},"600":{"L1":295,"L1p":358.6,"L2":600},"900":{"L1":371,"L1p":460,"L2":600},"1500":{"L1":371,"L1p":460,"L2":546},"2500":{"L1":454,"L1p":568.4,"L2":700}},"65":{"150":{"L1":229,"L1p":273.2,"L2":432},"300":{"L1":308,"L1p":358.8,"L2":435},"600":{"L1":333,"L1p":402.6,"L2":660},"900":{"L1":422,"L1p":517,"L2":660},"1500":{"L1":422,"L1p":517,"L2":589},"2500":{"L1":514,"L1p":641.2,"L2":750}},"80":{"150":{"L1":254,"L1p":301.8,"L2":450},"300":{"L1":334,"L1p":390.8,"L2":450},"600":{"L1":359,"L1p":435.4,"L2":665},"900":{"L1":384,"L1p":473,"L2":665},"1500":{"L1":473,"L1p":581.4,"L2":711},"2500":{"L1":584,"L1p":729.8,"L2":887}},"100":{"150":{"L1":305,"L1p":352.8,"L2":500},"300":{"L1":372,"L1p":435.4,"L2":520},"600":{"L1":435,"L1p":518,"L2":800},"900":{"L1":460,"L1p":561.8,"L2":800},"1500":{"L1":549,"L1p":669.4,"L2":718},"2500":{"L1":683,"L1p":848.2,"L2":1079}},"125":{"150":{"L1":369,"L1p":416.8,"L2":538},"300":{"L1":416,"L1p":485.6,"L2":620},"600":{"L1":511,"L1p":612.6,"L2":1015},"900":{"L1":562,"L1p":676.4,"L2":825},"1500":{"L1":676,"L1p":835.2,"L2":838},"2500":{"L1":807,"L1p":1003.6,"L2":1079}},"150":{"150":{"L1":419,"L1p":469.8,"L2":550},"300":{"L1":460,"L1p":533.2,"L2":650},"600":{"L1":562,"L1p":670.4,"L2":1145},"900":{"L1":613,"L1p":737,"L2":1015},"1500":{"L1":711,"L1p":889,"L2":890},"2500":{"L1":927,"L1p":1155.8,"L2":1370}},"200":{"150":{"L1":508,"L1p":564.8,"L2":620},"300":{"L1":575,"L1p":657.2,"L2":800},"600":{"L1":663,"L1p":787,"L2":1278},"900":{"L1":740,"L1p":879.8,"L2":1145},"1500":{"L1":842,"L1p":1039,"L2":1240},"2500":{"L1":1038,"L1p":1304.8,"L2":1530}},"250":{"150":{"L1":635,"L1p":694.8,"L2":762},"300":{"L1":638,"L1p":733,"L2":1040},"600":{"L1":790,"L1p":929.8,"L2":1411},"900":{"L1":841,"L1p":993.4,"L2":1278},"1500":{"L1":1001,"L1p":1229.8,"L2":1651},"2500":{"L1":1292,"L1p":1635,"L2":2045}},"300":{"150":{"L1":711,"L1p":774.4,"L2":860},"300":{"L1":727,"L1p":828.6,"L2":1140},"600":{"L1":841,"L1p":986.8,"L2":1468},"900":{"L1":968,"L1p":1139.2,"L2":1411},"1500":{"L1":1146,"L1p":1406.8,"L2":1870},"2500":{"L1":1444,"L1p":1825.2,"L2":2145}},"350":{"150":{"L1":800,"L1p":869.6,"L2":1442},"900":{"L1":1039,"L1p":1223.6,"L2":1700},"1500":{"L1":1276,"L1p":1555.6,"L2":2267}},"400":{"150":{"L1":927,"L1p":1000.2,"L2":1625}},"450":{},"500":{},"550":{},"600":{},"650":{},"700":{},"750":{},"800":{},"850":{},"900":{},"1000":{}},"butterfly":{"15":{"150":{"L1":108,"L1p":130.4,"L2":95},"300":{"L1":229,"L1p":257.4,"L2":140},"600":{"L1":216,"L1p":257.6,"L2":140}},"20":{"150":{"L1":117,"L1p":142.4,"L2":95},"300":{"L1":229,"L1p":260.4,"L2":140},"600":{"L1":216,"L1p":260.2,"L2":140}},"25":{"150":{"L1":140,"L1p":168.4,"L2":110},"300":{"L1":229,"L1p":263.4,"L2":140},"600":{"L1":216,"L1p":263.8,"L2":140},"1500":{"L1":254,"L1p":324,"L2":170},"2500":{"L1":308,"L1p":391,"L2":160}},"32":{"150":{"L1":153,"L1p":184.4,"L2":122},"300":{"L1":242,"L1p":280,"L2":150},"600":{"L1":229,"L1p":283,"L2":160},"900":{"L1":279,"L1p":349,"L2":190},"1500":{"L1":279,"L1p":349,"L2":200},"2500":{"L1":352,"L1p":441,"L2":180}},"40":{"150":{"L1":178,"L1p":212.8,"L2":140},"300":{"L1":254,"L1p":295,"L2":155},"600":{"L1":241,"L1p":299,"L2":180},"900":{"L1":305,"L1p":381.4,"L2":220},"1500":{"L1":305,"L1p":381.4,"L2":250},"2500":{"L1":387,"L1p":489,"L2":200}},"50":{"150":{"L1":216,"L1p":254,"L2":165},"300":{"L1":283,"L1p":327.2,"L2":178},"600":{"L1":295,"L1p":358.6,"L2":187},"900":{"L1":371,"L1p":460,"L2":250},"1500":{"L1":371,"L1p":460,"L2":310},"2500":{"L1":454,"L1p":568.4,"L2":240}},"65":{"150":{"L1":229,"L1p":273.2,"L2":178},"300":{"L1":308,"L1p":358.8,"L2":191},"600":{"L1":333,"L1p":402.6,"L2":216},"900":{"L1":422,"L1p":517,"L2":270},"1500":{"L1":422,"L1p":517,"L2":310},"2500":{"L1":514,"L1p":641.2,"L2":290}},"80":{"150":{"L1":254,"L1p":301.8,"L2":186},"300":{"L1":334,"L1p":390.8,"L2":211},"600":{"L1":359,"L1p":435.4,"L2":278},"900":{"L1":384,"L1p":473,"L2":230},"1500":{"L1":473,"L1p":581.4,"L2":330},"2500":{"L1":584,"L1p":729.8,"L2":340}},"100":{"150":{"L1":305,"L1p":352.8,"L2":217},"300":{"L1":372,"L1p":435.4,"L2":246},"600":{"L1":435,"L1p":518,"L2":316},"900":{"L1":460,"L1p":561.8,"L2":310},"1500":{"L1":549,"L1p":669.4,"L2":355},"2500":{"L1":683,"L1p":848.2,"L2":390}},"125":{"150":{"L1":343,"L1p":390.8,"L2":230},"300":{"L1":416,"L1p":485.6,"L2":305},"600":{"L1":511,"L1p":612.6,"L2":360},"900":{"L1":562,"L1p":676.4,"L2":340},"1500":{"L1":676,"L1p":835.2,"L2":375},"2500":{"L1":807,"L1p":1003.6,"L2":440}},"150":{"150":{"L1":369,"L1p":419.8,"L2":266},"300":{"L1":460,"L1p":533.2,"L2":318},"600":{"L1":562,"L1p":670.4,"L2":400},"900":{"L1":613,"L1p":737,"L2":360},"1500":{"L1":711,"L1p":889,"L2":400},"2500":{"L1":927,"L1p":1155.8,"L2":500}},"200":{"150":{"L1":508,"L1p":564.8,"L2":318},"300":{"L1":549,"L1p":631.2,"L2":356},"600":{"L1":663,"L1p":787,"L2":432},"900":{"L1":740,"L1p":879.8,"L2":430},"1500":{"L1":842,"L1p":1039,"L2":530},"2500":{"L1":1038,"L1p":1304.8,"L2":630}},"250":{"150":{"L1":635,"L1p":694.8,"L2":368},"300":{"L1":638,"L1p":733,"L2":394},"600":{"L1":790,"L1p":929.8,"L2":483},"900":{"L1":841,"L1p":993.4,"L2":480},"1500":{"L1":1001,"L1p":1229.8,"L2":560},"2500":{"L1":1292,"L1p":1635,"L2":760}},"300":{"150":{"L1":711,"L1p":774.4,"L2":406},"300":{"L1":727,"L1p":828.6,"L2":482},"600":{"L1":841,"L1p":986.8,"L2":508},"900":{"L1":968,"L1p":1139.2,"L2":560},"1500":{"L1":1146,"L1p":1406.8,"L2":650},"2500":{"L1":1444,"L1p":1825.2,"L2":900}},"350":{"150":{"L1":800,"L1p":869.6,"L2":432},"300":{"L1":854,"L1p":961.6,"L2":533},"600":{"L1":892,"L1p":1044.4,"L2":572},"900":{"L1":1039,"L1p":1223.6,"L2":629},"1500":{"L1":1276,"L1p":1555.6,"L2":785}},"400":{"150":{"L1":877,"L1p":950.2,"L2":483},"300":{"L1":880,"L1p":994.2,"L2":584},"600":{"L1":994,"L1p":1159.2,"L2":660},"900":{"L1":1140,"L1p":1330.6,"L2":700},"1500":{"L1":1406,"L1p":1710.8,"L2":930}},"450":{"150":{"L1":991,"L1p":1070.2,"L2":600},"300":{"L1":994,"L1p":1114.4,"L2":590},"600":{"L1":1095,"L1p":1273,"L2":730},"900":{"L1":1232,"L1p":1448,"L2":800},"1500":{"L1":1559,"L1p":1896,"L2":800}},"500":{"150":{"L1":991,"L1p":1076.2,"L2":660},"300":{"L1":1035,"L1p":1162,"L2":614},"600":{"L1":1200,"L1p":1390.6,"L2":800},"900":{"L1":1334,"L1p":1562.8,"L2":850},"1500":{"L1":1686,"L1p":2054.4,"L2":870}},"550":{"150":{"L1":1080,"L1p":"#VALUE!","L2":700},"300":{"L1":1140,"L1p":"#VALUE!","L2":655},"600":{"L1":1305,"L1p":"#VALUE!","L2":820}},"600":{"150":{"L1":1308,"L1p":1403,"L2":740},"300":{"L1":1368,"L1p":1507.6,"L2":720},"600":{"L1":1407,"L1p":1623,"L2":900},"900":{"L1":1568,"L1p":1860.2,"L2":950},"1500":{"L1":1971,"L1p":2390.2,"L2":1000}},"650":{"150":{"L1":1295,"L1p":"#VALUE!","L2":820},"300":{"L1":1371,"L1p":"#VALUE!","L2":770},"600":{"L1":1448,"L1p":"#VALUE!","L2":950}},"700":{"150":{"L1":1448,"L1p":"#VALUE!","L2":900},"300":{"L1":1524,"L1p":"#VALUE!","L2":830},"600":{"L1":1600,"L1p":"#VALUE!","L2":1000}},"750":{"150":{"L1":1524,"L1p":"#VALUE!","L2":980},"300":{"L1":1619,"L1p":"#VALUE!","L2":860},"600":{"L1":1651,"L1p":"#VALUE!","L2":1050}},"800":{},"850":{},"900":{"150":{"L1":1956,"L1p":"#VALUE!","L2":1035},"300":{"L1":2111,"L1p":"#VALUE!","L2":1060},"600":{"L1":2083,"L1p":"#VALUE!","L2":1200}},"1000":{}}},"ap":{"1":{"a":0,"p":0},"1.25":{"a":0,"p":0},"1.5":{"a":0,"p":0},"2":{"a":0,"p":0},"2.5":{"a":0,"p":0},"3":{"a":0,"p":0},"4":{"a":4,"p":2},"5":{"a":6,"p":2},"6":{"a":6,"p":2},"8":{"a":6,"p":4},"10":{"a":6,"p":4},"12":{"a":6,"p":4},"14":{"a":8,"p":6},"16":{"a":8,"p":6},"18":{"a":8,"p":6},"20":{"a":8,"p":8},"22":{"a":10,"p":8},"24":{"a":10,"p":8},"28":{"a":10,"p":10},"30":{"a":10,"p":10},"32":{"a":12,"p":12},"36":{"a":12,"p":14},"40":{"a":14,"p":16},"64":{"a":14,"p":20},"0.75":{"a":0,"p":0},"0.5":{"a":0,"p":0}}};

// PDF ENTEGRASYONLARI
const PDF_DIMS = {
    '3way': { '15':{L:130,D:95}, '25':{L:160,D:115}, '50':{L:230,D:165}, '100':{L:350,D:220} },
    'yfilter': { '15':{L:130,D:95}, '50':{L:230,D:165}, '150':{L:480,D:285} },
    'check_clv': { '50':{L:43,D:107}, '100':{L:64,D:162} }, 
    'trap': { '15':{L:150,D:95}, '25':{L:160,D:115} }
};

const DN_LIST=[15,20,25,32,40,50,65,80,100,125,150,200,250,300,350,400,450,500,550,600,650,700,750,800,900,1000];
const DN_INCH={15:.5,20:.75,25:1,32:1.25,40:1.5,50:2,65:2.5,80:3,100:4,125:5,150:6,200:8,250:10,300:12,350:14,400:16,450:18,500:20,550:22,600:24,650:26,700:28,750:30,800:32,900:36,1000:40};
const CLS=[150,300,400,600,900,1500,2500];

const TN = {gate:'Gate Vana', globe:'Globe/Control', butterfly:'Kelebek/Check', yfilter:'Y Pislik Tutucu', basket:'Basket P.T.', disco:'Disco/Wafer', spring:'Yaylı Çekvana', swing:'Swing Check', comp:'Kompansatör', pipe:'Boru', flange:'Flanş', manual_pad:'Manuel Yastık', '3way':'Üç Yollu Vana', 'ball_2':'2 Prç Küresel', 'ball_3':'3 Prç Küresel', 'trap':'Kondenstop', 'check_clv':'Çekvalf CLV', 'elbow':'Dirsek 90°'};
const TT = {gate:'gate', globe:'globe', butterfly:'butterfly', yfilter:'butterfly', basket:'gate', disco:'butterfly', spring:'gate', swing:'butterfly', comp:'butterfly', pipe:'butterfly', flange:'butterfly', manual_pad:null, '3way':'globe', 'ball_2':'gate', 'ball_3':'gate', 'trap':'globe', 'check_clv':'butterfly', 'elbow':'pipe'};
const TP = {gate:['Gövde','Flanş'], globe:['Gövde','Flanş','Kapak'], butterfly:['Tek Parça'], yfilter:['Tek Parça'], basket:['Gövde','Flanş'], disco:['Tek Parça'], spring:['Gövde'], swing:['Tek Parça'], comp:['Tek Parça'], pipe:['Tek Parça'], flange:['Tek Parça'], manual_pad:['Yastık'], '3way':['Gövde','Flanş','Kapak'], 'ball_2':['Gövde','Flanş'], 'ball_3':['Gövde','Flanş'], 'trap':['Gövde','Flanş'], 'check_clv':['Gövde'], 'elbow':['Gövde']};

// ====== STATE ======
let P={usd:43.1, eur:50.3, hc:459.33, oh:.33, mul:2.5, pd:60, ir:.03, sr:.00948, fw:.1, iw:.1, sw:.3, fr:50, fl:50, sm:15, re:150, lbw:.01, lbx:.3, lby:.3, lbyf:.2, gFB:'1 Sİ - 0.5 mm - Gri', gFT:'1 Sİ - 0.5 mm - Gri', gFL:'TY-50mm', gST:'SS - 3', gDS:'CamElyf-4mm', gVL:'40 mm - Gri', gSP:'SS Z+A+P', gND:'SS Ç.Pul Set', gBK:'D-Toka', gLB:'30*60', gDF:1};
let M=[], FD={}, BL={}, AP={}, TK={}, IT=[], RN=1, plQty={}, curShow={TL:true,USD:false,EUR:true};
let SVC={cad:0, montaj:0, montajGun:0, montajGunMly:0, nakliye:0};

// ====== PERSONEL STATE (THE BRAIN) ======
let PP={gun:22, servis:2750, yemek:220, kkd:31200, saat:9, fcRate:0.05, ekKat:0};
let PERS=[
 {g:"USTABAŞI",a:"Mehmet Şahin",net:78000,kidem:1,servis:2750},
 {g:"ORTACI",a:"Metehan Cin",net:42900,kidem:1,servis:2750},
 {g:"ORTACI",a:"Tunahan Kanber",net:42900,kidem:1,servis:2750},
 {g:"DİKİŞÇİ",a:"Aziz-SR",net:44700,kidem:1,servis:2750},
 {g:"DİKİŞÇİ",a:"Zafer Özdemir",net:48360,kidem:1,servis:2750},
 {g:"DİKİŞÇİ",a:"Ali Janeh",net:48360,kidem:1,servis:2750},
 {g:"DİKİŞÇİ",a:"Hasan-SR",net:48400,kidem:0,servis:2750},
 {g:"DİKİŞÇİ",a:"İbrahim - SR",net:46200,kidem:0,servis:2750},
 {g:"DİKİŞÇİ",a:"İbrahim Mandal",net:50600,kidem:0,servis:2750},
 {g:"DOLUMCU",a:"Dol - 1",net:63800,kidem:0,servis:0},
 {g:"DOLUMCU",a:"Dol - 2",net:63800,kidem:0,servis:0},
 {g:"DOLUMCU",a:"Dol - 3",net:63800,kidem:0,servis:0},
];

// ====== CORE HELPERS ======
const fm=(v,d=2)=>v.toLocaleString('tr-TR',{minimumFractionDigits:d,maximumFractionDigits:d});
const ftl=v=>'₺'+fm(v); const feu=v=>'€'+fm(v); const fus=v=>'$'+fm(v);
function mn2(n){return M.find(m=>m.n===n)}
function mp(m){if(!m)return 0; return m.c==='USD'?m.p*P.usd:m.c==='EUR'?m.p*P.eur:m.p}
function tk2(n){return TK[n]||20}
function gfd(dn,cl){return (FD[dn]&&FD[dn][cl])||0}
function gbl(ty,dn,cl){
    if(PDF_DIMS[ty] && PDF_DIMS[ty][dn]) return {L1:PDF_DIMS[ty][dn].L, L1p:0, L2:0};
    const t=TT[ty]; if(!t||!BL[t]||!BL[t][dn])return{L1:0,L1p:0,L2:0};
    if(BL[t][dn][cl])return BL[t][dn][cl];
    const a=Object.keys(BL[t][dn]).map(Number).sort((x,y)=>x-y);
    const c=a.reduce((p,c2)=>Math.abs(c2-cl)<Math.abs(p-cl)?c2:p,a[0]);
    return BL[t][dn][c]||{L1:0,L1p:0,L2:0}
}
function gap(inch){return AP[String(inch)]||{a:0,p:0}}
function curConv(tl,cur){return cur==='USD'?tl/P.usd:cur==='EUR'?tl/P.eur:tl}

// ====== PERSONEL CALCULATIONS ======
function calcPers(p){
 const E=p.net*1.4*12;
 const F=p.kidem?E/12:0;
 const G=p.kidem?F/2:0;
 const base=E+F+G+(p.servis||0)*12+PP.yemek*PP.gun*12+PP.kkd;
 const M=base*PP.fcRate*1.5;
 const N=base+M;
 const O=N/12/PP.gun/PP.saat/(1+PP.fcRate);
 return{E,F,G,M,N,O};
}

function calcAllPers(){
 let tN=0,tO=0,tM=0,cnt=PERS.length;
 PERS.forEach(p=>{const c=calcPers(p);p._c=c;tN+=c.N;tO+=c.O;tM+=c.M});
 const avg=cnt>0?tO/cnt*(1+PP.ekKat):0;
 P.hc=avg; // <--- The Master Brain link! Average hourly cost feeds directly into P.hc
 return{tN,avg,cnt,tM};
}

function rPers(){
 const res=calcAllPers();
 document.getElementById('pmAvg').textContent=ftl(res.avg);
 document.getElementById('pmCnt').textContent=res.cnt;
 document.getElementById('pmTot').textContent=ftl(res.tN);
 document.getElementById('pmDay').textContent=ftl(res.tN/12/PP.gun);
 
 document.getElementById('pmParams').innerHTML=
  `<div class="pr"><span class="l">Aylık Çalışılan Gün</span><input type="number" value="${PP.gun}" step="1" onchange="PP.gun=parseInt(this.value)||22;rPers();recalcAll()"><span class="u">g</span></div>`+
  `<div class="pr"><span class="l">Günlük Saat</span><input type="number" value="${PP.saat}" step="1" onchange="PP.saat=parseInt(this.value)||9;rPers();recalcAll()"><span class="u">sa</span></div>`+
  `<div class="pr"><span class="l">Günlük Yemek</span><input type="number" value="${PP.yemek}" step="10" onchange="PP.yemek=parseFloat(this.value)||0;rPers();recalcAll()"><span class="u">₺</span></div>`+
  `<div class="pr"><span class="l">Yıllık KKD</span><input type="number" value="${PP.kkd}" step="100" onchange="PP.kkd=parseFloat(this.value)||0;rPers();recalcAll()"><span class="u">₺</span></div>`+
  `<div class="pr"><span class="l">Fazla Çalışma %</span><input type="number" value="${PP.fcRate*100}" step="1" onchange="PP.fcRate=parseFloat(this.value)/100||0;rPers();recalcAll()"><span class="u">%</span></div>`+
  `<div class="pr"><span class="l">Ek Katsayı</span><input type="number" value="${PP.ekKat*100}" step="1" onchange="PP.ekKat=parseFloat(this.value)/100||0;rPers();recalcAll()"><span class="u">%</span></div>`+
  `<hr class="border-[var(--brd)] my-3"><div class="text-[0.7rem] text-[var(--tx-mut)] leading-relaxed"><strong>Formül:</strong><br>Brüt = Net × 1.4 × 12<br>Kıdem = Brüt/12<br>İzin = Kıdem/2<br>FÇ = (Brüt+Kıdem+İzin+Servis×12+Yemek×Gün×12+KKD) × FÇ% × 1.5<br>Toplam = Hepsi + FÇ<br>Saat = Toplam/12/Gün/Saat/(1+FÇ%)</div>`;
 
 const b=document.getElementById('pmBody');b.innerHTML='';
 let sTotN=0,sTotO=0,sTotM=0;
 PERS.forEach((p,i)=>{const c=p._c;sTotN+=c.N;sTotO+=c.O;sTotM+=c.M;
  const tr=document.createElement('tr');
  tr.innerHTML=`<td class="lb text-center">${i+1}</td>`+
   `<td><select class="font-bold text-[var(--cy)]" style="background:transparent;border:none;outline:none" onchange="PERS[${i}].g=this.value;rPers();recalcAll()">${['USTABAŞI','ORTACI','DİKİŞÇİ','DOLUMCU','KALİTE','DİĞER'].map(g=>`<option${p.g===g?' selected':''}>${g}</option>`).join('')}</select></td>`+
   `<td><input value="${p.a}" onchange="PERS[${i}].a=this.value" class="font-bold text-[var(--tx)]"></td>`+
   `<td><input type="number" value="${p.net}" step="100" onchange="PERS[${i}].net=parseFloat(this.value)||0;rPers();recalcAll()"></td>`+
   `<td class="c">${fm(c.E)}</td><td class="c">${fm(c.F)}</td><td class="c">${fm(c.G)}</td>`+
   `<td><input type="number" value="${p.servis}" step="100" onchange="PERS[${i}].servis=parseFloat(this.value)||0;rPers();recalcAll()"></td>`+
   `<td class="c">${PP.yemek}</td><td class="c">${fm(PP.kkd,0)}</td>`+
   `<td class="c text-[var(--am)] font-bold">${fm(c.M)}</td>`+
   `<td class="c text-[var(--ac)] font-bold">${fm(c.N)}</td>`+
   `<td class="g font-mono font-black text-[0.85rem]">${fm(c.O)}</td>`+
   `<td class="text-center"><button onclick="optConfirm('Personeli silmek istiyor musunuz?', ()=>{PERS.splice(${i},1);rPers();recalcAll()})" class="bt bt2 px-2 py-1"><i data-lucide="x" class="w-3 h-3"></i></button></td>`;
  b.appendChild(tr)});
 document.getElementById('pmFcTot').textContent=fm(sTotM);
 document.getElementById('pmNTot').textContent=fm(sTotN);
 document.getElementById('pmOTot').textContent=fm(res.avg);
}

function openPersModal(){document.getElementById('persModal').classList.add('show');document.getElementById('npAd').value='';lucide.createIcons()}
function submitPers(){
 const g=document.getElementById('npGorev').value;
 const a=document.getElementById('npAd').value;
 const net=parseFloat(document.getElementById('npNet').value)||0;
 const kidem=parseInt(document.getElementById('npKidem').value);
 const servis=parseFloat(document.getElementById('npServis').value)||0;
 if(!a){toast('Ad girin','er');return}
 PERS.push({g,a,net,kidem,servis});
 document.getElementById('persModal').classList.remove('show');
 rPers(); recalcAll(); toast(a+' eklendi');
}

// ====== PRODUCT CALCULATION ======
function calcItem(it){
 const gFM=mn2(P.gFL), I=gFM?tk2(gFM.n):20, N=gfd(it.dn,it.cl), lens=gbl(it.ty,it.dn,it.cl), inch=DN_INCH[it.dn]||0, apv=gap(inch);
 let tMC=0, tLC=0, tLH=0;
 it.parts.forEach((pt,pi)=>{
  const mFB=mn2(pt.matOv.fb||P.gFB), mFT=mn2(pt.matOv.ft||P.gFT), mFL=mn2(pt.matOv.fl||P.gFL);
  const localI=mFL?tk2(mFL.n):I;
  const fbP=mp(mFB), ftP=mp(mFT), flP=mp(mFL), stP=mp(mn2(P.gST)), dsP=mp(mn2(P.gDS)), vlP=mp(mn2(P.gVL)), spP=mp(mn2(P.gSP)), ndP=mp(mn2(P.gND));
  let S,T;
  if(it.ty==='manual_pad'){S=pt.ov.S||500;T=pt.ov.T||300}
  else if(pt.nm==='Gövde'||pt.nm==='Tek Parça'){const K=(lens.L1||0)+P.fr+P.fl; S=it.qt===0?0:(((N+2*localI)*Math.PI)+P.sm); T=it.qt===0?0:(K+localI+P.sm)}
  else if(pt.nm==='Flanş'){const fL=lens.L1p||lens.L2||(lens.L1||0); const K=fL-N/2; S=it.qt===0?0:(((N+2*localI)*Math.PI)+P.sm); T=it.qt===0?0:(K+localI+P.sm)}
  else if(pt.nm==='Kapak'){S=it.qt===0?0:((N+2*localI)+P.sm); T=S}
  else{S=pt.ov.S||0;T=pt.ov.T||0}
  if(pt.ov.S!=null)S=pt.ov.S; if(pt.ov.T!=null)T=pt.ov.T;
  if(it.qt===0||!S||!T){pt.calc={S:0,T:0,I:localI,N,fab:0,fil:0,sew:0,drw:0,vlc:0,ag:0,pl:0,mc:0,lc:0,lh:0};return}
  const fB2=S*T*2*(1+P.fw)/1e6, fE=90*T*(1+P.fw)/1e6, fR=(50*2*S)*(1+P.fw)/1e6;
  let fab=pt.ov.fab!=null?pt.ov.fab:(fB2+fE+fR);
  let fil=pt.ov.fil!=null?pt.ov.fil:((S-P.sm)*(T-localI-P.sm)*(1+P.iw)/1e6);
  let sew=pt.ov.sew!=null?pt.ov.sew:(((2*(S+T))+(2*S)+(7.5*T))*((1+P.sw)*2.4/1000));
  let drw=pt.ov.drw!=null?pt.ov.drw:(((S+P.re)*2)/1000);
  let vlc=pt.ov.vlc!=null?pt.ov.vlc:((lens.L1||T)/1000);
  let ag=pt.ov.ag!=null?pt.ov.ag:apv.a, pl=pt.ov.pl!=null?pt.ov.pl:apv.p;
  let mc=pt.ov.mc!=null?pt.ov.mc:((fab/2*fbP)+(fab/2*ftP)+(fil*flP)+(sew*stP)+(drw*dsP)+(vlc*vlP)+(ag*spP)+(pl*ndP));
  const lh=(pt.bw*sew+pt.bx*fil+pt.by)*it.df;
  let lc=pt.ov.lc!=null?pt.ov.lc:(lh*P.hc);
  pt.calc={S,T,I:localI,N,fab,fil,sew,drw,vlc,ag,pl,mc,lc,lh}; tMC+=mc; tLC+=lc; tLH+=lh;
 });
 it.calc={tMC,tLC,tLH,uc:tMC+tLC,us:(tMC+tLC)*P.mul,tMA:tMC*it.qt,tLA:tLC*it.qt,tS:(tMC+tLC)*P.mul*it.qt}
}

function recalcAll(){
 IT.forEach(calcItem); rProd();
 const ap2=document.querySelector('.pane.on'); if(ap2){if(ap2.id==='p-pl')rPL(); if(ap2.id==='p-ms')rMas();}
 const tI=IT.length, tJ=IT.reduce((s,i)=>s+i.qt,0), tH=IT.reduce((s,i)=>s+((i.calc.tLH||0)*i.qt),0);
 document.getElementById('sI').textContent=tI; document.getElementById('sJ').textContent=tJ; document.getElementById('sH').textContent=fm(tH,1);
}

// ====== RENDERS ======
function rProd(){
 const b=document.getElementById('pdBody'); b.innerHTML=''; const cur=document.getElementById('pdCur').value;
 const fab=M.filter(m=>m.t==='Kumaş'), fil=M.filter(m=>m.t==='Dolgu');
 IT.forEach((it,ii)=>{ const ic=it.calc;
  it.parts.forEach((pt,pi)=>{ const pc=pt.calc||{}, f0=pi===0, np=it.parts.length;
   const oc=k=>pt.ov[k]!=null?' o':'';
   const matSel=(k,list)=>`<select style="font-size:.68rem;max-width:100px" onchange="IT[${ii}].parts[${pi}].matOv.${k}=this.value||null;recalcAll()"><option value="">Global</option>${list.map(m=>`<option value="${m.n}"${(pt.matOv[k]||'')==m.n?' selected':''}>${m.n}</option>`).join('')}</select>`;
   const tr=document.createElement('tr');
   tr.innerHTML=(f0?`<td class="lb text-indigo-400" rowspan="${np}">${it.ref}</td><td class="lb text-[var(--tx)]" rowspan="${np}">${TN[it.ty]}</td>`:'')+
    `<td class="text-xs font-semibold text-[var(--tx-mut)] px-2">${pt.nm}</td>`+
    (f0?`<td style="text-align:center; font-weight:700" rowspan="${np}">${it.dn||'—'}</td><td style="text-align:center" rowspan="${np}">${it.cl}</td><td rowspan="${np}"><input type="number" value="${it.qt}" min="0" style="width:48px;text-align:center; font-weight:700; color:var(--tx)" onchange="IT[${ii}].qt=parseInt(this.value)||0;recalcAll()"></td><td rowspan="${np}"><input type="number" value="${it.df}" min=".5" max="5" step=".1" style="width:48px;text-align:center" class="text-indigo-400 font-bold bg-[rgba(99,102,241,0.1)] rounded" onchange="IT[${ii}].df=parseFloat(this.value)||1;recalcAll()"></td>`:'')+
    `<td>${matSel('fb',fab)}</td><td>${matSel('ft',fab)}</td><td>${matSel('fl',fil)}</td>`+
    `<td class="c text-amber-400" style="text-align:center">${pc.I||'—'}</td><td class="c">${pc.N?fm(pc.N,0):'—'}</td>`+
    `<td class="c text-cyan-400${oc('S')}" ondblclick="ovr(${ii},${pi},'S',this)" title="Çift tıkla düzenle">${pc.S?fm(pc.S,1):'—'}</td><td class="c text-cyan-400${oc('T')}" ondblclick="ovr(${ii},${pi},'T',this)" title="Çift tıkla düzenle">${pc.T?fm(pc.T,1):'—'}</td>`+
    `<td class="c${oc('fab')}" ondblclick="ovr(${ii},${pi},'fab',this)">${pc.fab?fm(pc.fab,4):'—'}</td><td class="c${oc('fil')}" ondblclick="ovr(${ii},${pi},'fil',this)">${pc.fil?fm(pc.fil,4):'—'}</td><td class="c${oc('sew')}" ondblclick="ovr(${ii},${pi},'sew',this)">${pc.sew?fm(pc.sew,3):'—'}</td><td class="c${oc('drw')}" ondblclick="ovr(${ii},${pi},'drw',this)">${pc.drw?fm(pc.drw,3):'—'}</td><td class="c${oc('vlc')}" ondblclick="ovr(${ii},${pi},'vlc',this)">${pc.vlc?fm(pc.vlc,3):'—'}</td><td class="c${oc('ag')}" ondblclick="ovr(${ii},${pi},'ag',this)">${pc.ag||0}</td><td class="c${oc('pl')}" ondblclick="ovr(${ii},${pi},'pl',this)">${pc.pl||0}</td>`+
    `<td class="c text-[var(--gn)] font-mono${oc('mc')}" ondblclick="ovr(${ii},${pi},'mc',this)">${fm(curConv(pc.mc||0,cur))}</td><td class="c text-[var(--gn)] font-mono${oc('lc')}" ondblclick="ovr(${ii},${pi},'lc',this)">${fm(curConv(pc.lc||0,cur))}</td>`+
    (f0?`<td class="c text-[var(--gn)] font-mono" style="font-weight:900; font-size:.85rem" rowspan="${np}">${fm(curConv(ic.uc||0,cur))}</td><td class="g text-[var(--gn)] font-mono" rowspan="${np}">${fm(curConv(ic.us||0,cur))}</td><td class="g text-[var(--gn)] font-mono" style="font-weight:900; font-size:1rem" rowspan="${np}">${fm(curConv(ic.tS||0,cur))}</td><td style="text-align:center" rowspan="${np}"><button onclick="optConfirm('Sil?', ()=>{IT.splice(${ii},1);recalcAll()})" class="bt bt2 px-2 py-1"><i data-lucide="x" class="w-3 h-3"></i></button></td>`:'');
   b.appendChild(tr);
  });
 });
 const tS=IT.reduce((s,i)=>s+(i.calc.tS||0),0);
 document.getElementById('pdFoot').innerHTML=IT.length?`<tr><td colspan="21" class="lb" style="text-align:right;font-weight:900">TOPLAM</td><td class="c font-mono text-[var(--gn)]" style="font-weight:900">${fm(curConv(IT.reduce((s,i)=>s+((i.calc.uc||0)*i.qt),0),cur))}</td><td class="g font-mono text-[var(--gn)]">${fm(curConv(IT.reduce((s,i)=>s+((i.calc.us||0)*i.qt),0),cur))}</td><td class="g font-mono text-[var(--gn)]" style="font-weight:900;font-size:1.1rem">${fm(curConv(tS,cur))}</td><td></td></tr>`:'';
 lucide.createIcons();
}

function ovr(ii,pi,k,td){
 const pt=IT[ii].parts[pi], cv=pt.calc[k]||0;
 const inp=document.createElement('input'); inp.type='number'; inp.value=cv; inp.step='any';
 inp.style.cssText='width:100%;height:100%;background:rgba(245,158,11,.2);color:var(--am);font-weight:800;border:2px solid var(--am);font-size:.76rem;padding:2px 4px;text-align:right;font-family:inherit;border-radius:4px;outline:none;';
 td.textContent=''; td.appendChild(inp); inp.focus(); inp.select();
 function ok(){const nv=parseFloat(inp.value); if(!isNaN(nv)&&nv!==cv){pt.ov[k]=nv; toast(k+' override edildi','in')} recalcAll()}
 inp.onblur=ok; inp.onkeydown=e=>{if(e.key==='Enter')ok(); if(e.key==='Escape'){delete pt.ov[k]; recalcAll()}}
}

function rGlobal(){
 const fab=M.filter(m=>m.t==='Kumaş'), fil=M.filter(m=>m.t==='Dolgu'), hlp=M.filter(m=>m.t==='Yardımcı');
 function gs(lb,k,list,cur){return`<div class="mb-3"><label class="text-[10px] font-bold text-[var(--tx-mut)] uppercase">${lb}</label><select class="ps mt-1" data-k="${k}" onchange="P[this.dataset.k]=this.value;recalcAll()">${list.map(m=>`<option value="${m.n}"${m.n===cur?' selected':''}>${m.n}</option>`).join('')}</select></div>`}
 document.getElementById('plGlobal').innerHTML=
  gs('Alt Kumaş','gFB',fab,P.gFB)+gs('Üst Kumaş','gFT',fab,P.gFT)+gs('Dolgu Malzemesi','gFL',fil,P.gFL)+
  gs('Dikiş İpi','gST',hlp.filter(m=>m.s==='Dikiş İpi'),P.gST)+gs('Boğma İpi','gDS',hlp.filter(m=>m.s==='Boğma İpi'),P.gDS)+
  gs('Cırt Bant','gVL',hlp.filter(m=>m.s==='Cırtbant'),P.gVL)+
  '<div class="grid grid-cols-2 gap-3">'+gs('Agraf','gSP',hlp.filter(m=>m.s==='Zımba Set'),P.gSP)+gs('Ç.Pul','gND',hlp.filter(m=>m.s==='Ç.Pul Set'),P.gND)+'</div>'+
  '<div class="grid grid-cols-2 gap-3">'+gs('Toka','gBK',hlp.filter(m=>m.s==='Toka'),P.gBK)+gs('Etiket','gLB',hlp.filter(m=>m.s==='Etiket'),P.gLB)+'</div>'+
  `<hr class="border-[var(--brd)] my-4"><div class="pr"><span class="l">Zorluk Katsayısı</span><input type="number" value="${P.gDF}" step=".1" min=".5" max="5" style="width:70px" onchange="P.gDF=parseFloat(this.value)||1;recalcAll()"><span class="u">x</span></div>
   <div class="pr"><span class="l">Satış Çarpanı</span><input type="number" value="${P.mul}" step=".1" style="width:70px" onchange="P.mul=parseFloat(this.value)||2.5;document.getElementById('msMul').value=P.mul;recalcAll()"><span class="u">x</span></div>`;
}

function rMas(){
 const tM=IT.reduce((s,i)=>s+(i.calc.tMA||0),0), tL=IT.reduce((s,i)=>s+(i.calc.tLA||0),0), tLH=IT.reduce((s,i)=>s+((i.calc.tLH||0)*i.qt),0), tS0=IT.reduce((s,i)=>s+(i.calc.tS||0),0), tJ=IT.reduce((s,i)=>s+i.qt,0);
 const svcMontaj=SVC.montajGun*SVC.montajGunMly; const svcTotal=SVC.cad+svcMontaj+SVC.nakliye;
 const tS=tS0+svcTotal; const dir=tM+tL, ind=dir*P.oh, raw=dir+ind, stmp=raw*P.sr, fin=raw*(P.pd/365)*P.ir, tc=raw+stmp+fin+svcTotal, pr=tS-tc, mg=tS>0?(pr/tS*100):0;
 document.getElementById('kC').textContent=ftl(tc); document.getElementById('kS').textContent=ftl(tS);
 document.getElementById('kP').textContent=ftl(pr); document.getElementById('kP').style.color=pr>=0?'var(--gn)':'var(--rd)';
 document.getElementById('kM').textContent='%'+fm(mg,1); document.getElementById('kJ').textContent=tJ;
 document.getElementById('msMul').value=P.mul;
 
 document.getElementById('msServices').innerHTML=
  `<div class="pr"><span class="l">CAD/CAM Hizmet</span><input type="number" value="${SVC.cad}" step="100" onchange="SVC.cad=parseFloat(this.value)||0;rMas()"><span class="u">₺</span></div>`+
  `<div class="pr"><span class="l">Montaj (adam gün)</span><input type="number" value="${SVC.montajGun}" step="1" onchange="SVC.montajGun=parseFloat(this.value)||0;rMas()"><span class="u">g</span></div>`+
  `<div class="pr"><span class="l">Adam gün maliyeti</span><input type="number" value="${SVC.montajGunMly}" step="100" onchange="SVC.montajGunMly=parseFloat(this.value)||0;rMas()"><span class="u">₺</span></div>`+
  `<div class="text-[0.7rem] text-[var(--tx-mut)] pl-1 mb-3">→ Montaj: ${fm(svcMontaj)} ₺</div>`+
  `<div class="pr"><span class="l">Nakliye</span><input type="number" value="${SVC.nakliye}" step="100" onchange="SVC.nakliye=parseFloat(this.value)||0;rMas()"><span class="u">₺</span></div>`;
 document.getElementById('msSvcTotal').textContent=ftl(svcTotal);
 
 const mr=(l,d,v)=>`<tr><td class="lb text-left">${l}</td><td style="text-align:center;color:var(--tx-mut);font-size:.68rem">${d}</td><td class="c font-mono text-[var(--tx)]">${v}</td></tr>`;
 document.getElementById('tMC').innerHTML=`<tr><td class="hd" colspan="3">DOĞRUDAN</td></tr>${mr('Malzeme','',ftl(tM))}${mr('İşçilik',fm(P.hc)+' ₺/sa',ftl(tL))}<tr><td class="hd2 font-bold" colspan="2">DİREKT</td><td class="c font-bold font-mono text-cyan-400">${ftl(dir)}</td></tr><tr><td class="hd" colspan="3">DOLAYLI</td></tr>${mr('Overhead',fm(P.oh*100,0)+'%',ftl(ind))}<tr><td class="hd2 font-bold" colspan="2">HAM MALİYET</td><td class="c font-bold font-mono text-amber-400">${ftl(raw)}</td></tr>${mr('Damga V.',fm(P.sr*100,3)+'%',ftl(stmp))}${mr('Finansal',P.pd+'g',ftl(fin))}${mr('Hizmet Bedeli','',ftl(svcTotal))}<tr><td class="hd2 font-bold" colspan="2">TOPLAM MALİYET</td><td class="c font-bold font-mono text-emerald-400" style="font-size:1rem">${ftl(tc)}</td></tr><tr><td colspan="3" style="height:4px"></td></tr><tr><td class="hd" colspan="3">SATIŞ</td></tr>${mr('Çarpan',P.mul+'x',ftl(tS))}${mr('Kâr','',ftl(pr))}${mr('Marj','','%'+fm(mg,1))}`;
 
 let tots={fab:0,fil:0,sew:0,drw:0,vlc:0,ag:0,pl:0};
 IT.forEach(it=>it.parts.forEach(pt=>{const pc=pt.calc||{};tots.fab+=(pc.fab||0)*it.qt;tots.fil+=(pc.fil||0)*it.qt;tots.sew+=(pc.sew||0)*it.qt;tots.drw+=(pc.drw||0)*it.qt;tots.vlc+=(pc.vlc||0)*it.qt;tots.ag+=(pc.ag||0)*it.qt;tots.pl+=(pc.pl||0)*it.qt}));
 const mm=(l,s,q,u)=>{const m=mn2(s),p=mp(m);return`<tr><td class="lb">${l}</td><td style="font-size:.68rem;color:var(--tx-mut)">${s}</td><td class="c font-mono text-cyan-400">${fm(q,2)}</td><td style="text-align:center;font-size:.68rem;color:var(--tx-mut)">${u}</td><td class="c font-mono text-[var(--tx)]">${fm(p)}</td><td class="c font-mono font-bold text-[var(--tx)]">${ftl(q*p)}</td></tr>`};
 document.getElementById('tMM').innerHTML=`<thead><tr><th>Malzeme</th><th>Seçim</th><th>Miktar</th><th>Br</th><th>B.Fyt</th><th>Toplam</th></tr></thead><tbody>${mm('Alt Kumaş',P.gFB,tots.fab/2,'M²')}${mm('Üst Kumaş',P.gFT,tots.fab/2,'M²')}${mm('Dolgu',P.gFL,tots.fil,'M²')}${mm('Dikiş İpi',P.gST,tots.sew,'MT')}${mm('Boğma İpi',P.gDS,tots.drw,'MT')}${mm('Cırt',P.gVL,tots.vlc,'MT')}${mm('Agraf',P.gSP,tots.ag,'SET')}${mm('Ç.Pul',P.gND,tots.pl,'AD')}<tr><td class="hd2 font-bold" colspan="5">TOPLAM</td><td class="c font-mono font-bold text-emerald-400">${ftl(tM)}</td></tr></tbody>`;
 
 document.getElementById('tMS').innerHTML=`<thead><tr><th>Döviz</th><th>Kur</th><th>Satış</th><th>Maliyet</th><th>Kâr</th></tr></thead><tbody><tr><td class="lb">TL</td><td class="c">1</td><td class="g font-mono">${ftl(tS)}</td><td class="c font-mono">${ftl(tc)}</td><td class="font-mono ${pr>=0?'g':'r'}">${ftl(pr)}</td></tr><tr><td class="lb">USD</td><td class="c font-mono">${fm(P.usd)}</td><td class="g font-mono">${fus(tS/P.usd)}</td><td class="c font-mono">${fus(tc/P.usd)}</td><td class="font-mono ${pr>=0?'g':'r'}">${fus(pr/P.usd)}</td></tr><tr><td class="lb">EUR</td><td class="c font-mono">${fm(P.eur)}</td><td class="g font-mono">${feu(tS/P.eur)}</td><td class="c font-mono">${feu(tc/P.eur)}</td><td class="font-mono ${pr>=0?'g':'r'}">${feu(pr/P.eur)}</td></tr></tbody>`;
 
 document.getElementById('msAH').textContent=fm(tLH,1); document.getElementById('msAD').textContent=fm(tLH/9,1); document.getElementById('msJC').textContent=tJ;
}

// ====== PARAMETRELER ======
function rPar(){
 document.getElementById('pDov').innerHTML=pi('USD/TL','usd',P.usd,'',2)+pi('EUR/TL','eur',P.eur,'',2)+'<hr class="border-[var(--brd)] my-2">'+
 `<div class="pr"><span class="l flex items-center gap-2">Saat Ücreti <i data-lucide="lock" class="w-3.5 h-3.5 text-[var(--tx-mut)]" title="Personel sekmesinden hesaplanır"></i></span><input type="number" value="${P.hc}" disabled title="Personel sekmesinden çekilir" class="opacity-50 cursor-not-allowed font-mono"><span class="u">₺</span></div>`+
 pi('Overhead','oh',P.oh*100,'%',0)+pi('Ödeme Vadesi','pd',P.pd,'g',0)+pi('Yıllık Faiz','ir',P.ir*100,'%',1)+pi('Damga V.','sr',P.sr*100,'%',3);
 document.getElementById('pFir').innerHTML=pi('Kumaş Fire','fw',P.fw*100,'%',0)+pi('İzolasyon Fire','iw',P.iw*100,'%',0)+pi('Dikiş İpi Fire','sw',P.sw*100,'%',0)+'<hr class="border-[var(--brd)] my-2">'+pi('Bindirme SAĞ','fr',P.fr,'mm',0)+pi('Bindirme SOL','fl',P.fl,'mm',0)+pi('Dikiş Pay','sm',P.sm,'mm',0)+pi('Boğma Fazlalık','re',P.re,'mm',0);
 document.getElementById('pLab').innerHTML=pi('Dikiş (sa/mt)','lbw',P.lbw,'',3)+pi('Metraj (sa/m²)','lbx',P.lbx,'',2)+pi('Parça Gövde','lby',P.lby,'',2)+pi('Parça Flanş','lbyf',P.lbyf,'',2);
 rFT(); rLT('gate'); rAT();
}
function pi(lb,k,v,u='',d=2){return`<div class="pr"><span class="l">${lb}</span><input type="number" value="${v}" step="${d>0?Math.pow(10,-d):1}" data-k="${k}" class="font-mono" onchange="up(this)"><span class="u">${u}</span></div>`}
function up(el){const k=el.dataset.k; let v=parseFloat(el.value)||0; if(['oh','fw','iw','sw','ir','sr'].includes(k))v/=100; P[k]=v; recalcAll()}

function rFT(){const t=document.getElementById('tFl');let h='<thead><tr><th>DN</th>';CLS.forEach(c=>h+=`<th>${c}</th>`);h+='</tr></thead><tbody>';DN_LIST.forEach(dn=>{h+=`<tr><td class="lb text-indigo-400 font-bold">DN${dn}</td>`;CLS.forEach(cl=>{const v=(FD[dn]&&FD[dn][cl])||'';h+=`<td><input type="number" value="${v||''}" step=".1" onchange="if(!FD[${dn}])FD[${dn}]={};FD[${dn}][${cl}]=parseFloat(this.value)||null;recalcAll()" placeholder="—"></td>`});h+='</tr>'});t.innerHTML=h+'</tbody>'}
function rLT(ty){const t=document.getElementById('tLn'), d=BL[ty]||{}; let h='<thead><tr><th>DN</th>';CLS.forEach(c=>h+=`<th colspan="3">${c}</th>`);h+="</tr><tr><th></th>";CLS.forEach(()=>h+="<th class='text-amber-400'>L1</th><th class='text-cyan-400'>L1'</th><th class='text-emerald-400'>L2</th>");h+='</tr></thead><tbody>';DN_LIST.forEach(dn=>{h+=`<tr><td class="lb text-indigo-400 font-bold">DN${dn}</td>`;CLS.forEach(cl=>{const e=(d[dn]&&d[dn][cl])||{};['L1','L1p','L2'].forEach(k=>{h+=`<td><input type="number" value="${e[k]||''}" step=".1" style="width:58px" onchange="if(!BL['${ty}'])BL['${ty}']={};if(!BL['${ty}'][${dn}])BL['${ty}'][${dn}]={};if(!BL['${ty}'][${dn}][${cl}])BL['${ty}'][${dn}][${cl}]={};BL['${ty}'][${dn}][${cl}]['${k}']=parseFloat(this.value)||null;recalcAll()" placeholder="—"></td>`})});h+='</tr>'});t.innerHTML=h+'</tbody>'}
function slt(ty){['gate','globe','butterfly'].forEach(t=>document.getElementById('bl-'+t).className=t===ty?'bt bt4 on':'bt bt4');rLT(ty)}
function rAT(){const t=document.getElementById('tAg'),ks=Object.keys(AP).sort((a,b)=>parseFloat(a)-parseFloat(b));let h='<thead><tr><th>Çap"</th><th>Agraf</th><th>Pul</th></tr></thead><tbody>';ks.forEach(k=>{const d=AP[k];h+=`<tr><td class="lb text-indigo-400 font-bold">${k}"</td><td><input type="number" value="${d.a}" min="0" onchange="AP['${k}'].a=parseInt(this.value)||0;recalcAll()"></td><td><input type="number" value="${d.p}" min="0" onchange="AP['${k}'].p=parseInt(this.value)||0;recalcAll()"></td></tr>`});t.innerHTML=h+'</tbody>'}
function rVRef(){const sel=document.getElementById('vRefSel').value;const vd=VALVE_DATA[sel];if(!vd)return;const dims=vd.dims;const dns=Object.keys(dims).map(Number).sort((a,b)=>a-b);let h='<thead><tr><th>DN</th><th>D (Flanş Çap)</th><th>L (Gövde Boy)</th><th>H (Yükseklik)</th><th>Dk (Kapak Çap)</th></tr></thead><tbody>';dns.forEach(dn=>{const d=dims[dn];h+=`<tr><td class="lb text-indigo-400 font-bold">DN${dn}</td><td class="c font-mono text-[var(--tx)]">${d.D}</td><td class="c font-mono text-cyan-400">${d.L}</td><td class="c font-mono text-[var(--tx-mut)]">${d.H||'—'}</td><td class="c font-mono text-[var(--tx-mut)]">${d.Dk||'—'}</td></tr>`});document.getElementById('tVRef').innerHTML=h+'</tbody>'}

// ====== MALZEME TABLOSU ======
let mfl='all';
function rMat(){const b=document.getElementById('mBody');b.innerHTML='';M.forEach((m,i)=>{if(mfl!=='all'&&m.t!==mfl)return;const tr=document.createElement('tr');tr.innerHTML=`<td class="lb text-xs text-center">${i+1}</td><td><select onchange="M[${i}].t=this.value;rGlobal()">${['Kumaş','Dolgu','Yardımcı','Isıtıcı'].map(t=>`<option${m.t===t?' selected':''}>${t}</option>`).join('')}</select></td><td><input value="${m.s}" onchange="M[${i}].s=this.value"></td><td><input value="${m.n}" onchange="M[${i}].n=this.value;rGlobal()" style="font-weight:700" class="text-[var(--tx)]"></td><td><input value="${m.u}" onchange="M[${i}].u=this.value" style="width:50px;text-align:center"></td><td><input type="number" value="${m.p}" step=".001" class="font-mono" onchange="M[${i}].p=parseFloat(this.value)||0;rMat();recalcAll()"></td><td><select onchange="M[${i}].c=this.value;rMat();recalcAll()" style="width:60px">${['TL','USD','EUR'].map(c=>`<option${m.c===c?' selected':''}>${c}</option>`).join('')}</select></td><td class="c font-mono font-bold text-[var(--gn)]">${fm(mp(m))}</td><td><input type="number" value="${m.k||''}" onchange="M[${i}].k=parseFloat(this.value)||null;TK[M[${i}].n]=M[${i}].k;recalcAll()" style="width:50px;text-align:center" placeholder="—"></td><td style="text-align:center"><button onclick="M.splice(${i},1);rMat();rGlobal()" class="bt bt2 px-2 py-1"><i data-lucide="trash-2" class="w-3 h-3"></i></button></td>`;b.appendChild(tr)});document.getElementById('mfBtns').innerHTML=['all','Kumaş','Dolgu','Yardımcı','Isıtıcı'].map(t=>`<button class="${mfl===t?'on':''}" onclick="mfl='${t}';rMat()">${t==='all'?'Tümü':t}</button>`).join('');lucide.createIcons();}

// ====== FİYAT LİSTESİ ======
function rPL(){
 rGlobal();
 const ct=document.getElementById('curToggle'); ct.innerHTML=['TL','USD','EUR'].map(c=>`<button class="${curShow[c]?'on':''}" onclick="curShow['${c}']=!curShow['${c}'];rPL()">${c}</button>`).join('');
 const hd=document.getElementById('plHead'); let hh='<tr><th>REF</th><th>DN</th><th style="min-width:80px">Mahal</th><th style="min-width:200px">Açıklama</th><th>Adet</th><th>Birim</th>';
 if(curShow.TL)hh+='<th style="background:rgba(99,102,241,.1)">B.TL</th><th style="background:rgba(99,102,241,.13)">T.TL</th>';
 if(curShow.USD)hh+='<th style="background:rgba(16,185,129,.1)">B.USD</th><th style="background:rgba(16,185,129,.15)">T.USD</th>';
 if(curShow.EUR)hh+='<th style="background:rgba(6,182,212,.1)">B.EUR</th><th style="background:rgba(6,182,212,.15)">T.EUR</th>';
 hh+='</tr>'; hd.innerHTML=hh;
 const b=document.getElementById('plBody'); b.innerHTML=''; let totTL=0;
 IT.forEach(it=>{const ic=it.calc, q=plQty[it.ref]||1, aq=it.qt*q, uTL=ic.us||0, tTL=uTL*aq; totTL+=tTL;
  const tr=document.createElement('tr');
  let h=`<td class="lb font-bold text-indigo-400 text-center">${it.ref}</td><td class="text-center font-bold">DN${it.dn}</td><td><input value="${it.mh}" onchange="IT.find(x=>x.ref===${it.ref}).mh=this.value" placeholder="—"></td><td class="lb text-left">INSJACK® ${TN[it.ty]} DN${it.dn} Cl${it.cl}</td><td class="o text-center font-bold" ondblclick="openQtyModal(${it.ref})">${aq}</td><td class="text-center text-[var(--tx-mut)]">AD</td>`;
  if(curShow.TL)h+=`<td class="c font-mono">${fm(uTL)}</td><td class="c font-mono font-bold text-indigo-400">${fm(tTL)}</td>`;
  if(curShow.USD)h+=`<td class="c font-mono">${fm(uTL/P.usd)}</td><td class="c font-mono font-bold text-[var(--gn)]">${fm(tTL/P.usd)}</td>`;
  if(curShow.EUR)h+=`<td class="c font-mono">${fm(uTL/P.eur)}</td><td class="c font-mono font-bold text-cyan-400">${fm(tTL/P.eur)}</td>`;
  tr.innerHTML=h; b.appendChild(tr)
 });
 const ft=document.getElementById('plFoot'); let fh='<td colspan="6" class="lb text-right font-extrabold">TOPLAM</td>';
 if(curShow.TL)fh+=`<td class="c"></td><td class="c font-mono font-black text-[1rem] text-indigo-400">${ftl(totTL)}</td>`;
 if(curShow.USD)fh+=`<td class="c"></td><td class="c font-mono font-black text-[1rem] text-[var(--gn)]">${fus(totTL/P.usd)}</td>`;
 if(curShow.EUR)fh+=`<td class="c"></td><td class="c font-mono font-black text-[1rem] text-cyan-400">${feu(totTL/P.eur)}</td>`;
 ft.innerHTML=fh;
}

// ====== INTERACTIONS & MODALS ======
function go(id,el){document.querySelectorAll('.pane').forEach(p=>p.classList.remove('on'));document.querySelectorAll('.slink').forEach(s=>s.classList.remove('on'));document.getElementById('p-'+id).classList.add('on');el.classList.add('on');if(id==='pl')rPL();if(id==='ms')rMas();lucide.createIcons();}
function updDN(){const ty=document.getElementById('aType').value; const s=document.getElementById('aDN'); s.innerHTML='<option value="">DN</option>'; if(ty==='manual_pad'){s.innerHTML='<option value="0">Manuel</option>';return} DN_LIST.forEach(dn=>{if(FD[dn])s.innerHTML+=`<option value="${dn}">DN${dn}</option>`});}
function addItem(){
 const ty=document.getElementById('aType').value, dn=parseInt(document.getElementById('aDN').value), cl=parseInt(document.getElementById('aCls').value), qt=parseInt(document.getElementById('aQty').value);
 if(!ty||(isNaN(dn)&&ty!=='manual_pad')) return optAlert('Lütfen Tip ve DN seçin.');
 let df=P.gDF; if(ty==='elbow'){df=1.5; toast('Dirsek kuralı: Zorluk (df) 1.5 atandı','in')}
 const parts=(TP[ty]||['Tek Parça']).map((nm,i)=>({nm,ov:{},bw:P.lbw,bx:P.lbx,by:i===0?P.lby:P.lbyf,calc:{},matOv:{}}));
 IT.push({ref:RN++, ty, dn:dn||0, cl, qt:qt||1, df, parts, mh:'', calc:{}}); recalcAll(); toast(`${TN[ty]} eklendi`);
}
function optAlert(m){document.getElementById('optConfirmMsg').textContent=m;document.getElementById('optConfirmBg').classList.add('show');document.getElementById('optConfirmYes').onclick=()=>document.getElementById('optConfirmBg').classList.remove('show');}
function optConfirm(m,cb){document.getElementById('optConfirmMsg').textContent=m;document.getElementById('optConfirmBg').classList.add('show');document.getElementById('optConfirmYes').onclick=()=>{cb();document.getElementById('optConfirmBg').classList.remove('show')}}
function toast(m,t='ok'){const bx=document.getElementById('toastBox'), d=document.createElement('div'); d.className=`toast ${t}`; d.innerHTML=`<i data-lucide="${t==='ok'?'check-circle':t==='er'?'alert-octagon':'info'}"></i><span>${m}</span>`; bx.appendChild(d); lucide.createIcons(); setTimeout(()=>{d.style.opacity='0';d.style.transform='translateX(100%)';setTimeout(()=>d.remove(),300)},3000)}

function openQtyModal(ref){qtyRef=ref;const it=IT.find(i=>i.ref===ref);if(!it)return;document.getElementById('qmCur').textContent=it.qt;document.getElementById('qmVal').value=plQty[ref]||1;document.getElementById('qtyModal').classList.add('show')}
function submitQty(){if(qtyRef)plQty[qtyRef]=parseInt(document.getElementById('qmVal').value)||1;document.getElementById('qtyModal').classList.remove('show');rPL()}

function saveData(){localStorage.setItem('insjack_pro_v2_1',JSON.stringify({P,M,IT,FD,BL,AP,TK,SVC,plQty,curShow,PERS,PP,RN}));toast('Sistem kaydedildi')}

// ====== INIT ======
window.onload=()=>{
 document.getElementById('themeBtn').innerHTML = `<i data-lucide="${currentTheme === 'dark' ? 'sun' : 'moon'}" class="w-4 h-4"></i>`;
 const D=EXCEL_DATA; P.usd=D.fx.USD; P.eur=D.fx.EUR;
 M=D.mat.map(m=>({...m})); M.forEach(m=>{if(m.k)TK[m.n]=m.k});
 FD={};for(const[dn,cls] of Object.entries(D.fd)){FD[parseInt(dn)]={};for(const[c,v] of Object.entries(cls))FD[parseInt(dn)][parseInt(c)]=v}
 BL={};for(const[ty,tbl] of Object.entries(D.bl)){BL[ty]={};for(const[dn,cls] of Object.entries(tbl)){BL[ty][parseInt(dn)]={};for(const[c,v] of Object.entries(cls))BL[ty][parseInt(dn)][parseInt(c)]=v}}
 AP=D.ap;
 try{const sv=JSON.parse(localStorage.getItem('insjack_pro_v2_1'));if(sv&&sv.IT){Object.assign(P,sv.P||{});M=sv.M||M;IT=sv.IT||[];FD=sv.FD||FD;BL=sv.BL||BL;AP=sv.AP||AP;TK=sv.TK||TK;SVC=sv.SVC||SVC;plQty=sv.plQty||{};curShow=sv.curShow||curShow;if(sv.PERS)PERS=sv.PERS;if(sv.PP)PP=sv.PP;RN=sv.RN||(Math.max(...IT.map(i=>i.ref),0)+1)}}catch(e){}
 rPers(); // HC (Saat ücreti) hesaplanıp P.hc'ye atanır
 rPar(); rMat(); rGlobal(); updDN(); recalcAll(); rVRef(); lucide.createIcons();
}
</script></body></html>
