<!doctype html>
<html lang="tr" class="dark">
<head>
  <meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Müşteri Ekle</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="auth.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="icon" type="image/png" sizes="192x192" href="/favicon.png">
  <style>body:not(.auth-checked){opacity:0;pointer-events:none}body.auth-checked{opacity:1;transition:opacity .3s ease}</style>
  <script>tailwind.config={darkMode:'class',theme:{fontFamily:{sans:['"Plus Jakarta Sans"','sans-serif']}}}</script>
  <style>
    :root{--bg-grad:radial-gradient(ellipse at top,#f8fafc 0%,#e2e8f0 40%,#cbd5e1 100%);--glass-panel:rgba(255,255,255,.8);--glass-border:rgba(0,0,0,.05);--glass-card-bg:linear-gradient(145deg,rgba(255,255,255,.9) 0%,rgba(241,245,249,.95) 100%);--scroll-thumb:#cbd5e1;--sidebar-active-bg:rgba(99,102,241,.1);--sidebar-text:#64748b;--sidebar-text-hover:#0f172a}
    .dark{--bg-grad:radial-gradient(ellipse at top,#1e1b4b 0%,#0f172a 40%,#020617 100%);--glass-panel:rgba(30,41,59,.4);--glass-border:rgba(255,255,255,.05);--glass-card-bg:linear-gradient(145deg,rgba(30,41,59,.6) 0%,rgba(15,23,42,.8) 100%);--scroll-thumb:#334155;--sidebar-active-bg:rgba(99,102,241,.2);--sidebar-text:#94a3b8;--sidebar-text-hover:#fff}
    body{background:var(--bg-grad);background-attachment:fixed;color:#0f172a;overflow:hidden}.dark body{color:#f1f5f9}
    .glass-panel{background:var(--glass-panel);backdrop-filter:blur(12px);border:1px solid var(--glass-border)}
    .glass-card{background:var(--glass-card-bg);border:1px solid var(--glass-border)}
    ::-webkit-scrollbar{width:6px}::-webkit-scrollbar-thumb{background:var(--scroll-thumb);border-radius:3px}
    .sidebar-link{display:flex;align-items:center;gap:12px;padding:12px 16px;margin-bottom:4px;border-radius:12px;color:var(--sidebar-text);transition:all .2s;font-weight:500;font-size:.9rem;cursor:pointer;width:100%;text-align:left;white-space:nowrap}
    .sidebar-link:hover,.sidebar-link.active{background:var(--sidebar-active-bg);color:var(--sidebar-text-hover)}.sidebar-link.active{border-left:3px solid #6366f1}
    .sidebar-link i{width:20px;height:20px;min-width:20px}
    .submenu{overflow:hidden;transition:max-height .3s;max-height:0}.submenu.open{max-height:800px}
    .submenu-item{display:flex;align-items:center;justify-content:space-between;padding-right:12px;margin-bottom:2px;border-radius:8px;transition:background .2s}
    .submenu-item:hover{background:rgba(0,0,0,.03)}.dark .submenu-item:hover{background:rgba(255,255,255,.03)}
    .submenu-link{flex:1;display:flex;align-items:center;gap:10px;padding:8px 0 8px 48px;color:var(--sidebar-text);font-size:.85rem;transition:color .2s;text-decoration:none;position:relative;white-space:nowrap}
    .submenu-link:before{content:'';position:absolute;left:30px;top:50%;width:4px;height:4px;border-radius:50%;background:var(--sidebar-text);transform:translateY(-50%);opacity:.5}
    .submenu-link:hover{color:#6366f1}
    aside.collapsed{width:80px}aside.collapsed .sidebar-link{justify-content:center;padding:12px}
    aside.collapsed .sidebar-link span,aside.collapsed .sidebar-link i.chevron,aside.collapsed .submenu,aside.collapsed .logo-text,aside.collapsed .sidebar-title,aside.collapsed .user-info{display:none!important}
    .form-section{border-radius:16px;overflow:hidden}
    .form-section-title{font-size:.75rem;font-weight:700;text-transform:uppercase;letter-spacing:.05em;padding:14px 20px;border-bottom:1px solid var(--glass-border)}
    .form-row{display:flex;align-items:center;padding:8px 20px;border-bottom:1px solid rgba(0,0,0,.03);gap:8px;min-height:44px}
    .dark .form-row{border-bottom-color:rgba(255,255,255,.03)}.form-row:last-child{border-bottom:none}
    .form-label{width:150px;min-width:150px;font-size:.8rem;font-weight:600;color:var(--sidebar-text)}.form-label.required{color:#ef4444}
    .form-input{flex:1;background:transparent;border:1px solid var(--glass-border);border-radius:8px;padding:7px 12px;font-size:.85rem;outline:none;transition:border-color .2s;color:inherit}.form-input:focus{border-color:#6366f1}
    .form-select{flex:1;background:transparent;border:1px solid var(--glass-border);border-radius:8px;padding:7px 12px;font-size:.85rem;outline:none;color:inherit;cursor:pointer}.form-select:focus{border-color:#6366f1}
    .dark .form-input,.dark .form-select{background:rgba(15,23,42,.3)}
    .modal-enter{animation:slideInRight .3s ease-out forwards}@keyframes slideInRight{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}
    .animate-pop{animation:popIn .3s cubic-bezier(.16,1,.3,1)}@keyframes popIn{0%{transform:scale(.9);opacity:0}100%{transform:scale(1);opacity:1}}
    .animate-bounce-in{animation:successBounce .5s cubic-bezier(.16,1,.3,1)}@keyframes successBounce{0%{transform:scale(.8);opacity:0}50%{transform:scale(1.1)}100%{transform:scale(1);opacity:1}}
    .contact-row{display:flex;align-items:center;gap:8px;padding:6px 20px;border-bottom:1px solid rgba(0,0,0,.03)}.dark .contact-row{border-bottom-color:rgba(255,255,255,.03)}
    .contact-row .clabel{width:150px;min-width:150px;font-size:.8rem;font-weight:600;color:var(--sidebar-text)}
    .contact-row .ccode{width:50px;background:transparent;border:1px solid var(--glass-border);border-radius:8px;padding:7px 8px;font-size:.85rem;text-align:center;outline:none;color:inherit}.contact-row .ccode:focus{border-color:#6366f1}
    .dark .contact-row .ccode{background:rgba(15,23,42,.3)}
    .wa-btn{width:32px;height:32px;border-radius:50%;background:#25d366;display:flex;align-items:center;justify-content:center;color:#fff;cursor:pointer;transition:transform .2s;flex-shrink:0}.wa-btn:hover{transform:scale(1.1)}
  </style>
</head>
<body class="flex h-screen w-full text-slate-800 dark:text-slate-100">
  <div class="fixed inset-0 z-0 pointer-events-none opacity-50 dark:opacity-100">
    <div class="absolute top-0 left-0 w-[500px] h-[500px] bg-indigo-500/20 dark:bg-indigo-600/10 rounded-full blur-[100px]"></div>
    <div class="absolute bottom-0 right-0 w-[500px] h-[500px] bg-blue-500/20 dark:bg-blue-600/10 rounded-full blur-[100px]"></div>
  </div>

  <!-- SIDEBAR -->
    <aside id="mainSidebar"></aside>
  <script src="sidebar.js"></script>

  <!-- MAIN -->
  <main class="flex-1 flex flex-col h-full relative z-10 overflow-hidden bg-slate-50/50 dark:bg-transparent">
    <header class="h-16 flex items-center justify-between px-6 border-b border-slate-200 dark:border-white/5 glass-panel shrink-0">
      <div class="flex items-center gap-4">
        <a href="teklif-yonetimi.html" class="p-2 rounded-lg text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 dark:hover:bg-indigo-900/20 transition"><i data-lucide="arrow-left" class="w-5 h-5"></i></a>
        <h1 class="text-lg font-bold text-slate-800 dark:text-white" id="pageTitle">Yeni Müşteri Ekle</h1>
      </div>
      <div class="flex items-center gap-2">
        <button onclick="resetForm()" class="flex items-center gap-2 border border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-300 px-4 py-2 rounded-xl text-sm font-bold hover:border-red-400 transition"><i data-lucide="rotate-ccw" class="w-4 h-4"></i> Temizle</button>
        <button onclick="saveClient()" class="flex items-center gap-2 bg-indigo-600 hover:bg-indigo-500 text-white px-5 py-2 rounded-xl text-sm font-bold transition shadow-lg shadow-indigo-600/20"><i data-lucide="check" class="w-4 h-4"></i> Kaydet</button>
      </div>
    </header>

    <div class="flex-1 overflow-y-auto p-6 md:p-8">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
        <!-- SOL: MÜŞTERİ BİLGİLERİ -->
        <div class="glass-card form-section">
          <div class="form-section-title text-indigo-600 dark:text-indigo-400 bg-indigo-50/50 dark:bg-indigo-900/10 flex items-center gap-2"><i data-lucide="building-2" class="w-4 h-4"></i> MÜŞTERİ BİLGİLERİ</div>
          <div>
            <div class="form-row"><span class="form-label">Müşteri Kodu:</span><input type="text" id="clientCode" class="form-input" placeholder="Otomatik veya manuel"></div>
            <div class="form-row"><span class="form-label required">Müşteri Adı:</span><input type="text" id="clientName" class="form-input" placeholder="Firma adı"></div>
            <div class="form-row"><span class="form-label">Müşteri Ünvanı:</span><input type="text" id="clientTitle" class="form-input" placeholder="Ltd. Şti, A.Ş. vb."></div>
            <div class="form-row"><span class="form-label required">Yetkili Adı:</span><input type="text" id="clientContact" class="form-input" placeholder="İlgili kişi"></div>
            <div class="form-row"><span class="form-label">Email:</span><div class="flex items-center gap-2 flex-1"><input type="email" id="clientEmail" class="form-input" placeholder="email@firma.com"><button onclick="sendEmail()" class="p-2 rounded-lg text-orange-500 hover:bg-orange-50 dark:hover:bg-orange-900/20 transition shrink-0" title="E-posta Gönder"><i data-lucide="mail" class="w-4 h-4"></i></button></div></div>
            <div class="form-row"><span class="form-label">Müşteri Tipi:</span><select id="clientType" class="form-select"><option value="">Seçin...</option><option>Kurumsal</option><option>Bireysel</option><option>Bayi</option><option>Tedarikçi</option></select></div>
            <div class="form-row">
              <span class="form-label">Kategori:</span>
              <div class="flex items-center gap-2 flex-1">
                <select id="clientCategory" class="form-select"><option value="">Seçin...</option></select>
                <button onclick="addNewOption('clientCategory','Yeni Kategori')" class="p-2 rounded-lg text-indigo-600 hover:bg-indigo-50 dark:hover:bg-indigo-900/20 transition shrink-0" title="Yeni Kategori Ekle"><i data-lucide="plus-circle" class="w-4 h-4"></i></button>
              </div>
            </div>
            <div class="form-row">
              <span class="form-label">Sektör:</span>
              <div class="flex items-center gap-2 flex-1">
                <select id="clientSector" class="form-select"><option value="">Seçin...</option><option>Enerji</option><option>İnşaat</option><option>Sanayi</option><option>Gıda</option><option>Tekstil</option><option>Kimya</option><option>Otomotiv</option><option>Madencilik</option></select>
                <button onclick="addNewOption('clientSector','Yeni Sektör')" class="p-2 rounded-lg text-indigo-600 hover:bg-indigo-50 dark:hover:bg-indigo-900/20 transition shrink-0" title="Yeni Sektör Ekle"><i data-lucide="plus-circle" class="w-4 h-4"></i></button>
              </div>
            </div>
            <div class="form-row">
              <span class="form-label">Kaynak:</span>
              <div class="flex items-center gap-2 flex-1">
                <select id="clientSource" class="form-select"><option value="">Seçin...</option><option>Web Sitesi</option><option>Referans</option><option>Fuar</option><option>LinkedIn</option><option>Telefon</option><option>Diğer</option></select>
                <button onclick="addNewOption('clientSource','Yeni Kaynak')" class="p-2 rounded-lg text-indigo-600 hover:bg-indigo-50 dark:hover:bg-indigo-900/20 transition shrink-0" title="Yeni Kaynak Ekle"><i data-lucide="plus-circle" class="w-4 h-4"></i></button>
              </div>
            </div>
          </div>
        </div>

        <!-- SAĞ: ADRES & VERGİ BİLGİLERİ -->
        <div class="space-y-6">
          <div class="glass-card form-section">
            <div class="form-section-title text-emerald-600 dark:text-emerald-400 bg-emerald-50/50 dark:bg-emerald-900/10 flex items-center gap-2"><i data-lucide="map-pin" class="w-4 h-4"></i> ADRES BİLGİLERİ</div>
            <div>
              <div class="form-row"><span class="form-label">Ülke:</span><select id="clientCountry" class="form-select"><option>Türkiye</option><option>ABD</option><option>Almanya</option><option>İngiltere</option><option>Fransa</option><option>Diğer</option></select></div>
              <div class="form-row"><span class="form-label">Şehir:</span><select id="clientCity" class="form-select"><option value="">Seçin...</option><option>İstanbul</option><option>Ankara</option><option>İzmir</option><option>Bursa</option><option>Antalya</option><option>Kocaeli</option><option>Gaziantep</option><option>Konya</option><option>Adana</option><option>Mersin</option></select></div>
              <div class="form-row"><span class="form-label">İlçe:</span><input type="text" id="clientDistrict" class="form-input" placeholder="İlçe"></div>
              <div class="form-row"><span class="form-label">Açık Adres:</span><textarea id="clientAddress" class="form-input" rows="2" placeholder="Tam adres..."></textarea></div>
              <div class="form-row">
                <span class="form-label">Ülke Kodu:</span>
                <input type="text" id="clientCountryCode" class="form-input" value="90" style="max-width:60px">
                <span class="form-label" style="width:auto;min-width:auto;margin-left:8px">Posta:</span>
                <input type="text" id="clientPostalCode" class="form-input" placeholder="Posta kodu">
              </div>
            </div>
          </div>
          <div class="glass-card form-section">
            <div class="form-section-title text-amber-600 dark:text-amber-400 bg-amber-50/50 dark:bg-amber-900/10 flex items-center gap-2"><i data-lucide="receipt" class="w-4 h-4"></i> VERGİ BİLGİLERİ</div>
            <div>
              <div class="form-row"><span class="form-label">Vergi Dairesi:</span><input type="text" id="clientTaxOffice" class="form-input" placeholder="Vergi dairesi adı"></div>
              <div class="form-row"><span class="form-label">Vergi No:</span><input type="text" id="clientTaxNo" class="form-input" placeholder="Vergi numarası"></div>
              <div class="form-row"><span class="form-label">TC Kimlik No:</span><input type="text" id="clientTcNo" class="form-input" placeholder="TC kimlik (bireysel)"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- ALT: İLETİŞİM BİLGİLERİ -->
      <div class="glass-card form-section mb-6">
        <div class="form-section-title text-purple-600 dark:text-purple-400 bg-purple-50/50 dark:bg-purple-900/10 flex items-center gap-2"><i data-lucide="phone" class="w-4 h-4"></i> İLETİŞİM BİLGİLERİ</div>
        <div>
          <div class="contact-row"><span class="clabel required" style="color:#ef4444">Telefon:</span><input type="text" class="ccode" value="90" id="phone1Code"><input type="text" class="form-input" placeholder="(5XX) XXX XX XX" id="phone1"></div>
          <div class="contact-row"><span class="clabel">Telefon 2:</span><input type="text" class="ccode" value="90" id="phone2Code"><input type="text" class="form-input" placeholder="(5XX) XXX XX XX" id="phone2"></div>
          <div class="contact-row"><span class="clabel">Faks:</span><input type="text" class="ccode" value="90" id="faxCode"><input type="text" class="form-input" placeholder="Faks numarası" id="faxNo"></div>
          <div class="contact-row">
            <span class="clabel">Cep Telefonu:</span>
            <input type="text" class="form-input" placeholder="(5XX) XXX XX XX" id="cellPhone">
            <div class="wa-btn" onclick="openWhatsApp()" title="WhatsApp"><svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg></div>
          </div>
          <div class="contact-row"><span class="clabel">Web Sitesi:</span><input type="url" class="form-input" placeholder="https://www.firma.com" id="clientWebsite"></div>
        </div>
      </div>

      <!-- NOTLAR -->
      <div class="glass-card form-section mb-6">
        <div class="form-section-title text-slate-600 dark:text-slate-400 bg-slate-50/50 dark:bg-slate-800/30 flex items-center gap-2"><i data-lucide="sticky-note" class="w-4 h-4"></i> NOTLAR</div>
        <div class="p-5">
          <textarea id="clientNotes" class="w-full bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 rounded-xl p-4 text-sm focus:outline-none focus:border-indigo-500 min-h-[120px]" placeholder="Müşteri hakkında ek notlar, özel durumlar..."></textarea>
        </div>
      </div>

      <!-- KAYDET -->
      <div class="flex justify-end gap-3 mb-12">
        <a href="teklif-yonetimi.html" class="px-6 py-3 rounded-xl border border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-300 text-sm font-bold hover:bg-slate-50 dark:hover:bg-slate-800 transition">İptal</a>
        <button onclick="saveClient()" class="px-8 py-3 rounded-xl bg-indigo-600 hover:bg-indigo-500 text-white text-sm font-bold shadow-lg shadow-indigo-600/20 transition flex items-center gap-2"><i data-lucide="check" class="w-4 h-4"></i> Müşteriyi Kaydet</button>
        <button onclick="saveAndCreateProposal()" class="px-6 py-3 rounded-xl bg-emerald-600 hover:bg-emerald-500 text-white text-sm font-bold shadow-lg shadow-emerald-600/20 transition flex items-center gap-2"><i data-lucide="file-plus" class="w-4 h-4"></i> Kaydet & Teklif Oluştur</button>
      </div>
    </div>
  </main>

  <!-- NOTIFICATION -->
  <div id="notifModal" class="fixed inset-0 z-[60] hidden flex items-center justify-center p-4">
    <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeNotification()"></div>
    <div class="relative bg-white dark:bg-slate-900 w-full max-w-sm rounded-2xl shadow-2xl animate-pop border border-slate-200 dark:border-slate-800">
      <div class="p-6 text-center">
        <div id="notifIcon" class="w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 animate-bounce-in"></div>
        <h3 id="notifTitle" class="text-xl font-bold text-slate-900 dark:text-white mb-2"></h3>
        <p id="notifMsg" class="text-sm text-slate-500 mb-6"></p>
        <button onclick="closeNotification()" class="w-full py-3 rounded-xl font-bold text-white bg-indigo-600 hover:bg-indigo-500 transition">Tamam</button>
      </div>
    </div>
  </div>

  <!-- INLINE ADD OPTION MODAL -->
  <div id="addOptionModal" class="fixed inset-0 z-[60] hidden flex items-center justify-center p-4">
    <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeAddOption()"></div>
    <div class="relative bg-white dark:bg-slate-900 w-full max-w-sm rounded-2xl shadow-2xl animate-pop border border-slate-200 dark:border-slate-800 p-6">
      <h3 class="text-lg font-bold text-slate-900 dark:text-white mb-4" id="addOptionTitle">Yeni Ekle</h3>
      <input type="text" id="addOptionInput" class="w-full bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl px-4 py-3 text-sm focus:outline-none focus:border-indigo-500 mb-4" placeholder="Değer girin...">
      <div class="flex gap-3">
        <button onclick="closeAddOption()" class="flex-1 py-2.5 rounded-xl border border-slate-200 dark:border-slate-700 text-slate-600 text-sm font-bold transition">İptal</button>
        <button onclick="confirmAddOption()" class="flex-1 py-2.5 rounded-xl bg-indigo-600 text-white text-sm font-bold transition">Ekle</button>
      </div>
    </div>
  </div>

  <!-- SETTINGS MODAL -->
  <div id="settingsModal" class="fixed inset-0 z-50 hidden">
    <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="closeSettings()"></div>
    <div class="absolute right-0 top-0 h-full w-full max-w-md bg-white dark:bg-slate-900 border-l border-slate-200 dark:border-slate-800 shadow-2xl modal-enter flex flex-col">
      <div class="flex items-center justify-between p-6 border-b border-slate-200 dark:border-slate-800"><h2 class="text-xl font-bold">Ayarlar</h2><button onclick="closeSettings()" class="text-slate-500 hover:text-red-500"><i data-lucide="x" class="w-6 h-6"></i></button></div>
      <div class="flex-1 overflow-y-auto p-6 space-y-8">
        <section><div class="flex items-center gap-4"><div class="w-16 h-16 rounded-full bg-indigo-100 dark:bg-indigo-900/50 flex items-center justify-center text-2xl font-bold text-indigo-600" id="modalAvatar">U</div><div><p class="font-bold text-lg" id="modalName">...</p><p class="text-sm text-slate-500" id="modalEmail">...</p></div></div></section>
        <section><div class="p-4 rounded-xl bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 flex items-center justify-between"><div class="flex items-center gap-3"><i data-lucide="moon" class="w-5 h-5 text-indigo-600"></i><p class="text-sm font-bold">Karanlık Mod</p></div><label class="relative inline-flex items-center cursor-pointer"><input type="checkbox" id="themeToggle" class="sr-only peer" onchange="toggleTheme()"><div class="w-11 h-6 bg-slate-200 rounded-full peer dark:bg-slate-700 peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600"></div></label></div></section>
        <section><button onclick="handleLogout()" class="w-full py-3 rounded-xl border border-red-200 text-red-600 hover:bg-red-50 font-bold flex items-center justify-center gap-2"><i data-lucide="log-out" class="w-4 h-4"></i> Çıkış</button></section>
      </div>
    </div>
  </div>

  <script>
    let currentUser=null,isSidebarCollapsed=false,editingClientId=null,addOptionTarget=null;

    function escapeHtml(t){if(!t)return'';return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}
    // toggleSidebar from sidebar.js
    // toggleSubmenu from sidebar.jselse{m.classList.add('open');if(ic)ic.style.transform='rotate(180deg)'}}
    function openSettings(){document.getElementById('settingsModal').classList.remove('hidden');lucide.createIcons()}
    function closeSettings(){document.getElementById('settingsModal').classList.add('hidden')}
    function closeNotification(){document.getElementById('notifModal').classList.add('hidden')}
    function showNotification(title,msg,type='success'){
      const m=document.getElementById('notifModal'),ic=document.getElementById('notifIcon');
      document.getElementById('notifTitle').innerText=title;document.getElementById('notifMsg').innerText=msg;
      ic.className='w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 animate-bounce-in';
      if(type==='success'){ic.classList.add('bg-green-100','text-green-600');ic.innerHTML='<i data-lucide="check" class="w-8 h-8"></i>'}
      else if(type==='info'){ic.classList.add('bg-indigo-100','text-indigo-600');ic.innerHTML='<i data-lucide="info" class="w-8 h-8"></i>'}
      else{ic.classList.add('bg-red-100','text-red-600');ic.innerHTML='<i data-lucide="alert-triangle" class="w-8 h-8"></i>'}
      m.classList.remove('hidden');lucide.createIcons()
    }
    async function toggleTheme(){const d=document.getElementById('themeToggle').checked;if(d)document.documentElement.classList.add('dark');else document.documentElement.classList.remove('dark');if(currentUser)await supabaseClient.from('profiles').update({theme:d?'dark':'light'}).eq('id',currentUser.id)}
    async function loadUserProfile(){if(!currentUser)return;let{data}=await supabaseClient.from('profiles').select('*').eq('id',currentUser.id).single();if(data&&data.theme==='dark'){document.documentElement.classList.add('dark');document.getElementById('themeToggle').checked=true}}
    async function handleLogout(){await supabaseClient.auth.signOut();window.location.href='login.html'}

    // Add option inline
    function addNewOption(selectId, title){
      addOptionTarget=selectId;
      document.getElementById('addOptionTitle').textContent=title;
      document.getElementById('addOptionInput').value='';
      document.getElementById('addOptionModal').classList.remove('hidden');
      setTimeout(()=>document.getElementById('addOptionInput').focus(),100);
    }
    function closeAddOption(){document.getElementById('addOptionModal').classList.add('hidden');addOptionTarget=null}
    function confirmAddOption(){
      const val=document.getElementById('addOptionInput').value.trim();
      if(!val||!addOptionTarget)return;
      const sel=document.getElementById(addOptionTarget);
      const opt=document.createElement('option');opt.value=val;opt.textContent=val;opt.selected=true;
      sel.appendChild(opt);closeAddOption()
    }

    function sendEmail(){const e=document.getElementById('clientEmail').value;if(e)window.open('mailto:'+e)}
    function openWhatsApp(){const p=document.getElementById('cellPhone').value.replace(/\D/g,'');if(p)window.open('https://wa.me/90'+p,'_blank')}

    function resetForm(){
      ['clientCode','clientName','clientTitle','clientContact','clientEmail','clientDistrict','clientAddress','clientPostalCode','clientTaxOffice','clientTaxNo','clientTcNo','phone1','phone2','faxNo','cellPhone','clientWebsite','clientNotes'].forEach(id=>{const el=document.getElementById(id);if(el)el.value=''});
      ['clientType','clientCategory','clientSector','clientSource'].forEach(id=>{const el=document.getElementById(id);if(el)el.selectedIndex=0});
      editingClientId=null;document.getElementById('pageTitle').textContent='Yeni Müşteri Ekle'
    }

    async function saveClient(){
      const name=document.getElementById('clientName').value.trim();
      if(!name){showNotification('Uyarı','Müşteri adı zorunludur.','error');return}

      const data={
        user_id:currentUser.id,
        name:name,
        contact_person:document.getElementById('clientContact').value.trim(),
        phone:document.getElementById('phone1').value.trim(),
        email:document.getElementById('clientEmail').value.trim(),
        city:document.getElementById('clientCity').value,
        sector:document.getElementById('clientSector').value,
        tax_no:document.getElementById('clientTaxNo').value.trim(),
        address:document.getElementById('clientAddress').value.trim(),
        notes:JSON.stringify({
          code:document.getElementById('clientCode').value.trim(),
          title:document.getElementById('clientTitle').value.trim(),
          type:document.getElementById('clientType').value,
          category:document.getElementById('clientCategory').value,
          source:document.getElementById('clientSource').value,
          country:document.getElementById('clientCountry').value,
          district:document.getElementById('clientDistrict').value.trim(),
          countryCode:document.getElementById('clientCountryCode').value.trim(),
          postalCode:document.getElementById('clientPostalCode').value.trim(),
          taxOffice:document.getElementById('clientTaxOffice').value.trim(),
          tcNo:document.getElementById('clientTcNo').value.trim(),
          phone2:document.getElementById('phone2').value.trim(),
          fax:document.getElementById('faxNo').value.trim(),
          cellPhone:document.getElementById('cellPhone').value.trim(),
          website:document.getElementById('clientWebsite').value.trim(),
          generalNotes:document.getElementById('clientNotes').value.trim()
        })
      };

      let error;
      if(editingClientId){({error}=await supabaseClient.from('clients').update(data).eq('id',editingClientId))}
      else{({error}=await supabaseClient.from('clients').insert([data]))}
      if(error){console.error(error);showNotification('Hata','Kayıt başarısız: '+error.message,'error');return}
      showNotification('Başarılı',editingClientId?'Müşteri güncellendi.':'Yeni müşteri eklendi.');
      if(!editingClientId)setTimeout(()=>resetForm(),1500)
    }

    async function saveAndCreateProposal(){
      await saveClient();
      setTimeout(()=>window.location.href='teklif-olustur.html',1000)
    }

    // Check if editing existing client (via URL param)
    function checkEditMode(){
      const params=new URLSearchParams(window.location.search);
      const cid=params.get('id');
      if(cid)loadClientForEdit(cid)
    }
    async function loadClientForEdit(id){
      const{data,error}=await supabaseClient.from('clients').select('*').eq('id',id).single();
      if(error||!data)return;
      editingClientId=id;
      document.getElementById('pageTitle').textContent='Müşteri Düzenle';
      document.getElementById('clientName').value=data.name||'';
      document.getElementById('clientContact').value=data.contact_person||'';
      document.getElementById('phone1').value=data.phone||'';
      document.getElementById('clientEmail').value=data.email||'';
      document.getElementById('clientCity').value=data.city||'';
      document.getElementById('clientSector').value=data.sector||'';
      document.getElementById('clientTaxNo').value=data.tax_no||'';
      document.getElementById('clientAddress').value=data.address||'';
      try{
        const n=JSON.parse(data.notes||'{}');
        if(n.code)document.getElementById('clientCode').value=n.code;
        if(n.title)document.getElementById('clientTitle').value=n.title;
        if(n.type)document.getElementById('clientType').value=n.type;
        if(n.source)document.getElementById('clientSource').value=n.source;
        if(n.country)document.getElementById('clientCountry').value=n.country;
        if(n.district)document.getElementById('clientDistrict').value=n.district;
        if(n.countryCode)document.getElementById('clientCountryCode').value=n.countryCode;
        if(n.postalCode)document.getElementById('clientPostalCode').value=n.postalCode;
        if(n.taxOffice)document.getElementById('clientTaxOffice').value=n.taxOffice;
        if(n.tcNo)document.getElementById('clientTcNo').value=n.tcNo;
        if(n.phone2)document.getElementById('phone2').value=n.phone2;
        if(n.fax)document.getElementById('faxNo').value=n.fax;
        if(n.cellPhone)document.getElementById('cellPhone').value=n.cellPhone;
        if(n.website)document.getElementById('clientWebsite').value=n.website;
        if(n.generalNotes)document.getElementById('clientNotes').value=n.generalNotes;
      }catch(e){}
    }

    async function initPage(){
      if(!window.currentUser){const{data:{session}}=await supabaseClient.auth.getSession();if(!session){window.location.href='login.html';return}currentUser=session.user}
      else currentUser=window.currentUser;
      const fn=currentUser.user_metadata?.full_name||currentUser.email.split('@')[0];
      if(typeof updateSidebarUser==='function')updateSidebarUser(fn);
      const mn=document.getElementById('modalName');if(mn)mn.textContent=fn;
      const me=document.getElementById('modalEmail');if(me)me.textContent=currentUser.email;
      const ma=document.getElementById('modalAvatar');if(ma)ma.textContent=fn.charAt(0).toUpperCase();
      await loadUserProfile();checkEditMode()
    }
    initPage();lucide.createIcons()
  </script>
</body>
</html>
